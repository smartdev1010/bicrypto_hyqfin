import{a as Jf,c as Ht,g as Zf}from"./_commonjsHelpers-87174ba5.js";import{t as Dt,e as lt}from"./tslib-4d46970e.js";import{e as qs,c as Gs,s as Ws,a as Ys,d as Xs,g as Qf,h as eg,i as Ho,j as Vo,b as tg,k as ig,l as qo,f as Js,m as sg,J as _i,n as Zs,o as Qs,q as Lt,r as Ct,t as Go,u as er,H as Ji}from"./index-47d1cea2.js";import{v as rg,__tla as ng}from"./index-49b55558.js";import"./preload-helper-6f27e6cf.js";let Wo,tr,og=Promise.all([(()=>{try{return ng}catch{}})()]).then(async()=>{var Zi,ir;function Xo(){if(ir)return Zi;ir=1;function t(i){try{return JSON.stringify(i)}catch{return'"[Circular]"'}}Zi=e;function e(i,s,r){var h=r&&r.stringify||t,y=1;if(typeof i=="object"&&i!==null){var u=s.length+y;if(u===1)return i;var g=new Array(u);g[0]=h(i);for(var E=1;E<u;E++)g[E]=h(s[E]);return g.join(" ")}if(typeof i!="string")return i;var D=s.length;if(D===0)return i;for(var b="",A=1-y,v=-1,I=i&&i.length||0,_=0;_<I;){if(i.charCodeAt(_)===37&&_+1<I){switch(v=v>-1?v:0,i.charCodeAt(_+1)){case 100:case 102:if(A>=D||s[A]==null)break;v<_&&(b+=i.slice(v,_)),b+=Number(s[A]),v=_+2,_++;break;case 105:if(A>=D||s[A]==null)break;v<_&&(b+=i.slice(v,_)),b+=Math.floor(Number(s[A])),v=_+2,_++;break;case 79:case 111:case 106:if(A>=D||s[A]===void 0)break;v<_&&(b+=i.slice(v,_));var R=typeof s[A];if(R==="string"){b+="'"+s[A]+"'",v=_+2,_++;break}if(R==="function"){b+=s[A].name||"<anonymous>",v=_+2,_++;break}b+=h(s[A]),v=_+2,_++;break;case 115:if(A>=D)break;v<_&&(b+=i.slice(v,_)),b+=String(s[A]),v=_+2,_++;break;case 37:v<_&&(b+=i.slice(v,_)),b+="%",v=_+2,_++,A--;break}++A}++_}return v===-1?i:(v<I&&(b+=i.slice(v)),b)}return Zi}var Qi,sr;function rr(){if(sr)return Qi;sr=1;const t=Xo();Qi=r;const e=p().console||{},i={mapHttpRequest:I,mapHttpResponse:I,wrapRequestSerializer:_,wrapResponseSerializer:_,wrapErrorSerializer:_,req:I,res:I,err:A};function s(c,n){return Array.isArray(c)?c.filter(function(l){return l!=="!stdSerializers.err"}):c===!0?Object.keys(n):!1}function r(c){c=c||{},c.browser=c.browser||{};const n=c.browser.transmit;if(n&&typeof n.send!="function")throw Error("pino: transmit option must have a send function");const l=c.browser.write||e;c.browser.write&&(c.browser.asObject=!0);const P=c.serializers||{},x=s(c.browser.serialize,P);let B=c.browser.serialize;Array.isArray(c.browser.serialize)&&c.browser.serialize.indexOf("!stdSerializers.err")>-1&&(B=!1);const q=["error","fatal","warn","info","debug","trace"];typeof l=="function"&&(l.error=l.fatal=l.warn=l.info=l.debug=l.trace=l),c.enabled===!1&&(c.level="silent");const X=c.level||"info",O=Object.create(l);O.log||(O.log=R),Object.defineProperty(O,"levelVal",{get:V}),Object.defineProperty(O,"level",{get:$,set:M});const U={transmit:n,serialize:x,asObject:c.browser.asObject,levels:q,timestamp:v(c)};O.levels=r.levels,O.level=X,O.setMaxListeners=O.getMaxListeners=O.emit=O.addListener=O.on=O.prependListener=O.once=O.prependOnceListener=O.removeListener=O.removeAllListeners=O.listeners=O.listenerCount=O.eventNames=O.write=O.flush=R,O.serializers=P,O._serialize=x,O._stdErrSerialize=B,O.child=z,n&&(O._logEvent=b());function V(){return this.level==="silent"?1/0:this.levels.values[this.level]}function $(){return this._level}function M(L){if(L!=="silent"&&!this.levels.values[L])throw Error("unknown level "+L);this._level=L,h(U,O,"error","log"),h(U,O,"fatal","error"),h(U,O,"warn","error"),h(U,O,"info","log"),h(U,O,"debug","log"),h(U,O,"trace","log")}function z(L,K){if(!L)throw new Error("missing bindings for child Pino");K=K||{},x&&L.serializers&&(K.serializers=L.serializers);const te=K.serializers;if(x&&te){var F=Object.assign({},P,te),Z=c.browser.serialize===!0?Object.keys(F):x;delete L.serializers,g([L],Z,F,this._stdErrSerialize)}function W(Q){this._childLevel=(Q._childLevel|0)+1,this.error=E(Q,L,"error"),this.fatal=E(Q,L,"fatal"),this.warn=E(Q,L,"warn"),this.info=E(Q,L,"info"),this.debug=E(Q,L,"debug"),this.trace=E(Q,L,"trace"),F&&(this.serializers=F,this._serialize=Z),n&&(this._logEvent=b([].concat(Q._logEvent.bindings,L)))}return W.prototype=this,new W(this)}return O}r.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},r.stdSerializers=i,r.stdTimeFunctions=Object.assign({},{nullTime:k,epochTime:a,unixTime:f,isoTime:d});function h(c,n,l,P){const x=Object.getPrototypeOf(n);n[l]=n.levelVal>n.levels.values[l]?R:x[l]?x[l]:e[l]||e[P]||R,y(c,n,l)}function y(c,n,l){!c.transmit&&n[l]===R||(n[l]=function(P){return function(){const x=c.timestamp(),B=new Array(arguments.length),q=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var X=0;X<B.length;X++)B[X]=arguments[X];if(c.serialize&&!c.asObject&&g(B,this._serialize,this.serializers,this._stdErrSerialize),c.asObject?P.call(q,u(this,l,B,x)):P.apply(q,B),c.transmit){const O=c.transmit.level||n.level,U=r.levels.values[O],V=r.levels.values[l];if(V<U)return;D(this,{ts:x,methodLevel:l,methodValue:V,transmitLevel:O,transmitValue:r.levels.values[c.transmit.level||n.level],send:c.transmit.send,val:n.levelVal},B)}}}(n[l]))}function u(c,n,l,P){c._serialize&&g(l,c._serialize,c.serializers,c._stdErrSerialize);const x=l.slice();let B=x[0];const q={};P&&(q.time=P),q.level=r.levels.values[n];let X=(c._childLevel|0)+1;if(X<1&&(X=1),B!==null&&typeof B=="object"){for(;X--&&typeof x[0]=="object";)Object.assign(q,x.shift());B=x.length?t(x.shift(),x):void 0}else typeof B=="string"&&(B=t(x.shift(),x));return B!==void 0&&(q.msg=B),q}function g(c,n,l,P){for(const x in c)if(P&&c[x]instanceof Error)c[x]=r.stdSerializers.err(c[x]);else if(typeof c[x]=="object"&&!Array.isArray(c[x]))for(const B in c[x])n&&n.indexOf(B)>-1&&B in l&&(c[x][B]=l[B](c[x][B]))}function E(c,n,l){return function(){const P=new Array(1+arguments.length);P[0]=n;for(var x=1;x<P.length;x++)P[x]=arguments[x-1];return c[l].apply(this,P)}}function D(c,n,l){const P=n.send,x=n.ts,B=n.methodLevel,q=n.methodValue,X=n.val,O=c._logEvent.bindings;g(l,c._serialize||Object.keys(c.serializers),c.serializers,c._stdErrSerialize===void 0?!0:c._stdErrSerialize),c._logEvent.ts=x,c._logEvent.messages=l.filter(function(U){return O.indexOf(U)===-1}),c._logEvent.level.label=B,c._logEvent.level.value=q,P(B,c._logEvent,X),c._logEvent=b(O)}function b(c){return{ts:0,messages:[],bindings:c||[],level:{label:"",value:0}}}function A(c){const n={type:c.constructor.name,msg:c.message,stack:c.stack};for(const l in c)n[l]===void 0&&(n[l]=c[l]);return n}function v(c){return typeof c.timestamp=="function"?c.timestamp:c.timestamp===!1?k:a}function I(){return{}}function _(c){return c}function R(){}function k(){return!1}function a(){return Date.now()}function f(){return Math.round(Date.now()/1e3)}function d(){return new Date(Date.now()).toISOString()}function p(){function c(n){return typeof n<"u"&&n}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return c(self)||c(window)||c(this)||{}}}return Qi}var Jo=rr();const bi=Jf(Jo);var vi={},ei={};Object.defineProperty(ei,"__esModule",{value:!0});function Zo(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return JSON.parse(t)}catch{return t}}ei.safeJsonParse=Zo;function Qo(t){return typeof t=="string"?t:JSON.stringify(t,(e,i)=>typeof i>"u"?null:i)}ei.safeJsonStringify=Qo;var es={},ts={get exports(){return es},set exports(t){es=t}},nr;function ea(){return nr||(nr=1,function(){let t;function e(){}t=e,t.prototype.getItem=function(i){return this.hasOwnProperty(i)?String(this[i]):null},t.prototype.setItem=function(i,s){this[i]=String(s)},t.prototype.removeItem=function(i){delete this[i]},t.prototype.clear=function(){const i=this;Object.keys(i).forEach(function(s){i[s]=void 0,delete i[s]})},t.prototype.key=function(i){return i=i||0,Object.keys(this)[i]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Ht<"u"&&Ht.localStorage?ts.exports=Ht.localStorage:typeof window<"u"&&window.localStorage?ts.exports=window.localStorage:ts.exports=new e}()),es}var or={},ti={},ar;function ta(){if(ar)return ti;ar=1,Object.defineProperty(ti,"__esModule",{value:!0}),ti.IKeyValueStorage=void 0;class t{}return ti.IKeyValueStorage=t,ti}var ii={},cr;function ia(){if(cr)return ii;cr=1,Object.defineProperty(ii,"__esModule",{value:!0}),ii.parseEntry=void 0;const t=ei;function e(i){var s;return[i[0],t.safeJsonParse((s=i[1])!==null&&s!==void 0?s:"")]}return ii.parseEntry=e,ii}var ur;function sa(){return ur||(ur=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Dt;e.__exportStar(ta(),t),e.__exportStar(ia(),t)}(or)),or}Object.defineProperty(vi,"__esModule",{value:!0}),vi.KeyValueStorage=void 0;const Vt=Dt,hr=ei,ra=Vt.__importDefault(ea()),na=sa();class lr{constructor(){this.localStorage=ra.default}getKeys(){return Vt.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return Vt.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(na.parseEntry)})}getItem(e){return Vt.__awaiter(this,void 0,void 0,function*(){const i=this.localStorage.getItem(e);if(i!==null)return hr.safeJsonParse(i)})}setItem(e,i){return Vt.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,hr.safeJsonStringify(i))})}removeItem(e){return Vt.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}vi.KeyValueStorage=lr;var oa=vi.default=lr,si={},ri={},J={},dr={},ni={},pr;function aa(){if(pr)return ni;pr=1,Object.defineProperty(ni,"__esModule",{value:!0}),ni.delay=void 0;function t(e){return new Promise(i=>{setTimeout(()=>{i(!0)},e)})}return ni.delay=t,ni}var Mt={},fr={},qt={},gr;function ca(){return gr||(gr=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.ONE_THOUSAND=qt.ONE_HUNDRED=void 0,qt.ONE_HUNDRED=100,qt.ONE_THOUSAND=1e3),qt}var yr={},Dr;function ua(){return Dr||(Dr=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(yr)),yr}var mr;function Er(){return mr||(mr=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Dt;e.__exportStar(ca(),t),e.__exportStar(ua(),t)}(fr)),fr}var wr;function ha(){if(wr)return Mt;wr=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.fromMiliseconds=Mt.toMiliseconds=void 0;const t=Er();function e(s){return s*t.ONE_THOUSAND}Mt.toMiliseconds=e;function i(s){return Math.floor(s/t.ONE_THOUSAND)}return Mt.fromMiliseconds=i,Mt}var _r;function la(){return _r||(_r=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Dt;e.__exportStar(aa(),t),e.__exportStar(ha(),t)}(dr)),dr}var Gt={},br;function da(){if(br)return Gt;br=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(i){if(this.timestamps.has(i))throw new Error(`Watch already started for label: ${i}`);this.timestamps.set(i,{started:Date.now()})}stop(i){const s=this.get(i);if(typeof s.elapsed<"u")throw new Error(`Watch already stopped for label: ${i}`);const r=Date.now()-s.started;this.timestamps.set(i,{started:s.started,elapsed:r})}get(i){const s=this.timestamps.get(i);if(typeof s>"u")throw new Error(`No timestamp found for label: ${i}`);return s}elapsed(i){const s=this.get(i);return s.elapsed||Date.now()-s.started}}return Gt.Watch=t,Gt.default=t,Gt}var vr={},oi={},Sr;function pa(){if(Sr)return oi;Sr=1,Object.defineProperty(oi,"__esModule",{value:!0}),oi.IWatch=void 0;class t{}return oi.IWatch=t,oi}var Or;function fa(){return Or||(Or=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Dt.__exportStar(pa(),t)}(vr)),vr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Dt;e.__exportStar(la(),t),e.__exportStar(da(),t),e.__exportStar(fa(),t),e.__exportStar(Er(),t)})(J);var Cr={},ai={};class jt{}const ga=Object.freeze(Object.defineProperty({__proto__:null,IEvents:jt},Symbol.toStringTag,{value:"Module"})),ya=Zf(ga);var Ir;function Da(){if(Ir)return ai;Ir=1,Object.defineProperty(ai,"__esModule",{value:!0}),ai.IHeartBeat=void 0;const t=ya;class e extends t.IEvents{constructor(s){super()}}return ai.IHeartBeat=e,ai}var Nr;function Tr(){return Nr||(Nr=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Dt.__exportStar(Da(),t)}(Cr)),Cr}var Ar={},kt={},Ur;function ma(){if(Ur)return kt;Ur=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.HEARTBEAT_EVENTS=kt.HEARTBEAT_INTERVAL=void 0;const t=J;return kt.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,kt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},kt}var Pr;function Rr(){return Pr||(Pr=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Dt.__exportStar(ma(),t)}(Ar)),Ar}var xr;function Ea(){if(xr)return ri;xr=1,Object.defineProperty(ri,"__esModule",{value:!0}),ri.HeartBeat=void 0;const t=Dt,e=lt,i=J,s=Tr(),r=Rr();class h extends s.IHeartBeat{constructor(u){super(u),this.events=new e.EventEmitter,this.interval=r.HEARTBEAT_INTERVAL,this.interval=(u==null?void 0:u.interval)||r.HEARTBEAT_INTERVAL}static init(u){return t.__awaiter(this,void 0,void 0,function*(){const g=new h(u);return yield g.init(),g})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(u,g){this.events.on(u,g)}once(u,g){this.events.once(u,g)}off(u,g){this.events.off(u,g)}removeListener(u,g){this.events.removeListener(u,g)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),i.toMiliseconds(this.interval))})}pulse(){this.events.emit(r.HEARTBEAT_EVENTS.pulse)}}return ri.HeartBeat=h,ri}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Dt;e.__exportStar(Ea(),t),e.__exportStar(Tr(),t),e.__exportStar(Rr(),t)})(si);var Se={},Wt={},Lr;function Mr(){return Lr||(Lr=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.PINO_CUSTOM_CONTEXT_KEY=Wt.PINO_LOGGER_DEFAULTS=void 0,Wt.PINO_LOGGER_DEFAULTS={level:"info"},Wt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Wt}var tt={},jr;function wa(){if(jr)return tt;jr=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.generateChildLogger=tt.formatChildLoggerContext=tt.getLoggerContext=tt.setBrowserLoggerContext=tt.getBrowserLoggerContext=tt.getDefaultLoggerOptions=void 0;const t=Mr();function e(u){return Object.assign(Object.assign({},u),{level:(u==null?void 0:u.level)||t.PINO_LOGGER_DEFAULTS.level})}tt.getDefaultLoggerOptions=e;function i(u,g=t.PINO_CUSTOM_CONTEXT_KEY){return u[g]||""}tt.getBrowserLoggerContext=i;function s(u,g,E=t.PINO_CUSTOM_CONTEXT_KEY){return u[E]=g,u}tt.setBrowserLoggerContext=s;function r(u,g=t.PINO_CUSTOM_CONTEXT_KEY){let E="";return typeof u.bindings>"u"?E=i(u,g):E=u.bindings().context||"",E}tt.getLoggerContext=r;function h(u,g,E=t.PINO_CUSTOM_CONTEXT_KEY){const D=r(u,E);return D.trim()?`${D}/${g}`:g}tt.formatChildLoggerContext=h;function y(u,g,E=t.PINO_CUSTOM_CONTEXT_KEY){const D=h(u,g,E),b=u.child({context:D});return s(b,D,E)}return tt.generateChildLogger=y,tt}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=Dt,i=e.__importDefault(rr());Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return i.default}}),e.__exportStar(Mr(),t),e.__exportStar(wa(),t)})(Se);class _a extends jt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}let ba=class extends jt{constructor(t,e){super(),this.core=t,this.logger=e,this.records=new Map}},va=class{constructor(t,e){this.logger=t,this.core=e}},Sa=class extends jt{constructor(t,e){super(),this.relayer=t,this.logger=e}};class Oa extends jt{constructor(e){super()}}let Ca=class{constructor(t,e,i,s){this.core=t,this.logger=e,this.name=i}};class Ia extends jt{constructor(e,i){super(),this.relayer=e,this.logger=i}}let Na=class extends jt{constructor(t,e){super(),this.core=t,this.logger=e}};var is={},Yt={},Si={},Oi={};Object.defineProperty(Oi,"__esModule",{value:!0}),Oi.BrowserRandomSource=void 0;const kr=65536;class Ta{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const i=new Uint8Array(e);for(let s=0;s<i.length;s+=kr)this._crypto.getRandomValues(i.subarray(s,s+Math.min(i.length-s,kr)));return i}}Oi.BrowserRandomSource=Ta;function Aa(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ci={},rt={};Object.defineProperty(rt,"__esModule",{value:!0});function Ua(t){for(var e=0;e<t.length;e++)t[e]=0;return t}rt.wipe=Ua,Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.NodeRandomSource=void 0;const Pa=rt;class Ra{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof Aa<"u"){const e=rg;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let i=this._crypto.randomBytes(e);if(i.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const s=new Uint8Array(e);for(let r=0;r<s.length;r++)s[r]=i[r];return(0,Pa.wipe)(i),s}}Ci.NodeRandomSource=Ra,Object.defineProperty(Si,"__esModule",{value:!0}),Si.SystemRandomSource=void 0;const xa=Oi,La=Ci;class Ma{constructor(){if(this.isAvailable=!1,this.name="",this._source=new xa.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new La.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Si.SystemRandomSource=Ma;var se={},zr={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(u,g){var E=u>>>16&65535,D=u&65535,b=g>>>16&65535,A=g&65535;return D*A+(E*A+D*b<<16>>>0)|0}t.mul=Math.imul||e;function i(u,g){return u+g|0}t.add=i;function s(u,g){return u-g|0}t.sub=s;function r(u,g){return u<<g|u>>>32-g}t.rotl=r;function h(u,g){return u<<32-g|u>>>g}t.rotr=h;function y(u){return typeof u=="number"&&isFinite(u)&&Math.floor(u)===u}t.isInteger=Number.isInteger||y,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(u){return t.isInteger(u)&&u>=-t.MAX_SAFE_INTEGER&&u<=t.MAX_SAFE_INTEGER}})(zr),Object.defineProperty(se,"__esModule",{value:!0});var $r=zr;function ja(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}se.readInt16BE=ja;function ka(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}se.readUint16BE=ka;function za(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}se.readInt16LE=za;function $a(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}se.readUint16LE=$a;function Kr(t,e,i){return e===void 0&&(e=new Uint8Array(2)),i===void 0&&(i=0),e[i+0]=t>>>8,e[i+1]=t>>>0,e}se.writeUint16BE=Kr,se.writeInt16BE=Kr;function Fr(t,e,i){return e===void 0&&(e=new Uint8Array(2)),i===void 0&&(i=0),e[i+0]=t>>>0,e[i+1]=t>>>8,e}se.writeUint16LE=Fr,se.writeInt16LE=Fr;function ss(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}se.readInt32BE=ss;function rs(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}se.readUint32BE=rs;function ns(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}se.readInt32LE=ns;function os(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}se.readUint32LE=os;function Ii(t,e,i){return e===void 0&&(e=new Uint8Array(4)),i===void 0&&(i=0),e[i+0]=t>>>24,e[i+1]=t>>>16,e[i+2]=t>>>8,e[i+3]=t>>>0,e}se.writeUint32BE=Ii,se.writeInt32BE=Ii;function Ni(t,e,i){return e===void 0&&(e=new Uint8Array(4)),i===void 0&&(i=0),e[i+0]=t>>>0,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24,e}se.writeUint32LE=Ni,se.writeInt32LE=Ni;function Ka(t,e){e===void 0&&(e=0);var i=ss(t,e),s=ss(t,e+4);return i*4294967296+s-(s>>31)*4294967296}se.readInt64BE=Ka;function Fa(t,e){e===void 0&&(e=0);var i=rs(t,e),s=rs(t,e+4);return i*4294967296+s}se.readUint64BE=Fa;function Ba(t,e){e===void 0&&(e=0);var i=ns(t,e),s=ns(t,e+4);return s*4294967296+i-(i>>31)*4294967296}se.readInt64LE=Ba;function Ha(t,e){e===void 0&&(e=0);var i=os(t,e),s=os(t,e+4);return s*4294967296+i}se.readUint64LE=Ha;function Br(t,e,i){return e===void 0&&(e=new Uint8Array(8)),i===void 0&&(i=0),Ii(t/4294967296>>>0,e,i),Ii(t>>>0,e,i+4),e}se.writeUint64BE=Br,se.writeInt64BE=Br;function Hr(t,e,i){return e===void 0&&(e=new Uint8Array(8)),i===void 0&&(i=0),Ni(t>>>0,e,i),Ni(t/4294967296>>>0,e,i+4),e}se.writeUint64LE=Hr,se.writeInt64LE=Hr;function Va(t,e,i){if(i===void 0&&(i=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-i)throw new Error("readUintBE: array is too short for the given bitLength");for(var s=0,r=1,h=t/8+i-1;h>=i;h--)s+=e[h]*r,r*=256;return s}se.readUintBE=Va;function qa(t,e,i){if(i===void 0&&(i=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-i)throw new Error("readUintLE: array is too short for the given bitLength");for(var s=0,r=1,h=i;h<i+t/8;h++)s+=e[h]*r,r*=256;return s}se.readUintLE=qa;function Ga(t,e,i,s){if(i===void 0&&(i=new Uint8Array(t/8)),s===void 0&&(s=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!$r.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var r=1,h=t/8+s-1;h>=s;h--)i[h]=e/r&255,r*=256;return i}se.writeUintBE=Ga;function Wa(t,e,i,s){if(i===void 0&&(i=new Uint8Array(t/8)),s===void 0&&(s=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!$r.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var r=1,h=s;h<s+t/8;h++)i[h]=e/r&255,r*=256;return i}se.writeUintLE=Wa;function Ya(t,e){e===void 0&&(e=0);var i=new DataView(t.buffer,t.byteOffset,t.byteLength);return i.getFloat32(e)}se.readFloat32BE=Ya;function Xa(t,e){e===void 0&&(e=0);var i=new DataView(t.buffer,t.byteOffset,t.byteLength);return i.getFloat32(e,!0)}se.readFloat32LE=Xa;function Ja(t,e){e===void 0&&(e=0);var i=new DataView(t.buffer,t.byteOffset,t.byteLength);return i.getFloat64(e)}se.readFloat64BE=Ja;function Za(t,e){e===void 0&&(e=0);var i=new DataView(t.buffer,t.byteOffset,t.byteLength);return i.getFloat64(e,!0)}se.readFloat64LE=Za;function Qa(t,e,i){e===void 0&&(e=new Uint8Array(4)),i===void 0&&(i=0);var s=new DataView(e.buffer,e.byteOffset,e.byteLength);return s.setFloat32(i,t),e}se.writeFloat32BE=Qa;function ec(t,e,i){e===void 0&&(e=new Uint8Array(4)),i===void 0&&(i=0);var s=new DataView(e.buffer,e.byteOffset,e.byteLength);return s.setFloat32(i,t,!0),e}se.writeFloat32LE=ec;function tc(t,e,i){e===void 0&&(e=new Uint8Array(8)),i===void 0&&(i=0);var s=new DataView(e.buffer,e.byteOffset,e.byteLength);return s.setFloat64(i,t),e}se.writeFloat64BE=tc;function ic(t,e,i){e===void 0&&(e=new Uint8Array(8)),i===void 0&&(i=0);var s=new DataView(e.buffer,e.byteOffset,e.byteLength);return s.setFloat64(i,t,!0),e}se.writeFloat64LE=ic,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=Si,i=se,s=rt;t.defaultRandomSource=new e.SystemRandomSource;function r(E,D=t.defaultRandomSource){return D.randomBytes(E)}t.randomBytes=r;function h(E=t.defaultRandomSource){const D=r(4,E),b=(0,i.readUint32LE)(D);return(0,s.wipe)(D),b}t.randomUint32=h;const y="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function u(E,D=y,b=t.defaultRandomSource){if(D.length<2)throw new Error("randomString charset is too short");if(D.length>256)throw new Error("randomString charset is too long");let A="";const v=D.length,I=256-256%v;for(;E>0;){const _=r(Math.ceil(E*256/I),b);for(let R=0;R<_.length&&E>0;R++){const k=_[R];k<I&&(A+=D.charAt(k%v),E--)}(0,s.wipe)(_)}return A}t.randomString=u;function g(E,D=y,b=t.defaultRandomSource){const A=Math.ceil(E/(Math.log(D.length)/Math.LN2));return u(A,D,b)}t.randomStringForEntropy=g}(Yt);var Vr={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=se,i=rt;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var s=function(){function u(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return u.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},u.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},u.prototype.clean=function(){i.wipe(this._buffer),i.wipe(this._tempHi),i.wipe(this._tempLo),this.reset()},u.prototype.update=function(g,E){if(E===void 0&&(E=g.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var D=0;if(this._bytesHashed+=E,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&E>0;)this._buffer[this._bufferLength++]=g[D++],E--;this._bufferLength===this.blockSize&&(h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(E>=this.blockSize&&(D=h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,g,D,E),E%=this.blockSize);E>0;)this._buffer[this._bufferLength++]=g[D++],E--;return this},u.prototype.finish=function(g){if(!this._finished){var E=this._bytesHashed,D=this._bufferLength,b=E/536870912|0,A=E<<3,v=E%128<112?128:256;this._buffer[D]=128;for(var I=D+1;I<v-8;I++)this._buffer[I]=0;e.writeUint32BE(b,this._buffer,v-8),e.writeUint32BE(A,this._buffer,v-4),h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,v),this._finished=!0}for(var I=0;I<this.digestLength/8;I++)e.writeUint32BE(this._stateHi[I],g,I*8),e.writeUint32BE(this._stateLo[I],g,I*8+4);return this},u.prototype.digest=function(){var g=new Uint8Array(this.digestLength);return this.finish(g),g},u.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},u.prototype.restoreState=function(g){return this._stateHi.set(g.stateHi),this._stateLo.set(g.stateLo),this._bufferLength=g.bufferLength,g.buffer&&this._buffer.set(g.buffer),this._bytesHashed=g.bytesHashed,this._finished=!1,this},u.prototype.cleanSavedState=function(g){i.wipe(g.stateHi),i.wipe(g.stateLo),g.buffer&&i.wipe(g.buffer),g.bufferLength=0,g.bytesHashed=0},u}();t.SHA512=s;var r=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function h(u,g,E,D,b,A,v){for(var I=E[0],_=E[1],R=E[2],k=E[3],a=E[4],f=E[5],d=E[6],p=E[7],c=D[0],n=D[1],l=D[2],P=D[3],x=D[4],B=D[5],q=D[6],X=D[7],O,U,V,$,M,z,L,K;v>=128;){for(var te=0;te<16;te++){var F=8*te+A;u[te]=e.readUint32BE(b,F),g[te]=e.readUint32BE(b,F+4)}for(var te=0;te<80;te++){var Z=I,W=_,Q=R,T=k,N=a,S=f,o=d,w=p,H=c,G=n,le=l,De=P,pe=x,we=B,Re=q,Te=X;if(O=p,U=X,M=U&65535,z=U>>>16,L=O&65535,K=O>>>16,O=(a>>>14|x<<32-14)^(a>>>18|x<<32-18)^(x>>>41-32|a<<32-(41-32)),U=(x>>>14|a<<32-14)^(x>>>18|a<<32-18)^(a>>>41-32|x<<32-(41-32)),M+=U&65535,z+=U>>>16,L+=O&65535,K+=O>>>16,O=a&f^~a&d,U=x&B^~x&q,M+=U&65535,z+=U>>>16,L+=O&65535,K+=O>>>16,O=r[te*2],U=r[te*2+1],M+=U&65535,z+=U>>>16,L+=O&65535,K+=O>>>16,O=u[te%16],U=g[te%16],M+=U&65535,z+=U>>>16,L+=O&65535,K+=O>>>16,z+=M>>>16,L+=z>>>16,K+=L>>>16,V=L&65535|K<<16,$=M&65535|z<<16,O=V,U=$,M=U&65535,z=U>>>16,L=O&65535,K=O>>>16,O=(I>>>28|c<<32-28)^(c>>>34-32|I<<32-(34-32))^(c>>>39-32|I<<32-(39-32)),U=(c>>>28|I<<32-28)^(I>>>34-32|c<<32-(34-32))^(I>>>39-32|c<<32-(39-32)),M+=U&65535,z+=U>>>16,L+=O&65535,K+=O>>>16,O=I&_^I&R^_&R,U=c&n^c&l^n&l,M+=U&65535,z+=U>>>16,L+=O&65535,K+=O>>>16,z+=M>>>16,L+=z>>>16,K+=L>>>16,w=L&65535|K<<16,Te=M&65535|z<<16,O=T,U=De,M=U&65535,z=U>>>16,L=O&65535,K=O>>>16,O=V,U=$,M+=U&65535,z+=U>>>16,L+=O&65535,K+=O>>>16,z+=M>>>16,L+=z>>>16,K+=L>>>16,T=L&65535|K<<16,De=M&65535|z<<16,_=Z,R=W,k=Q,a=T,f=N,d=S,p=o,I=w,n=H,l=G,P=le,x=De,B=pe,q=we,X=Re,c=Te,te%16===15)for(var F=0;F<16;F++)O=u[F],U=g[F],M=U&65535,z=U>>>16,L=O&65535,K=O>>>16,O=u[(F+9)%16],U=g[(F+9)%16],M+=U&65535,z+=U>>>16,L+=O&65535,K+=O>>>16,V=u[(F+1)%16],$=g[(F+1)%16],O=(V>>>1|$<<32-1)^(V>>>8|$<<32-8)^V>>>7,U=($>>>1|V<<32-1)^($>>>8|V<<32-8)^($>>>7|V<<32-7),M+=U&65535,z+=U>>>16,L+=O&65535,K+=O>>>16,V=u[(F+14)%16],$=g[(F+14)%16],O=(V>>>19|$<<32-19)^($>>>61-32|V<<32-(61-32))^V>>>6,U=($>>>19|V<<32-19)^(V>>>61-32|$<<32-(61-32))^($>>>6|V<<32-6),M+=U&65535,z+=U>>>16,L+=O&65535,K+=O>>>16,z+=M>>>16,L+=z>>>16,K+=L>>>16,u[F]=L&65535|K<<16,g[F]=M&65535|z<<16}O=I,U=c,M=U&65535,z=U>>>16,L=O&65535,K=O>>>16,O=E[0],U=D[0],M+=U&65535,z+=U>>>16,L+=O&65535,K+=O>>>16,z+=M>>>16,L+=z>>>16,K+=L>>>16,E[0]=I=L&65535|K<<16,D[0]=c=M&65535|z<<16,O=_,U=n,M=U&65535,z=U>>>16,L=O&65535,K=O>>>16,O=E[1],U=D[1],M+=U&65535,z+=U>>>16,L+=O&65535,K+=O>>>16,z+=M>>>16,L+=z>>>16,K+=L>>>16,E[1]=_=L&65535|K<<16,D[1]=n=M&65535|z<<16,O=R,U=l,M=U&65535,z=U>>>16,L=O&65535,K=O>>>16,O=E[2],U=D[2],M+=U&65535,z+=U>>>16,L+=O&65535,K+=O>>>16,z+=M>>>16,L+=z>>>16,K+=L>>>16,E[2]=R=L&65535|K<<16,D[2]=l=M&65535|z<<16,O=k,U=P,M=U&65535,z=U>>>16,L=O&65535,K=O>>>16,O=E[3],U=D[3],M+=U&65535,z+=U>>>16,L+=O&65535,K+=O>>>16,z+=M>>>16,L+=z>>>16,K+=L>>>16,E[3]=k=L&65535|K<<16,D[3]=P=M&65535|z<<16,O=a,U=x,M=U&65535,z=U>>>16,L=O&65535,K=O>>>16,O=E[4],U=D[4],M+=U&65535,z+=U>>>16,L+=O&65535,K+=O>>>16,z+=M>>>16,L+=z>>>16,K+=L>>>16,E[4]=a=L&65535|K<<16,D[4]=x=M&65535|z<<16,O=f,U=B,M=U&65535,z=U>>>16,L=O&65535,K=O>>>16,O=E[5],U=D[5],M+=U&65535,z+=U>>>16,L+=O&65535,K+=O>>>16,z+=M>>>16,L+=z>>>16,K+=L>>>16,E[5]=f=L&65535|K<<16,D[5]=B=M&65535|z<<16,O=d,U=q,M=U&65535,z=U>>>16,L=O&65535,K=O>>>16,O=E[6],U=D[6],M+=U&65535,z+=U>>>16,L+=O&65535,K+=O>>>16,z+=M>>>16,L+=z>>>16,K+=L>>>16,E[6]=d=L&65535|K<<16,D[6]=q=M&65535|z<<16,O=p,U=X,M=U&65535,z=U>>>16,L=O&65535,K=O>>>16,O=E[7],U=D[7],M+=U&65535,z+=U>>>16,L+=O&65535,K+=O>>>16,z+=M>>>16,L+=z>>>16,K+=L>>>16,E[7]=p=L&65535|K<<16,D[7]=X=M&65535|z<<16,A+=128,v-=128}return A}function y(u){var g=new s;g.update(u);var E=g.digest();return g.clean(),E}t.hash=y})(Vr),function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=Yt,i=Vr,s=rt;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function r(T){const N=new Float64Array(16);if(T)for(let S=0;S<T.length;S++)N[S]=T[S];return N}const h=new Uint8Array(32);h[0]=9;const y=r(),u=r([1]),g=r([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),E=r([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),D=r([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),b=r([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),A=r([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function v(T,N){for(let S=0;S<16;S++)T[S]=N[S]|0}function I(T){let N=1;for(let S=0;S<16;S++){let o=T[S]+N+65535;N=Math.floor(o/65536),T[S]=o-N*65536}T[0]+=N-1+37*(N-1)}function _(T,N,S){const o=~(S-1);for(let w=0;w<16;w++){const H=o&(T[w]^N[w]);T[w]^=H,N[w]^=H}}function R(T,N){const S=r(),o=r();for(let w=0;w<16;w++)o[w]=N[w];I(o),I(o),I(o);for(let w=0;w<2;w++){S[0]=o[0]-65517;for(let G=1;G<15;G++)S[G]=o[G]-65535-(S[G-1]>>16&1),S[G-1]&=65535;S[15]=o[15]-32767-(S[14]>>16&1);const H=S[15]>>16&1;S[14]&=65535,_(o,S,1-H)}for(let w=0;w<16;w++)T[2*w]=o[w]&255,T[2*w+1]=o[w]>>8}function k(T,N){let S=0;for(let o=0;o<32;o++)S|=T[o]^N[o];return(1&S-1>>>8)-1}function a(T,N){const S=new Uint8Array(32),o=new Uint8Array(32);return R(S,T),R(o,N),k(S,o)}function f(T){const N=new Uint8Array(32);return R(N,T),N[0]&1}function d(T,N){for(let S=0;S<16;S++)T[S]=N[2*S]+(N[2*S+1]<<8);T[15]&=32767}function p(T,N,S){for(let o=0;o<16;o++)T[o]=N[o]+S[o]}function c(T,N,S){for(let o=0;o<16;o++)T[o]=N[o]-S[o]}function n(T,N,S){let o,w,H=0,G=0,le=0,De=0,pe=0,we=0,Re=0,Te=0,ye=0,fe=0,de=0,ue=0,ce=0,ae=0,ne=0,ie=0,he=0,ge=0,re=0,me=0,Ee=0,be=0,ve=0,_e=0,gt=0,_t=0,Ut=0,ot=0,$t=0,mi=0,Hi=0,xe=S[0],Ae=S[1],Le=S[2],Me=S[3],je=S[4],Ue=S[5],Ke=S[6],Fe=S[7],Be=S[8],He=S[9],Ve=S[10],ze=S[11],ke=S[12],Ie=S[13],qe=S[14],Ge=S[15];o=N[0],H+=o*xe,G+=o*Ae,le+=o*Le,De+=o*Me,pe+=o*je,we+=o*Ue,Re+=o*Ke,Te+=o*Fe,ye+=o*Be,fe+=o*He,de+=o*Ve,ue+=o*ze,ce+=o*ke,ae+=o*Ie,ne+=o*qe,ie+=o*Ge,o=N[1],G+=o*xe,le+=o*Ae,De+=o*Le,pe+=o*Me,we+=o*je,Re+=o*Ue,Te+=o*Ke,ye+=o*Fe,fe+=o*Be,de+=o*He,ue+=o*Ve,ce+=o*ze,ae+=o*ke,ne+=o*Ie,ie+=o*qe,he+=o*Ge,o=N[2],le+=o*xe,De+=o*Ae,pe+=o*Le,we+=o*Me,Re+=o*je,Te+=o*Ue,ye+=o*Ke,fe+=o*Fe,de+=o*Be,ue+=o*He,ce+=o*Ve,ae+=o*ze,ne+=o*ke,ie+=o*Ie,he+=o*qe,ge+=o*Ge,o=N[3],De+=o*xe,pe+=o*Ae,we+=o*Le,Re+=o*Me,Te+=o*je,ye+=o*Ue,fe+=o*Ke,de+=o*Fe,ue+=o*Be,ce+=o*He,ae+=o*Ve,ne+=o*ze,ie+=o*ke,he+=o*Ie,ge+=o*qe,re+=o*Ge,o=N[4],pe+=o*xe,we+=o*Ae,Re+=o*Le,Te+=o*Me,ye+=o*je,fe+=o*Ue,de+=o*Ke,ue+=o*Fe,ce+=o*Be,ae+=o*He,ne+=o*Ve,ie+=o*ze,he+=o*ke,ge+=o*Ie,re+=o*qe,me+=o*Ge,o=N[5],we+=o*xe,Re+=o*Ae,Te+=o*Le,ye+=o*Me,fe+=o*je,de+=o*Ue,ue+=o*Ke,ce+=o*Fe,ae+=o*Be,ne+=o*He,ie+=o*Ve,he+=o*ze,ge+=o*ke,re+=o*Ie,me+=o*qe,Ee+=o*Ge,o=N[6],Re+=o*xe,Te+=o*Ae,ye+=o*Le,fe+=o*Me,de+=o*je,ue+=o*Ue,ce+=o*Ke,ae+=o*Fe,ne+=o*Be,ie+=o*He,he+=o*Ve,ge+=o*ze,re+=o*ke,me+=o*Ie,Ee+=o*qe,be+=o*Ge,o=N[7],Te+=o*xe,ye+=o*Ae,fe+=o*Le,de+=o*Me,ue+=o*je,ce+=o*Ue,ae+=o*Ke,ne+=o*Fe,ie+=o*Be,he+=o*He,ge+=o*Ve,re+=o*ze,me+=o*ke,Ee+=o*Ie,be+=o*qe,ve+=o*Ge,o=N[8],ye+=o*xe,fe+=o*Ae,de+=o*Le,ue+=o*Me,ce+=o*je,ae+=o*Ue,ne+=o*Ke,ie+=o*Fe,he+=o*Be,ge+=o*He,re+=o*Ve,me+=o*ze,Ee+=o*ke,be+=o*Ie,ve+=o*qe,_e+=o*Ge,o=N[9],fe+=o*xe,de+=o*Ae,ue+=o*Le,ce+=o*Me,ae+=o*je,ne+=o*Ue,ie+=o*Ke,he+=o*Fe,ge+=o*Be,re+=o*He,me+=o*Ve,Ee+=o*ze,be+=o*ke,ve+=o*Ie,_e+=o*qe,gt+=o*Ge,o=N[10],de+=o*xe,ue+=o*Ae,ce+=o*Le,ae+=o*Me,ne+=o*je,ie+=o*Ue,he+=o*Ke,ge+=o*Fe,re+=o*Be,me+=o*He,Ee+=o*Ve,be+=o*ze,ve+=o*ke,_e+=o*Ie,gt+=o*qe,_t+=o*Ge,o=N[11],ue+=o*xe,ce+=o*Ae,ae+=o*Le,ne+=o*Me,ie+=o*je,he+=o*Ue,ge+=o*Ke,re+=o*Fe,me+=o*Be,Ee+=o*He,be+=o*Ve,ve+=o*ze,_e+=o*ke,gt+=o*Ie,_t+=o*qe,Ut+=o*Ge,o=N[12],ce+=o*xe,ae+=o*Ae,ne+=o*Le,ie+=o*Me,he+=o*je,ge+=o*Ue,re+=o*Ke,me+=o*Fe,Ee+=o*Be,be+=o*He,ve+=o*Ve,_e+=o*ze,gt+=o*ke,_t+=o*Ie,Ut+=o*qe,ot+=o*Ge,o=N[13],ae+=o*xe,ne+=o*Ae,ie+=o*Le,he+=o*Me,ge+=o*je,re+=o*Ue,me+=o*Ke,Ee+=o*Fe,be+=o*Be,ve+=o*He,_e+=o*Ve,gt+=o*ze,_t+=o*ke,Ut+=o*Ie,ot+=o*qe,$t+=o*Ge,o=N[14],ne+=o*xe,ie+=o*Ae,he+=o*Le,ge+=o*Me,re+=o*je,me+=o*Ue,Ee+=o*Ke,be+=o*Fe,ve+=o*Be,_e+=o*He,gt+=o*Ve,_t+=o*ze,Ut+=o*ke,ot+=o*Ie,$t+=o*qe,mi+=o*Ge,o=N[15],ie+=o*xe,he+=o*Ae,ge+=o*Le,re+=o*Me,me+=o*je,Ee+=o*Ue,be+=o*Ke,ve+=o*Fe,_e+=o*Be,gt+=o*He,_t+=o*Ve,Ut+=o*ze,ot+=o*ke,$t+=o*Ie,mi+=o*qe,Hi+=o*Ge,H+=38*he,G+=38*ge,le+=38*re,De+=38*me,pe+=38*Ee,we+=38*be,Re+=38*ve,Te+=38*_e,ye+=38*gt,fe+=38*_t,de+=38*Ut,ue+=38*ot,ce+=38*$t,ae+=38*mi,ne+=38*Hi,w=1,o=H+w+65535,w=Math.floor(o/65536),H=o-w*65536,o=G+w+65535,w=Math.floor(o/65536),G=o-w*65536,o=le+w+65535,w=Math.floor(o/65536),le=o-w*65536,o=De+w+65535,w=Math.floor(o/65536),De=o-w*65536,o=pe+w+65535,w=Math.floor(o/65536),pe=o-w*65536,o=we+w+65535,w=Math.floor(o/65536),we=o-w*65536,o=Re+w+65535,w=Math.floor(o/65536),Re=o-w*65536,o=Te+w+65535,w=Math.floor(o/65536),Te=o-w*65536,o=ye+w+65535,w=Math.floor(o/65536),ye=o-w*65536,o=fe+w+65535,w=Math.floor(o/65536),fe=o-w*65536,o=de+w+65535,w=Math.floor(o/65536),de=o-w*65536,o=ue+w+65535,w=Math.floor(o/65536),ue=o-w*65536,o=ce+w+65535,w=Math.floor(o/65536),ce=o-w*65536,o=ae+w+65535,w=Math.floor(o/65536),ae=o-w*65536,o=ne+w+65535,w=Math.floor(o/65536),ne=o-w*65536,o=ie+w+65535,w=Math.floor(o/65536),ie=o-w*65536,H+=w-1+37*(w-1),w=1,o=H+w+65535,w=Math.floor(o/65536),H=o-w*65536,o=G+w+65535,w=Math.floor(o/65536),G=o-w*65536,o=le+w+65535,w=Math.floor(o/65536),le=o-w*65536,o=De+w+65535,w=Math.floor(o/65536),De=o-w*65536,o=pe+w+65535,w=Math.floor(o/65536),pe=o-w*65536,o=we+w+65535,w=Math.floor(o/65536),we=o-w*65536,o=Re+w+65535,w=Math.floor(o/65536),Re=o-w*65536,o=Te+w+65535,w=Math.floor(o/65536),Te=o-w*65536,o=ye+w+65535,w=Math.floor(o/65536),ye=o-w*65536,o=fe+w+65535,w=Math.floor(o/65536),fe=o-w*65536,o=de+w+65535,w=Math.floor(o/65536),de=o-w*65536,o=ue+w+65535,w=Math.floor(o/65536),ue=o-w*65536,o=ce+w+65535,w=Math.floor(o/65536),ce=o-w*65536,o=ae+w+65535,w=Math.floor(o/65536),ae=o-w*65536,o=ne+w+65535,w=Math.floor(o/65536),ne=o-w*65536,o=ie+w+65535,w=Math.floor(o/65536),ie=o-w*65536,H+=w-1+37*(w-1),T[0]=H,T[1]=G,T[2]=le,T[3]=De,T[4]=pe,T[5]=we,T[6]=Re,T[7]=Te,T[8]=ye,T[9]=fe,T[10]=de,T[11]=ue,T[12]=ce,T[13]=ae,T[14]=ne,T[15]=ie}function l(T,N){n(T,N,N)}function P(T,N){const S=r();let o;for(o=0;o<16;o++)S[o]=N[o];for(o=253;o>=0;o--)l(S,S),o!==2&&o!==4&&n(S,S,N);for(o=0;o<16;o++)T[o]=S[o]}function x(T,N){const S=r();let o;for(o=0;o<16;o++)S[o]=N[o];for(o=250;o>=0;o--)l(S,S),o!==1&&n(S,S,N);for(o=0;o<16;o++)T[o]=S[o]}function B(T,N){const S=r(),o=r(),w=r(),H=r(),G=r(),le=r(),De=r(),pe=r(),we=r();c(S,T[1],T[0]),c(we,N[1],N[0]),n(S,S,we),p(o,T[0],T[1]),p(we,N[0],N[1]),n(o,o,we),n(w,T[3],N[3]),n(w,w,E),n(H,T[2],N[2]),p(H,H,H),c(G,o,S),c(le,H,w),p(De,H,w),p(pe,o,S),n(T[0],G,le),n(T[1],pe,De),n(T[2],De,le),n(T[3],G,pe)}function q(T,N,S){for(let o=0;o<4;o++)_(T[o],N[o],S)}function X(T,N){const S=r(),o=r(),w=r();P(w,N[2]),n(S,N[0],w),n(o,N[1],w),R(T,o),T[31]^=f(S)<<7}function O(T,N,S){v(T[0],y),v(T[1],u),v(T[2],u),v(T[3],y);for(let o=255;o>=0;--o){const w=S[o/8|0]>>(o&7)&1;q(T,N,w),B(N,T),B(T,T),q(T,N,w)}}function U(T,N){const S=[r(),r(),r(),r()];v(S[0],D),v(S[1],b),v(S[2],u),n(S[3],D,b),O(T,S,N)}function V(T){if(T.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const N=(0,i.hash)(T);N[0]&=248,N[31]&=127,N[31]|=64;const S=new Uint8Array(32),o=[r(),r(),r(),r()];U(o,N),X(S,o);const w=new Uint8Array(64);return w.set(T),w.set(S,32),{publicKey:S,secretKey:w}}t.generateKeyPairFromSeed=V;function $(T){const N=(0,e.randomBytes)(32,T),S=V(N);return(0,s.wipe)(N),S}t.generateKeyPair=$;function M(T){if(T.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(T.subarray(32))}t.extractPublicKeyFromSecretKey=M;const z=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function L(T,N){let S,o,w,H;for(o=63;o>=32;--o){for(S=0,w=o-32,H=o-12;w<H;++w)N[w]+=S-16*N[o]*z[w-(o-32)],S=Math.floor((N[w]+128)/256),N[w]-=S*256;N[w]+=S,N[o]=0}for(S=0,w=0;w<32;w++)N[w]+=S-(N[31]>>4)*z[w],S=N[w]>>8,N[w]&=255;for(w=0;w<32;w++)N[w]-=S*z[w];for(o=0;o<32;o++)N[o+1]+=N[o]>>8,T[o]=N[o]&255}function K(T){const N=new Float64Array(64);for(let S=0;S<64;S++)N[S]=T[S];for(let S=0;S<64;S++)T[S]=0;L(T,N)}function te(T,N){const S=new Float64Array(64),o=[r(),r(),r(),r()],w=(0,i.hash)(T.subarray(0,32));w[0]&=248,w[31]&=127,w[31]|=64;const H=new Uint8Array(64);H.set(w.subarray(32),32);const G=new i.SHA512;G.update(H.subarray(32)),G.update(N);const le=G.digest();G.clean(),K(le),U(o,le),X(H,o),G.reset(),G.update(H.subarray(0,32)),G.update(T.subarray(32)),G.update(N);const De=G.digest();K(De);for(let pe=0;pe<32;pe++)S[pe]=le[pe];for(let pe=0;pe<32;pe++)for(let we=0;we<32;we++)S[pe+we]+=De[pe]*w[we];return L(H.subarray(32),S),H}t.sign=te;function F(T,N){const S=r(),o=r(),w=r(),H=r(),G=r(),le=r(),De=r();return v(T[2],u),d(T[1],N),l(w,T[1]),n(H,w,g),c(w,w,T[2]),p(H,T[2],H),l(G,H),l(le,G),n(De,le,G),n(S,De,w),n(S,S,H),x(S,S),n(S,S,w),n(S,S,H),n(S,S,H),n(T[0],S,H),l(o,T[0]),n(o,o,H),a(o,w)&&n(T[0],T[0],A),l(o,T[0]),n(o,o,H),a(o,w)?-1:(f(T[0])===N[31]>>7&&c(T[0],y,T[0]),n(T[3],T[0],T[1]),0)}function Z(T,N,S){const o=new Uint8Array(32),w=[r(),r(),r(),r()],H=[r(),r(),r(),r()];if(S.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(F(H,T))return!1;const G=new i.SHA512;G.update(S.subarray(0,32)),G.update(T),G.update(N);const le=G.digest();return K(le),O(w,H,le),U(H,S.subarray(32)),B(w,H),X(o,w),!k(S,o)}t.verify=Z;function W(T){let N=[r(),r(),r(),r()];if(F(N,T))throw new Error("Ed25519: invalid public key");let S=r(),o=r(),w=N[1];p(S,u,w),c(o,u,w),P(o,o),n(S,S,o);let H=new Uint8Array(32);return R(H,S),H}t.convertPublicKeyToX25519=W;function Q(T){const N=(0,i.hash)(T.subarray(0,32));N[0]&=248,N[31]&=127,N[31]|=64;const S=new Uint8Array(N.subarray(0,32));return(0,s.wipe)(N),S}t.convertSecretKeyToX25519=Q}(is);const sc="EdDSA",rc="JWT",qr=".",Gr="base64url",nc="utf8",oc="utf8",ac=":",cc="did",uc="key",Wr="base58btc",hc="z",lc="K36",dc=32;function as(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Yr(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?as(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function pc(t,e){e||(e=t.reduce((r,h)=>r+h.length,0));const i=Yr(e);let s=0;for(const r of t)i.set(r,s),s+=r.length;return as(i)}function fc(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),s=0;s<i.length;s++)i[s]=255;for(var r=0;r<t.length;r++){var h=t.charAt(r),y=h.charCodeAt(0);if(i[y]!==255)throw new TypeError(h+" is ambiguous");i[y]=r}var u=t.length,g=t.charAt(0),E=Math.log(u)/Math.log(256),D=Math.log(256)/Math.log(u);function b(I){if(I instanceof Uint8Array||(ArrayBuffer.isView(I)?I=new Uint8Array(I.buffer,I.byteOffset,I.byteLength):Array.isArray(I)&&(I=Uint8Array.from(I))),!(I instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(I.length===0)return"";for(var _=0,R=0,k=0,a=I.length;k!==a&&I[k]===0;)k++,_++;for(var f=(a-k)*D+1>>>0,d=new Uint8Array(f);k!==a;){for(var p=I[k],c=0,n=f-1;(p!==0||c<R)&&n!==-1;n--,c++)p+=256*d[n]>>>0,d[n]=p%u>>>0,p=p/u>>>0;if(p!==0)throw new Error("Non-zero carry");R=c,k++}for(var l=f-R;l!==f&&d[l]===0;)l++;for(var P=g.repeat(_);l<f;++l)P+=t.charAt(d[l]);return P}function A(I){if(typeof I!="string")throw new TypeError("Expected String");if(I.length===0)return new Uint8Array;var _=0;if(I[_]!==" "){for(var R=0,k=0;I[_]===g;)R++,_++;for(var a=(I.length-_)*E+1>>>0,f=new Uint8Array(a);I[_];){var d=i[I.charCodeAt(_)];if(d===255)return;for(var p=0,c=a-1;(d!==0||p<k)&&c!==-1;c--,p++)d+=u*f[c]>>>0,f[c]=d%256>>>0,d=d/256>>>0;if(d!==0)throw new Error("Non-zero carry");k=p,_++}if(I[_]!==" "){for(var n=a-k;n!==a&&f[n]===0;)n++;for(var l=new Uint8Array(R+(a-n)),P=R;n!==a;)l[P++]=f[n++];return l}}}function v(I){var _=A(I);if(_)return _;throw new Error(`Non-${e} character`)}return{encode:b,decodeUnsafe:A,decode:v}}var gc=fc,yc=gc;const Dc=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},mc=t=>new TextEncoder().encode(t),Ec=t=>new TextDecoder().decode(t);class wc{constructor(e,i,s){this.name=e,this.prefix=i,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class _c{constructor(e,i,s){if(this.name=e,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Xr(this,e)}}class bc{constructor(e){this.decoders=e}or(e){return Xr(this,e)}decode(e){const i=e[0],s=this.decoders[i];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Xr=(t,e)=>new bc({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class vc{constructor(e,i,s,r){this.name=e,this.prefix=i,this.baseEncode=s,this.baseDecode=r,this.encoder=new wc(e,i,s),this.decoder=new _c(e,i,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Ti=({name:t,prefix:e,encode:i,decode:s})=>new vc(t,e,i,s),ci=({prefix:t,name:e,alphabet:i})=>{const{encode:s,decode:r}=yc(i,e);return Ti({prefix:t,name:e,encode:s,decode:h=>Dc(r(h))})},Sc=(t,e,i,s)=>{const r={};for(let D=0;D<e.length;++D)r[e[D]]=D;let h=t.length;for(;t[h-1]==="=";)--h;const y=new Uint8Array(h*i/8|0);let u=0,g=0,E=0;for(let D=0;D<h;++D){const b=r[t[D]];if(b===void 0)throw new SyntaxError(`Non-${s} character`);g=g<<i|b,u+=i,u>=8&&(u-=8,y[E++]=255&g>>u)}if(u>=i||255&g<<8-u)throw new SyntaxError("Unexpected end of data");return y},Oc=(t,e,i)=>{const s=e[e.length-1]==="=",r=(1<<i)-1;let h="",y=0,u=0;for(let g=0;g<t.length;++g)for(u=u<<8|t[g],y+=8;y>i;)y-=i,h+=e[r&u>>y];if(y&&(h+=e[r&u<<i-y]),s)for(;h.length*i&7;)h+="=";return h},Ye=({name:t,prefix:e,bitsPerChar:i,alphabet:s})=>Ti({prefix:e,name:t,encode(r){return Oc(r,s,i)},decode(r){return Sc(r,s,i,t)}}),Cc=Ti({prefix:"\0",name:"identity",encode:t=>Ec(t),decode:t=>mc(t)}),Ic=Object.freeze(Object.defineProperty({__proto__:null,identity:Cc},Symbol.toStringTag,{value:"Module"})),Nc=Ye({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Tc=Object.freeze(Object.defineProperty({__proto__:null,base2:Nc},Symbol.toStringTag,{value:"Module"})),Ac=Ye({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Uc=Object.freeze(Object.defineProperty({__proto__:null,base8:Ac},Symbol.toStringTag,{value:"Module"})),Pc=ci({prefix:"9",name:"base10",alphabet:"0123456789"}),Rc=Object.freeze(Object.defineProperty({__proto__:null,base10:Pc},Symbol.toStringTag,{value:"Module"})),xc=Ye({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Lc=Ye({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Mc=Object.freeze(Object.defineProperty({__proto__:null,base16:xc,base16upper:Lc},Symbol.toStringTag,{value:"Module"})),jc=Ye({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),kc=Ye({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),zc=Ye({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),$c=Ye({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Kc=Ye({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Fc=Ye({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Bc=Ye({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Hc=Ye({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Vc=Ye({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),qc=Object.freeze(Object.defineProperty({__proto__:null,base32:jc,base32upper:kc,base32pad:zc,base32padupper:$c,base32hex:Kc,base32hexupper:Fc,base32hexpad:Bc,base32hexpadupper:Hc,base32z:Vc},Symbol.toStringTag,{value:"Module"})),Gc=ci({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Wc=ci({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Yc=Object.freeze(Object.defineProperty({__proto__:null,base36:Gc,base36upper:Wc},Symbol.toStringTag,{value:"Module"})),Xc=ci({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Jc=ci({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Zc=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Xc,base58flickr:Jc},Symbol.toStringTag,{value:"Module"})),Qc=Ye({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),eu=Ye({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),tu=Ye({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),iu=Ye({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),su=Object.freeze(Object.defineProperty({__proto__:null,base64:Qc,base64pad:eu,base64url:tu,base64urlpad:iu},Symbol.toStringTag,{value:"Module"})),Jr=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),ru=Jr.reduce((t,e,i)=>(t[i]=e,t),[]),nu=Jr.reduce((t,e,i)=>(t[e.codePointAt(0)]=i,t),[]);function ou(t){return t.reduce((e,i)=>(e+=ru[i],e),"")}function au(t){const e=[];for(const i of t){const s=nu[i.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${i}`);e.push(s)}return new Uint8Array(e)}const cu=Ti({prefix:"\u{1F680}",name:"base256emoji",encode:ou,decode:au}),uu=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:cu},Symbol.toStringTag,{value:"Module"}));new TextEncoder,new TextDecoder;const Ai={...Ic,...Tc,...Uc,...Rc,...Mc,...qc,...Yc,...Zc,...su,...uu};function Zr(t,e,i,s){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:i},decoder:{decode:s}}}const Qr=Zr("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),cs=Zr("ascii","a",t=>{let e="a";for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},t=>{t=t.substring(1);const e=Yr(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}),en={utf8:Qr,"utf-8":Qr,hex:Ai.base16,latin1:cs,ascii:cs,binary:cs,...Ai};function us(t,e="utf8"){const i=en[e];if(!i)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):i.encoder.encode(t).substring(1)}function hs(t,e="utf8"){const i=en[e];if(!i)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?as(globalThis.Buffer.from(t,"utf-8")):i.decoder.decode(`${i.prefix}${t}`)}function Ui(t){return us(hs(qs(t),nc),Gr)}function tn(t){const e=hs(lc,Wr),i=hc+us(pc([e,t]),Wr);return[cc,uc,i].join(ac)}function hu(t){return us(t,Gr)}function lu(t){return hs([Ui(t.header),Ui(t.payload)].join(qr),oc)}function du(t){return[Ui(t.header),Ui(t.payload),hu(t.signature)].join(qr)}function sn(t=Yt.randomBytes(dc)){return is.generateKeyPairFromSeed(t)}async function pu(t,e,i,s,r=J.fromMiliseconds(Date.now())){const h={alg:sc,typ:rc},y=tn(s.publicKey),u=r+i,g={iss:y,sub:t,aud:e,iat:r,exp:u},E=lu({header:h,payload:g}),D=is.sign(s.secretKey,E);return du({header:h,payload:g,signature:D})}var ls={},Pi={};Object.defineProperty(Pi,"__esModule",{value:!0});var Ze=se,ds=rt,fu=20;function gu(t,e,i){for(var s=1634760805,r=857760878,h=2036477234,y=1797285236,u=i[3]<<24|i[2]<<16|i[1]<<8|i[0],g=i[7]<<24|i[6]<<16|i[5]<<8|i[4],E=i[11]<<24|i[10]<<16|i[9]<<8|i[8],D=i[15]<<24|i[14]<<16|i[13]<<8|i[12],b=i[19]<<24|i[18]<<16|i[17]<<8|i[16],A=i[23]<<24|i[22]<<16|i[21]<<8|i[20],v=i[27]<<24|i[26]<<16|i[25]<<8|i[24],I=i[31]<<24|i[30]<<16|i[29]<<8|i[28],_=e[3]<<24|e[2]<<16|e[1]<<8|e[0],R=e[7]<<24|e[6]<<16|e[5]<<8|e[4],k=e[11]<<24|e[10]<<16|e[9]<<8|e[8],a=e[15]<<24|e[14]<<16|e[13]<<8|e[12],f=s,d=r,p=h,c=y,n=u,l=g,P=E,x=D,B=b,q=A,X=v,O=I,U=_,V=R,$=k,M=a,z=0;z<fu;z+=2)f=f+n|0,U^=f,U=U>>>32-16|U<<16,B=B+U|0,n^=B,n=n>>>32-12|n<<12,d=d+l|0,V^=d,V=V>>>32-16|V<<16,q=q+V|0,l^=q,l=l>>>32-12|l<<12,p=p+P|0,$^=p,$=$>>>32-16|$<<16,X=X+$|0,P^=X,P=P>>>32-12|P<<12,c=c+x|0,M^=c,M=M>>>32-16|M<<16,O=O+M|0,x^=O,x=x>>>32-12|x<<12,p=p+P|0,$^=p,$=$>>>32-8|$<<8,X=X+$|0,P^=X,P=P>>>32-7|P<<7,c=c+x|0,M^=c,M=M>>>32-8|M<<8,O=O+M|0,x^=O,x=x>>>32-7|x<<7,d=d+l|0,V^=d,V=V>>>32-8|V<<8,q=q+V|0,l^=q,l=l>>>32-7|l<<7,f=f+n|0,U^=f,U=U>>>32-8|U<<8,B=B+U|0,n^=B,n=n>>>32-7|n<<7,f=f+l|0,M^=f,M=M>>>32-16|M<<16,X=X+M|0,l^=X,l=l>>>32-12|l<<12,d=d+P|0,U^=d,U=U>>>32-16|U<<16,O=O+U|0,P^=O,P=P>>>32-12|P<<12,p=p+x|0,V^=p,V=V>>>32-16|V<<16,B=B+V|0,x^=B,x=x>>>32-12|x<<12,c=c+n|0,$^=c,$=$>>>32-16|$<<16,q=q+$|0,n^=q,n=n>>>32-12|n<<12,p=p+x|0,V^=p,V=V>>>32-8|V<<8,B=B+V|0,x^=B,x=x>>>32-7|x<<7,c=c+n|0,$^=c,$=$>>>32-8|$<<8,q=q+$|0,n^=q,n=n>>>32-7|n<<7,d=d+P|0,U^=d,U=U>>>32-8|U<<8,O=O+U|0,P^=O,P=P>>>32-7|P<<7,f=f+l|0,M^=f,M=M>>>32-8|M<<8,X=X+M|0,l^=X,l=l>>>32-7|l<<7;Ze.writeUint32LE(f+s|0,t,0),Ze.writeUint32LE(d+r|0,t,4),Ze.writeUint32LE(p+h|0,t,8),Ze.writeUint32LE(c+y|0,t,12),Ze.writeUint32LE(n+u|0,t,16),Ze.writeUint32LE(l+g|0,t,20),Ze.writeUint32LE(P+E|0,t,24),Ze.writeUint32LE(x+D|0,t,28),Ze.writeUint32LE(B+b|0,t,32),Ze.writeUint32LE(q+A|0,t,36),Ze.writeUint32LE(X+v|0,t,40),Ze.writeUint32LE(O+I|0,t,44),Ze.writeUint32LE(U+_|0,t,48),Ze.writeUint32LE(V+R|0,t,52),Ze.writeUint32LE($+k|0,t,56),Ze.writeUint32LE(M+a|0,t,60)}function rn(t,e,i,s,r){if(r===void 0&&(r=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(s.length<i.length)throw new Error("ChaCha: destination is shorter than source");var h,y;if(r===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");h=new Uint8Array(16),y=h.length-e.length,h.set(e,y)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");h=e,y=r}for(var u=new Uint8Array(64),g=0;g<i.length;g+=64){gu(u,h,t);for(var E=g;E<g+64&&E<i.length;E++)s[E]=i[E]^u[E-g];Du(h,0,y)}return ds.wipe(u),r===0&&ds.wipe(h),s}Pi.streamXOR=rn;function yu(t,e,i,s){return s===void 0&&(s=0),ds.wipe(i),rn(t,e,i,i,s)}Pi.stream=yu;function Du(t,e,i){for(var s=1;i--;)s=s+(t[e]&255)|0,t[e]=s&255,s>>>=8,e++;if(s>0)throw new Error("ChaCha: counter overflow")}var nn={},It={};Object.defineProperty(It,"__esModule",{value:!0});function mu(t,e,i){return~(t-1)&e|t-1&i}It.select=mu;function Eu(t,e){return(t|0)-(e|0)-1>>>31&1}It.lessOrEqual=Eu;function on(t,e){if(t.length!==e.length)return 0;for(var i=0,s=0;s<t.length;s++)i|=t[s]^e[s];return 1&i-1>>>8}It.compare=on;function wu(t,e){return t.length===0||e.length===0?!1:on(t,e)!==0}It.equal=wu,function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=It,i=rt;t.DIGEST_LENGTH=16;var s=function(){function y(u){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var g=u[0]|u[1]<<8;this._r[0]=g&8191;var E=u[2]|u[3]<<8;this._r[1]=(g>>>13|E<<3)&8191;var D=u[4]|u[5]<<8;this._r[2]=(E>>>10|D<<6)&7939;var b=u[6]|u[7]<<8;this._r[3]=(D>>>7|b<<9)&8191;var A=u[8]|u[9]<<8;this._r[4]=(b>>>4|A<<12)&255,this._r[5]=A>>>1&8190;var v=u[10]|u[11]<<8;this._r[6]=(A>>>14|v<<2)&8191;var I=u[12]|u[13]<<8;this._r[7]=(v>>>11|I<<5)&8065;var _=u[14]|u[15]<<8;this._r[8]=(I>>>8|_<<8)&8191,this._r[9]=_>>>5&127,this._pad[0]=u[16]|u[17]<<8,this._pad[1]=u[18]|u[19]<<8,this._pad[2]=u[20]|u[21]<<8,this._pad[3]=u[22]|u[23]<<8,this._pad[4]=u[24]|u[25]<<8,this._pad[5]=u[26]|u[27]<<8,this._pad[6]=u[28]|u[29]<<8,this._pad[7]=u[30]|u[31]<<8}return y.prototype._blocks=function(u,g,E){for(var D=this._fin?0:2048,b=this._h[0],A=this._h[1],v=this._h[2],I=this._h[3],_=this._h[4],R=this._h[5],k=this._h[6],a=this._h[7],f=this._h[8],d=this._h[9],p=this._r[0],c=this._r[1],n=this._r[2],l=this._r[3],P=this._r[4],x=this._r[5],B=this._r[6],q=this._r[7],X=this._r[8],O=this._r[9];E>=16;){var U=u[g+0]|u[g+1]<<8;b+=U&8191;var V=u[g+2]|u[g+3]<<8;A+=(U>>>13|V<<3)&8191;var $=u[g+4]|u[g+5]<<8;v+=(V>>>10|$<<6)&8191;var M=u[g+6]|u[g+7]<<8;I+=($>>>7|M<<9)&8191;var z=u[g+8]|u[g+9]<<8;_+=(M>>>4|z<<12)&8191,R+=z>>>1&8191;var L=u[g+10]|u[g+11]<<8;k+=(z>>>14|L<<2)&8191;var K=u[g+12]|u[g+13]<<8;a+=(L>>>11|K<<5)&8191;var te=u[g+14]|u[g+15]<<8;f+=(K>>>8|te<<8)&8191,d+=te>>>5|D;var F=0,Z=F;Z+=b*p,Z+=A*(5*O),Z+=v*(5*X),Z+=I*(5*q),Z+=_*(5*B),F=Z>>>13,Z&=8191,Z+=R*(5*x),Z+=k*(5*P),Z+=a*(5*l),Z+=f*(5*n),Z+=d*(5*c),F+=Z>>>13,Z&=8191;var W=F;W+=b*c,W+=A*p,W+=v*(5*O),W+=I*(5*X),W+=_*(5*q),F=W>>>13,W&=8191,W+=R*(5*B),W+=k*(5*x),W+=a*(5*P),W+=f*(5*l),W+=d*(5*n),F+=W>>>13,W&=8191;var Q=F;Q+=b*n,Q+=A*c,Q+=v*p,Q+=I*(5*O),Q+=_*(5*X),F=Q>>>13,Q&=8191,Q+=R*(5*q),Q+=k*(5*B),Q+=a*(5*x),Q+=f*(5*P),Q+=d*(5*l),F+=Q>>>13,Q&=8191;var T=F;T+=b*l,T+=A*n,T+=v*c,T+=I*p,T+=_*(5*O),F=T>>>13,T&=8191,T+=R*(5*X),T+=k*(5*q),T+=a*(5*B),T+=f*(5*x),T+=d*(5*P),F+=T>>>13,T&=8191;var N=F;N+=b*P,N+=A*l,N+=v*n,N+=I*c,N+=_*p,F=N>>>13,N&=8191,N+=R*(5*O),N+=k*(5*X),N+=a*(5*q),N+=f*(5*B),N+=d*(5*x),F+=N>>>13,N&=8191;var S=F;S+=b*x,S+=A*P,S+=v*l,S+=I*n,S+=_*c,F=S>>>13,S&=8191,S+=R*p,S+=k*(5*O),S+=a*(5*X),S+=f*(5*q),S+=d*(5*B),F+=S>>>13,S&=8191;var o=F;o+=b*B,o+=A*x,o+=v*P,o+=I*l,o+=_*n,F=o>>>13,o&=8191,o+=R*c,o+=k*p,o+=a*(5*O),o+=f*(5*X),o+=d*(5*q),F+=o>>>13,o&=8191;var w=F;w+=b*q,w+=A*B,w+=v*x,w+=I*P,w+=_*l,F=w>>>13,w&=8191,w+=R*n,w+=k*c,w+=a*p,w+=f*(5*O),w+=d*(5*X),F+=w>>>13,w&=8191;var H=F;H+=b*X,H+=A*q,H+=v*B,H+=I*x,H+=_*P,F=H>>>13,H&=8191,H+=R*l,H+=k*n,H+=a*c,H+=f*p,H+=d*(5*O),F+=H>>>13,H&=8191;var G=F;G+=b*O,G+=A*X,G+=v*q,G+=I*B,G+=_*x,F=G>>>13,G&=8191,G+=R*P,G+=k*l,G+=a*n,G+=f*c,G+=d*p,F+=G>>>13,G&=8191,F=(F<<2)+F|0,F=F+Z|0,Z=F&8191,F=F>>>13,W+=F,b=Z,A=W,v=Q,I=T,_=N,R=S,k=o,a=w,f=H,d=G,g+=16,E-=16}this._h[0]=b,this._h[1]=A,this._h[2]=v,this._h[3]=I,this._h[4]=_,this._h[5]=R,this._h[6]=k,this._h[7]=a,this._h[8]=f,this._h[9]=d},y.prototype.finish=function(u,g){g===void 0&&(g=0);var E=new Uint16Array(10),D,b,A,v;if(this._leftover){for(v=this._leftover,this._buffer[v++]=1;v<16;v++)this._buffer[v]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(D=this._h[1]>>>13,this._h[1]&=8191,v=2;v<10;v++)this._h[v]+=D,D=this._h[v]>>>13,this._h[v]&=8191;for(this._h[0]+=D*5,D=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=D,D=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=D,E[0]=this._h[0]+5,D=E[0]>>>13,E[0]&=8191,v=1;v<10;v++)E[v]=this._h[v]+D,D=E[v]>>>13,E[v]&=8191;for(E[9]-=1<<13,b=(D^1)-1,v=0;v<10;v++)E[v]&=b;for(b=~b,v=0;v<10;v++)this._h[v]=this._h[v]&b|E[v];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,A=this._h[0]+this._pad[0],this._h[0]=A&65535,v=1;v<8;v++)A=(this._h[v]+this._pad[v]|0)+(A>>>16)|0,this._h[v]=A&65535;return u[g+0]=this._h[0]>>>0,u[g+1]=this._h[0]>>>8,u[g+2]=this._h[1]>>>0,u[g+3]=this._h[1]>>>8,u[g+4]=this._h[2]>>>0,u[g+5]=this._h[2]>>>8,u[g+6]=this._h[3]>>>0,u[g+7]=this._h[3]>>>8,u[g+8]=this._h[4]>>>0,u[g+9]=this._h[4]>>>8,u[g+10]=this._h[5]>>>0,u[g+11]=this._h[5]>>>8,u[g+12]=this._h[6]>>>0,u[g+13]=this._h[6]>>>8,u[g+14]=this._h[7]>>>0,u[g+15]=this._h[7]>>>8,this._finished=!0,this},y.prototype.update=function(u){var g=0,E=u.length,D;if(this._leftover){D=16-this._leftover,D>E&&(D=E);for(var b=0;b<D;b++)this._buffer[this._leftover+b]=u[g+b];if(E-=D,g+=D,this._leftover+=D,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(E>=16&&(D=E-E%16,this._blocks(u,g,D),g+=D,E-=D),E){for(var b=0;b<E;b++)this._buffer[this._leftover+b]=u[g+b];this._leftover+=E}return this},y.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var u=new Uint8Array(16);return this.finish(u),u},y.prototype.clean=function(){return i.wipe(this._buffer),i.wipe(this._r),i.wipe(this._h),i.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},y}();t.Poly1305=s;function r(y,u){var g=new s(y);g.update(u);var E=g.digest();return g.clean(),E}t.oneTimeAuth=r;function h(y,u){return y.length!==t.DIGEST_LENGTH||u.length!==t.DIGEST_LENGTH?!1:e.equal(y,u)}t.equal=h}(nn),function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Pi,i=nn,s=rt,r=se,h=It;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var y=new Uint8Array(16),u=function(){function g(E){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,E.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(E)}return g.prototype.seal=function(E,D,b,A){if(E.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var v=new Uint8Array(16);v.set(E,v.length-E.length);var I=new Uint8Array(32);e.stream(this._key,v,I,4);var _=D.length+this.tagLength,R;if(A){if(A.length!==_)throw new Error("ChaCha20Poly1305: incorrect destination length");R=A}else R=new Uint8Array(_);return e.streamXOR(this._key,v,D,R,4),this._authenticate(R.subarray(R.length-this.tagLength,R.length),I,R.subarray(0,R.length-this.tagLength),b),s.wipe(v),R},g.prototype.open=function(E,D,b,A){if(E.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(D.length<this.tagLength)return null;var v=new Uint8Array(16);v.set(E,v.length-E.length);var I=new Uint8Array(32);e.stream(this._key,v,I,4);var _=new Uint8Array(this.tagLength);if(this._authenticate(_,I,D.subarray(0,D.length-this.tagLength),b),!h.equal(_,D.subarray(D.length-this.tagLength,D.length)))return null;var R=D.length-this.tagLength,k;if(A){if(A.length!==R)throw new Error("ChaCha20Poly1305: incorrect destination length");k=A}else k=new Uint8Array(R);return e.streamXOR(this._key,v,D.subarray(0,D.length-this.tagLength),k,4),s.wipe(v),k},g.prototype.clean=function(){return s.wipe(this._key),this},g.prototype._authenticate=function(E,D,b,A){var v=new i.Poly1305(D);A&&(v.update(A),A.length%16>0&&v.update(y.subarray(A.length%16))),v.update(b),b.length%16>0&&v.update(y.subarray(b.length%16));var I=new Uint8Array(8);A&&r.writeUint64LE(A.length,I),v.update(I),r.writeUint64LE(b.length,I),v.update(I);for(var _=v.digest(),R=0;R<_.length;R++)E[R]=_[R];v.clean(),s.wipe(_),s.wipe(I)},g}();t.ChaCha20Poly1305=u}(ls);var an={},ui={},ps={};Object.defineProperty(ps,"__esModule",{value:!0});function _u(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}ps.isSerializableHash=_u,Object.defineProperty(ui,"__esModule",{value:!0});var mt=ps,bu=It,vu=rt,cn=function(){function t(e,i){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var s=new Uint8Array(this.blockSize);i.length>this.blockSize?this._inner.update(i).finish(s).clean():s.set(i);for(var r=0;r<s.length;r++)s[r]^=54;this._inner.update(s);for(var r=0;r<s.length;r++)s[r]^=106;this._outer.update(s),mt.isSerializableHash(this._inner)&&mt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),vu.wipe(s)}return t.prototype.reset=function(){if(!mt.isSerializableHash(this._inner)||!mt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){mt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),mt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!mt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!mt.isSerializableHash(this._inner)||!mt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!mt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();ui.HMAC=cn;function Su(t,e,i){var s=new cn(t,e);s.update(i);var r=s.digest();return s.clean(),r}ui.hmac=Su,ui.equal=bu.equal,Object.defineProperty(an,"__esModule",{value:!0});var un=ui,hn=rt,Ou=function(){function t(e,i,s,r){s===void 0&&(s=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=r;var h=un.hmac(this._hash,s,i);this._hmac=new un.HMAC(e,h),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var i=new Uint8Array(e),s=0;s<i.length;s++)this._bufpos===this._buffer.length&&this._fillBuffer(),i[s]=this._buffer[this._bufpos++];return i},t.prototype.clean=function(){this._hmac.clean(),hn.wipe(this._buffer),hn.wipe(this._counter),this._bufpos=0},t}(),Cu=an.HKDF=Ou,Ri={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=se,i=rt;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var s=function(){function u(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return u.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},u.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},u.prototype.clean=function(){i.wipe(this._buffer),i.wipe(this._temp),this.reset()},u.prototype.update=function(g,E){if(E===void 0&&(E=g.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var D=0;if(this._bytesHashed+=E,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&E>0;)this._buffer[this._bufferLength++]=g[D++],E--;this._bufferLength===this.blockSize&&(h(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(E>=this.blockSize&&(D=h(this._temp,this._state,g,D,E),E%=this.blockSize);E>0;)this._buffer[this._bufferLength++]=g[D++],E--;return this},u.prototype.finish=function(g){if(!this._finished){var E=this._bytesHashed,D=this._bufferLength,b=E/536870912|0,A=E<<3,v=E%64<56?64:128;this._buffer[D]=128;for(var I=D+1;I<v-8;I++)this._buffer[I]=0;e.writeUint32BE(b,this._buffer,v-8),e.writeUint32BE(A,this._buffer,v-4),h(this._temp,this._state,this._buffer,0,v),this._finished=!0}for(var I=0;I<this.digestLength/4;I++)e.writeUint32BE(this._state[I],g,I*4);return this},u.prototype.digest=function(){var g=new Uint8Array(this.digestLength);return this.finish(g),g},u.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},u.prototype.restoreState=function(g){return this._state.set(g.state),this._bufferLength=g.bufferLength,g.buffer&&this._buffer.set(g.buffer),this._bytesHashed=g.bytesHashed,this._finished=!1,this},u.prototype.cleanSavedState=function(g){i.wipe(g.state),g.buffer&&i.wipe(g.buffer),g.bufferLength=0,g.bytesHashed=0},u}();t.SHA256=s;var r=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function h(u,g,E,D,b){for(;b>=64;){for(var A=g[0],v=g[1],I=g[2],_=g[3],R=g[4],k=g[5],a=g[6],f=g[7],d=0;d<16;d++){var p=D+d*4;u[d]=e.readUint32BE(E,p)}for(var d=16;d<64;d++){var c=u[d-2],n=(c>>>17|c<<32-17)^(c>>>19|c<<32-19)^c>>>10;c=u[d-15];var l=(c>>>7|c<<32-7)^(c>>>18|c<<32-18)^c>>>3;u[d]=(n+u[d-7]|0)+(l+u[d-16]|0)}for(var d=0;d<64;d++){var n=(((R>>>6|R<<26)^(R>>>11|R<<21)^(R>>>25|R<<7))+(R&k^~R&a)|0)+(f+(r[d]+u[d]|0)|0)|0,l=((A>>>2|A<<32-2)^(A>>>13|A<<32-13)^(A>>>22|A<<32-22))+(A&v^A&I^v&I)|0;f=a,a=k,k=R,R=_+n|0,_=I,I=v,v=A,A=n+l|0}g[0]+=A,g[1]+=v,g[2]+=I,g[3]+=_,g[4]+=R,g[5]+=k,g[6]+=a,g[7]+=f,D+=64,b-=64}return D}function y(u){var g=new s;g.update(u);var E=g.digest();return g.clean(),E}t.hash=y})(Ri);var fs={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=Yt,i=rt;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function s(d){const p=new Float64Array(16);if(d)for(let c=0;c<d.length;c++)p[c]=d[c];return p}const r=new Uint8Array(32);r[0]=9;const h=s([56129,1]);function y(d){let p=1;for(let c=0;c<16;c++){let n=d[c]+p+65535;p=Math.floor(n/65536),d[c]=n-p*65536}d[0]+=p-1+37*(p-1)}function u(d,p,c){const n=~(c-1);for(let l=0;l<16;l++){const P=n&(d[l]^p[l]);d[l]^=P,p[l]^=P}}function g(d,p){const c=s(),n=s();for(let l=0;l<16;l++)n[l]=p[l];y(n),y(n),y(n);for(let l=0;l<2;l++){c[0]=n[0]-65517;for(let x=1;x<15;x++)c[x]=n[x]-65535-(c[x-1]>>16&1),c[x-1]&=65535;c[15]=n[15]-32767-(c[14]>>16&1);const P=c[15]>>16&1;c[14]&=65535,u(n,c,1-P)}for(let l=0;l<16;l++)d[2*l]=n[l]&255,d[2*l+1]=n[l]>>8}function E(d,p){for(let c=0;c<16;c++)d[c]=p[2*c]+(p[2*c+1]<<8);d[15]&=32767}function D(d,p,c){for(let n=0;n<16;n++)d[n]=p[n]+c[n]}function b(d,p,c){for(let n=0;n<16;n++)d[n]=p[n]-c[n]}function A(d,p,c){let n,l,P=0,x=0,B=0,q=0,X=0,O=0,U=0,V=0,$=0,M=0,z=0,L=0,K=0,te=0,F=0,Z=0,W=0,Q=0,T=0,N=0,S=0,o=0,w=0,H=0,G=0,le=0,De=0,pe=0,we=0,Re=0,Te=0,ye=c[0],fe=c[1],de=c[2],ue=c[3],ce=c[4],ae=c[5],ne=c[6],ie=c[7],he=c[8],ge=c[9],re=c[10],me=c[11],Ee=c[12],be=c[13],ve=c[14],_e=c[15];n=p[0],P+=n*ye,x+=n*fe,B+=n*de,q+=n*ue,X+=n*ce,O+=n*ae,U+=n*ne,V+=n*ie,$+=n*he,M+=n*ge,z+=n*re,L+=n*me,K+=n*Ee,te+=n*be,F+=n*ve,Z+=n*_e,n=p[1],x+=n*ye,B+=n*fe,q+=n*de,X+=n*ue,O+=n*ce,U+=n*ae,V+=n*ne,$+=n*ie,M+=n*he,z+=n*ge,L+=n*re,K+=n*me,te+=n*Ee,F+=n*be,Z+=n*ve,W+=n*_e,n=p[2],B+=n*ye,q+=n*fe,X+=n*de,O+=n*ue,U+=n*ce,V+=n*ae,$+=n*ne,M+=n*ie,z+=n*he,L+=n*ge,K+=n*re,te+=n*me,F+=n*Ee,Z+=n*be,W+=n*ve,Q+=n*_e,n=p[3],q+=n*ye,X+=n*fe,O+=n*de,U+=n*ue,V+=n*ce,$+=n*ae,M+=n*ne,z+=n*ie,L+=n*he,K+=n*ge,te+=n*re,F+=n*me,Z+=n*Ee,W+=n*be,Q+=n*ve,T+=n*_e,n=p[4],X+=n*ye,O+=n*fe,U+=n*de,V+=n*ue,$+=n*ce,M+=n*ae,z+=n*ne,L+=n*ie,K+=n*he,te+=n*ge,F+=n*re,Z+=n*me,W+=n*Ee,Q+=n*be,T+=n*ve,N+=n*_e,n=p[5],O+=n*ye,U+=n*fe,V+=n*de,$+=n*ue,M+=n*ce,z+=n*ae,L+=n*ne,K+=n*ie,te+=n*he,F+=n*ge,Z+=n*re,W+=n*me,Q+=n*Ee,T+=n*be,N+=n*ve,S+=n*_e,n=p[6],U+=n*ye,V+=n*fe,$+=n*de,M+=n*ue,z+=n*ce,L+=n*ae,K+=n*ne,te+=n*ie,F+=n*he,Z+=n*ge,W+=n*re,Q+=n*me,T+=n*Ee,N+=n*be,S+=n*ve,o+=n*_e,n=p[7],V+=n*ye,$+=n*fe,M+=n*de,z+=n*ue,L+=n*ce,K+=n*ae,te+=n*ne,F+=n*ie,Z+=n*he,W+=n*ge,Q+=n*re,T+=n*me,N+=n*Ee,S+=n*be,o+=n*ve,w+=n*_e,n=p[8],$+=n*ye,M+=n*fe,z+=n*de,L+=n*ue,K+=n*ce,te+=n*ae,F+=n*ne,Z+=n*ie,W+=n*he,Q+=n*ge,T+=n*re,N+=n*me,S+=n*Ee,o+=n*be,w+=n*ve,H+=n*_e,n=p[9],M+=n*ye,z+=n*fe,L+=n*de,K+=n*ue,te+=n*ce,F+=n*ae,Z+=n*ne,W+=n*ie,Q+=n*he,T+=n*ge,N+=n*re,S+=n*me,o+=n*Ee,w+=n*be,H+=n*ve,G+=n*_e,n=p[10],z+=n*ye,L+=n*fe,K+=n*de,te+=n*ue,F+=n*ce,Z+=n*ae,W+=n*ne,Q+=n*ie,T+=n*he,N+=n*ge,S+=n*re,o+=n*me,w+=n*Ee,H+=n*be,G+=n*ve,le+=n*_e,n=p[11],L+=n*ye,K+=n*fe,te+=n*de,F+=n*ue,Z+=n*ce,W+=n*ae,Q+=n*ne,T+=n*ie,N+=n*he,S+=n*ge,o+=n*re,w+=n*me,H+=n*Ee,G+=n*be,le+=n*ve,De+=n*_e,n=p[12],K+=n*ye,te+=n*fe,F+=n*de,Z+=n*ue,W+=n*ce,Q+=n*ae,T+=n*ne,N+=n*ie,S+=n*he,o+=n*ge,w+=n*re,H+=n*me,G+=n*Ee,le+=n*be,De+=n*ve,pe+=n*_e,n=p[13],te+=n*ye,F+=n*fe,Z+=n*de,W+=n*ue,Q+=n*ce,T+=n*ae,N+=n*ne,S+=n*ie,o+=n*he,w+=n*ge,H+=n*re,G+=n*me,le+=n*Ee,De+=n*be,pe+=n*ve,we+=n*_e,n=p[14],F+=n*ye,Z+=n*fe,W+=n*de,Q+=n*ue,T+=n*ce,N+=n*ae,S+=n*ne,o+=n*ie,w+=n*he,H+=n*ge,G+=n*re,le+=n*me,De+=n*Ee,pe+=n*be,we+=n*ve,Re+=n*_e,n=p[15],Z+=n*ye,W+=n*fe,Q+=n*de,T+=n*ue,N+=n*ce,S+=n*ae,o+=n*ne,w+=n*ie,H+=n*he,G+=n*ge,le+=n*re,De+=n*me,pe+=n*Ee,we+=n*be,Re+=n*ve,Te+=n*_e,P+=38*W,x+=38*Q,B+=38*T,q+=38*N,X+=38*S,O+=38*o,U+=38*w,V+=38*H,$+=38*G,M+=38*le,z+=38*De,L+=38*pe,K+=38*we,te+=38*Re,F+=38*Te,l=1,n=P+l+65535,l=Math.floor(n/65536),P=n-l*65536,n=x+l+65535,l=Math.floor(n/65536),x=n-l*65536,n=B+l+65535,l=Math.floor(n/65536),B=n-l*65536,n=q+l+65535,l=Math.floor(n/65536),q=n-l*65536,n=X+l+65535,l=Math.floor(n/65536),X=n-l*65536,n=O+l+65535,l=Math.floor(n/65536),O=n-l*65536,n=U+l+65535,l=Math.floor(n/65536),U=n-l*65536,n=V+l+65535,l=Math.floor(n/65536),V=n-l*65536,n=$+l+65535,l=Math.floor(n/65536),$=n-l*65536,n=M+l+65535,l=Math.floor(n/65536),M=n-l*65536,n=z+l+65535,l=Math.floor(n/65536),z=n-l*65536,n=L+l+65535,l=Math.floor(n/65536),L=n-l*65536,n=K+l+65535,l=Math.floor(n/65536),K=n-l*65536,n=te+l+65535,l=Math.floor(n/65536),te=n-l*65536,n=F+l+65535,l=Math.floor(n/65536),F=n-l*65536,n=Z+l+65535,l=Math.floor(n/65536),Z=n-l*65536,P+=l-1+37*(l-1),l=1,n=P+l+65535,l=Math.floor(n/65536),P=n-l*65536,n=x+l+65535,l=Math.floor(n/65536),x=n-l*65536,n=B+l+65535,l=Math.floor(n/65536),B=n-l*65536,n=q+l+65535,l=Math.floor(n/65536),q=n-l*65536,n=X+l+65535,l=Math.floor(n/65536),X=n-l*65536,n=O+l+65535,l=Math.floor(n/65536),O=n-l*65536,n=U+l+65535,l=Math.floor(n/65536),U=n-l*65536,n=V+l+65535,l=Math.floor(n/65536),V=n-l*65536,n=$+l+65535,l=Math.floor(n/65536),$=n-l*65536,n=M+l+65535,l=Math.floor(n/65536),M=n-l*65536,n=z+l+65535,l=Math.floor(n/65536),z=n-l*65536,n=L+l+65535,l=Math.floor(n/65536),L=n-l*65536,n=K+l+65535,l=Math.floor(n/65536),K=n-l*65536,n=te+l+65535,l=Math.floor(n/65536),te=n-l*65536,n=F+l+65535,l=Math.floor(n/65536),F=n-l*65536,n=Z+l+65535,l=Math.floor(n/65536),Z=n-l*65536,P+=l-1+37*(l-1),d[0]=P,d[1]=x,d[2]=B,d[3]=q,d[4]=X,d[5]=O,d[6]=U,d[7]=V,d[8]=$,d[9]=M,d[10]=z,d[11]=L,d[12]=K,d[13]=te,d[14]=F,d[15]=Z}function v(d,p){A(d,p,p)}function I(d,p){const c=s();for(let n=0;n<16;n++)c[n]=p[n];for(let n=253;n>=0;n--)v(c,c),n!==2&&n!==4&&A(c,c,p);for(let n=0;n<16;n++)d[n]=c[n]}function _(d,p){const c=new Uint8Array(32),n=new Float64Array(80),l=s(),P=s(),x=s(),B=s(),q=s(),X=s();for(let $=0;$<31;$++)c[$]=d[$];c[31]=d[31]&127|64,c[0]&=248,E(n,p);for(let $=0;$<16;$++)P[$]=n[$];l[0]=B[0]=1;for(let $=254;$>=0;--$){const M=c[$>>>3]>>>($&7)&1;u(l,P,M),u(x,B,M),D(q,l,x),b(l,l,x),D(x,P,B),b(P,P,B),v(B,q),v(X,l),A(l,x,l),A(x,P,q),D(q,l,x),b(l,l,x),v(P,l),b(x,B,X),A(l,x,h),D(l,l,B),A(x,x,l),A(l,B,X),A(B,P,n),v(P,q),u(l,P,M),u(x,B,M)}for(let $=0;$<16;$++)n[$+16]=l[$],n[$+32]=x[$],n[$+48]=P[$],n[$+64]=B[$];const O=n.subarray(32),U=n.subarray(16);I(O,O),A(U,U,O);const V=new Uint8Array(32);return g(V,U),V}t.scalarMult=_;function R(d){return _(d,r)}t.scalarMultBase=R;function k(d){if(d.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const p=new Uint8Array(d);return{publicKey:R(p),secretKey:p}}t.generateKeyPairFromSeed=k;function a(d){const p=(0,e.randomBytes)(32,d),c=k(p);return(0,i.wipe)(p),c}t.generateKeyPair=a;function f(d,p,c=!1){if(d.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(p.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const n=_(d,p);if(c){let l=0;for(let P=0;P<n.length;P++)l|=n[P];if(l===0)throw new Error("X25519: invalid shared key")}return n}t.sharedKey=f})(fs);function ln(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function dn(t,e){e||(e=t.reduce((r,h)=>r+h.length,0));const i=ln(e);let s=0;for(const r of t)i.set(r,s),s+=r.length;return i}function pn(t,e,i,s){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:i},decoder:{decode:s}}}const fn=pn("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),gs=pn("ascii","a",t=>{let e="a";for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},t=>{t=t.substring(1);const e=ln(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}),gn={utf8:fn,"utf-8":fn,hex:Ai.base16,latin1:gs,ascii:gs,binary:gs,...Ai};function dt(t,e="utf8"){const i=gn[e];if(!i)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):i.decoder.decode(`${i.prefix}${t}`)}function pt(t,e="utf8"){const i=gn[e];if(!i)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):i.encoder.encode(t).substring(1)}var yn=globalThis&&globalThis.__spreadArray||function(t,e,i){if(i||arguments.length===2)for(var s=0,r=e.length,h;s<r;s++)(h||!(s in e))&&(h||(h=Array.prototype.slice.call(e,0,s)),h[s]=e[s]);return t.concat(h||Array.prototype.slice.call(e))},Iu=function(){function t(e,i,s){this.name=e,this.version=i,this.os=s,this.type="browser"}return t}(),Nu=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),Tu=function(){function t(e,i,s,r){this.name=e,this.version=i,this.os=s,this.bot=r,this.type="bot-device"}return t}(),Au=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),Uu=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),Pu=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Ru=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Dn=3,xu=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Pu]],mn=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Lu(t){return t?En(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Uu:typeof navigator<"u"?En(navigator.userAgent):ku()}function Mu(t){return t!==""&&xu.reduce(function(e,i){var s=i[0],r=i[1];if(e)return e;var h=r.exec(t);return!!h&&[s,h]},!1)}function En(t){var e=Mu(t);if(!e)return null;var i=e[0],s=e[1];if(i==="searchbot")return new Au;var r=s[1]&&s[1].split(".").join("_").split("_").slice(0,3);r?r.length<Dn&&(r=yn(yn([],r,!0),zu(Dn-r.length),!0)):r=[];var h=r.join("."),y=ju(t),u=Ru.exec(t);return u&&u[1]?new Tu(i,h,y,u[1]):new Iu(i,h,y)}function ju(t){for(var e=0,i=mn.length;e<i;e++){var s=mn[e],r=s[0],h=s[1],y=h.exec(t);if(y)return r}return null}function ku(){var t=typeof process<"u"&&process.version;return t?new Nu(process.version.slice(1)):null}function zu(t){for(var e=[],i=0;i<t;i++)e.push("0");return e}var ys={};Object.defineProperty(ys,"__esModule",{value:!0}),ys.getWindowMetadata=void 0;const wn=Gs;function $u(){let t,e;try{t=wn.getDocumentOrThrow(),e=wn.getLocationOrThrow()}catch{return null}function i(){const D=t.getElementsByTagName("link"),b=[];for(let A=0;A<D.length;A++){const v=D[A],I=v.getAttribute("rel");if(I&&I.toLowerCase().indexOf("icon")>-1){const _=v.getAttribute("href");if(_)if(_.toLowerCase().indexOf("https:")===-1&&_.toLowerCase().indexOf("http:")===-1&&_.indexOf("//")!==0){let R=e.protocol+"//"+e.host;if(_.indexOf("/")===0)R+=_;else{const k=e.pathname.split("/");k.pop();const a=k.join("/");R+=a+"/"+_}b.push(R)}else if(_.indexOf("//")===0){const R=e.protocol+_;b.push(R)}else b.push(_)}}return b}function s(...D){const b=t.getElementsByTagName("meta");for(let A=0;A<b.length;A++){const v=b[A],I=["itemprop","property","name"].map(_=>v.getAttribute(_)).filter(_=>_?D.includes(_):!1);if(I.length&&I){const _=v.getAttribute("content");if(_)return _}}return""}function r(){let D=s("name","og:site_name","og:title","twitter:title");return D||(D=t.title),D}function h(){return s("description","og:description","twitter:description","keywords")}const y=r(),u=h(),g=e.origin,E=i();return{description:u,url:g,icons:E,name:y}}ys.getWindowMetadata=$u;var hi={},Ds=function(t,e){for(var i={},s=Object.keys(t),r=Array.isArray(e),h=0;h<s.length;h++){var y=s[h],u=t[y];(r?e.indexOf(y)!==-1:e(y,u,t))&&(i[y]=u)}return i};(function(t){const e=Ys,i=Xs,s=Ws,r=Ds,h=a=>a==null,y=Symbol("encodeFragmentIdentifier");function u(a){switch(a.arrayFormat){case"index":return f=>(d,p)=>{const c=d.length;return p===void 0||a.skipNull&&p===null||a.skipEmptyString&&p===""?d:p===null?[...d,[D(f,a),"[",c,"]"].join("")]:[...d,[D(f,a),"[",D(c,a),"]=",D(p,a)].join("")]};case"bracket":return f=>(d,p)=>p===void 0||a.skipNull&&p===null||a.skipEmptyString&&p===""?d:p===null?[...d,[D(f,a),"[]"].join("")]:[...d,[D(f,a),"[]=",D(p,a)].join("")];case"colon-list-separator":return f=>(d,p)=>p===void 0||a.skipNull&&p===null||a.skipEmptyString&&p===""?d:p===null?[...d,[D(f,a),":list="].join("")]:[...d,[D(f,a),":list=",D(p,a)].join("")];case"comma":case"separator":case"bracket-separator":{const f=a.arrayFormat==="bracket-separator"?"[]=":"=";return d=>(p,c)=>c===void 0||a.skipNull&&c===null||a.skipEmptyString&&c===""?p:(c=c===null?"":c,p.length===0?[[D(d,a),f,D(c,a)].join("")]:[[p,D(c,a)].join(a.arrayFormatSeparator)])}default:return f=>(d,p)=>p===void 0||a.skipNull&&p===null||a.skipEmptyString&&p===""?d:p===null?[...d,D(f,a)]:[...d,[D(f,a),"=",D(p,a)].join("")]}}function g(a){let f;switch(a.arrayFormat){case"index":return(d,p,c)=>{if(f=/\[(\d*)\]$/.exec(d),d=d.replace(/\[\d*\]$/,""),!f){c[d]=p;return}c[d]===void 0&&(c[d]={}),c[d][f[1]]=p};case"bracket":return(d,p,c)=>{if(f=/(\[\])$/.exec(d),d=d.replace(/\[\]$/,""),!f){c[d]=p;return}if(c[d]===void 0){c[d]=[p];return}c[d]=[].concat(c[d],p)};case"colon-list-separator":return(d,p,c)=>{if(f=/(:list)$/.exec(d),d=d.replace(/:list$/,""),!f){c[d]=p;return}if(c[d]===void 0){c[d]=[p];return}c[d]=[].concat(c[d],p)};case"comma":case"separator":return(d,p,c)=>{const n=typeof p=="string"&&p.includes(a.arrayFormatSeparator),l=typeof p=="string"&&!n&&b(p,a).includes(a.arrayFormatSeparator);p=l?b(p,a):p;const P=n||l?p.split(a.arrayFormatSeparator).map(x=>b(x,a)):p===null?p:b(p,a);c[d]=P};case"bracket-separator":return(d,p,c)=>{const n=/(\[\])$/.test(d);if(d=d.replace(/\[\]$/,""),!n){c[d]=p&&b(p,a);return}const l=p===null?[]:p.split(a.arrayFormatSeparator).map(P=>b(P,a));if(c[d]===void 0){c[d]=l;return}c[d]=[].concat(c[d],l)};default:return(d,p,c)=>{if(c[d]===void 0){c[d]=p;return}c[d]=[].concat(c[d],p)}}}function E(a){if(typeof a!="string"||a.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function D(a,f){return f.encode?f.strict?e(a):encodeURIComponent(a):a}function b(a,f){return f.decode?i(a):a}function A(a){return Array.isArray(a)?a.sort():typeof a=="object"?A(Object.keys(a)).sort((f,d)=>Number(f)-Number(d)).map(f=>a[f]):a}function v(a){const f=a.indexOf("#");return f!==-1&&(a=a.slice(0,f)),a}function I(a){let f="";const d=a.indexOf("#");return d!==-1&&(f=a.slice(d)),f}function _(a){a=v(a);const f=a.indexOf("?");return f===-1?"":a.slice(f+1)}function R(a,f){return f.parseNumbers&&!Number.isNaN(Number(a))&&typeof a=="string"&&a.trim()!==""?a=Number(a):f.parseBooleans&&a!==null&&(a.toLowerCase()==="true"||a.toLowerCase()==="false")&&(a=a.toLowerCase()==="true"),a}function k(a,f){f=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},f),E(f.arrayFormatSeparator);const d=g(f),p=Object.create(null);if(typeof a!="string"||(a=a.trim().replace(/^[?#&]/,""),!a))return p;for(const c of a.split("&")){if(c==="")continue;let[n,l]=s(f.decode?c.replace(/\+/g," "):c,"=");l=l===void 0?null:["comma","separator","bracket-separator"].includes(f.arrayFormat)?l:b(l,f),d(b(n,f),l,p)}for(const c of Object.keys(p)){const n=p[c];if(typeof n=="object"&&n!==null)for(const l of Object.keys(n))n[l]=R(n[l],f);else p[c]=R(n,f)}return f.sort===!1?p:(f.sort===!0?Object.keys(p).sort():Object.keys(p).sort(f.sort)).reduce((c,n)=>{const l=p[n];return Boolean(l)&&typeof l=="object"&&!Array.isArray(l)?c[n]=A(l):c[n]=l,c},Object.create(null))}t.extract=_,t.parse=k,t.stringify=(a,f)=>{if(!a)return"";f=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},f),E(f.arrayFormatSeparator);const d=l=>f.skipNull&&h(a[l])||f.skipEmptyString&&a[l]==="",p=u(f),c={};for(const l of Object.keys(a))d(l)||(c[l]=a[l]);const n=Object.keys(c);return f.sort!==!1&&n.sort(f.sort),n.map(l=>{const P=a[l];return P===void 0?"":P===null?D(l,f):Array.isArray(P)?P.length===0&&f.arrayFormat==="bracket-separator"?D(l,f)+"[]":P.reduce(p(l),[]).join("&"):D(l,f)+"="+D(P,f)}).filter(l=>l.length>0).join("&")},t.parseUrl=(a,f)=>{f=Object.assign({decode:!0},f);const[d,p]=s(a,"#");return Object.assign({url:d.split("?")[0]||"",query:k(_(a),f)},f&&f.parseFragmentIdentifier&&p?{fragmentIdentifier:b(p,f)}:{})},t.stringifyUrl=(a,f)=>{f=Object.assign({encode:!0,strict:!0,[y]:!0},f);const d=v(a.url).split("?")[0]||"",p=t.extract(a.url),c=t.parse(p,{sort:!1}),n=Object.assign(c,a.query);let l=t.stringify(n,f);l&&(l=`?${l}`);let P=I(a.url);return a.fragmentIdentifier&&(P=`#${f[y]?D(a.fragmentIdentifier,f):a.fragmentIdentifier}`),`${d}${l}${P}`},t.pick=(a,f,d)=>{d=Object.assign({parseFragmentIdentifier:!0,[y]:!1},d);const{url:p,query:c,fragmentIdentifier:n}=t.parseUrl(a,d);return t.stringifyUrl({url:p,query:r(c,f),fragmentIdentifier:n},d)},t.exclude=(a,f,d)=>{const p=Array.isArray(f)?c=>!f.includes(c):(c,n)=>!f(c,n);return t.pick(a,p,d)}})(hi);const Ku={waku:{publish:"waku_publish",subscribe:"waku_subscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe"},irn:{publish:"irn_publish",subscribe:"irn_subscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe"},iridium:{publish:"iridium_publish",subscribe:"iridium_subscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe"}},_n="base10",st="base16",ms="base64pad",Es="utf8",bn=0,Xt=1,Fu=0,vn=1,ws=12,_s=32;function Bu(){const t=fs.generateKeyPair();return{privateKey:pt(t.secretKey,st),publicKey:pt(t.publicKey,st)}}function bs(){const t=Yt.randomBytes(_s);return pt(t,st)}function Hu(t,e){const i=fs.sharedKey(dt(t,st),dt(e,st)),s=new Cu(Ri.SHA256,i).expand(_s);return pt(s,st)}function Vu(t){const e=Ri.hash(dt(t,st));return pt(e,st)}function vs(t){const e=Ri.hash(dt(t,Es));return pt(e,st)}function qu(t){return dt(`${t}`,_n)}function li(t){return Number(pt(t,_n))}function Gu(t){const e=qu(typeof t.type<"u"?t.type:bn);if(li(e)===Xt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const i=typeof t.senderPublicKey<"u"?dt(t.senderPublicKey,st):void 0,s=typeof t.iv<"u"?dt(t.iv,st):Yt.randomBytes(ws),r=new ls.ChaCha20Poly1305(dt(t.symKey,st)).seal(s,dt(t.message,Es));return Yu({type:e,sealed:r,iv:s,senderPublicKey:i})}function Wu(t){const e=new ls.ChaCha20Poly1305(dt(t.symKey,st)),{sealed:i,iv:s}=Ss(t.encoded),r=e.open(s,i);if(r===null)throw new Error("Failed to decrypt");return pt(r,Es)}function Yu(t){if(li(t.type)===Xt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return pt(dn([t.type,t.senderPublicKey,t.iv,t.sealed]),ms)}return pt(dn([t.type,t.iv,t.sealed]),ms)}function Ss(t){const e=dt(t,ms),i=e.slice(Fu,vn),s=vn;if(li(i)===Xt){const u=s+_s,g=u+ws,E=e.slice(s,u),D=e.slice(u,g),b=e.slice(g);return{type:i,sealed:b,iv:D,senderPublicKey:E}}const r=s+ws,h=e.slice(s,r),y=e.slice(r);return{type:i,sealed:y,iv:h}}function Xu(t,e){const i=Ss(t);return Sn({type:li(i.type),senderPublicKey:typeof i.senderPublicKey<"u"?pt(i.senderPublicKey,st):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Sn(t){const e=(t==null?void 0:t.type)||bn;if(e===Xt){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function On(t){return t.type===Xt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var Ju=Object.defineProperty,Cn=Object.getOwnPropertySymbols,Zu=Object.prototype.hasOwnProperty,Qu=Object.prototype.propertyIsEnumerable,In=(t,e,i)=>e in t?Ju(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Nn=(t,e)=>{for(var i in e||(e={}))Zu.call(e,i)&&In(t,i,e[i]);if(Cn)for(var i of Cn(e))Qu.call(e,i)&&In(t,i,e[i]);return t};const eh="ReactNative",di={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},th="js";function Tn(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function ih(){return!eg()&&!!Ho()&&navigator.product===eh}function sh(){return!Tn()&&!!Ho()}function rh(){return ih()?di.reactNative:Tn()?di.node:sh()?di.browser:di.unknown}function nh(t,e){let i=hi.parse(t);return i=Nn(Nn({},i),e),t=hi.stringify(i),t}function oh(){const t=Lu();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function ah(){var t;const e=rh();return e===di.browser?[e,((t=Qf())==null?void 0:t.host)||"unknown"].join(":"):e}function ch(t,e,i){const s=oh(),r=ah();return[[t,e].join("-"),[th,i].join("-"),s,r].join("/")}function uh({protocol:t,version:e,relayUrl:i,sdkVersion:s,auth:r,projectId:h}){const y=i.split("?"),u=ch(t,e,s),g={auth:r,ua:u,projectId:h},E=nh(y[1]||"",g);return y[0]+"?"+E}function An(t){return Object.fromEntries(t.entries())}function Un(t){return new Map(Object.entries(t))}function Os(t,e){return J.fromMiliseconds((e||Date.now())+J.toMiliseconds(t))}function Pn(t){return J.fromMiliseconds(Date.now())>=J.toMiliseconds(t)}function hh(t){const e=J.toMiliseconds(t||J.FIVE_MINUTES);let i,s,r;return{resolve:h=>{r&&i&&(clearTimeout(r),i(h))},reject:h=>{r&&s&&(clearTimeout(r),s(h))},done:()=>new Promise((h,y)=>{r=setTimeout(y,e),i=h,s=y})}}function Rn(t,e){return new Promise(async(i,s)=>{const r=setTimeout(()=>s(),e),h=await t;clearTimeout(r),i(h)})}function xn(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function lh(t){return xn("topic",t)}function dh(t){return xn("id",t)}function ph(t){const[e,i]=t.split(":"),s={id:void 0,topic:void 0};if(e==="topic"&&typeof i=="string")s.topic=i;else if(e==="id"&&Number.isInteger(Number(i)))s.id=Number(i);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${i}`);return s}function Cs(t,e){return`${t}${e?`:${e}`:""}`}const fh="irn";function Is(t){return(t==null?void 0:t.relay)||{protocol:fh}}function Ns(t){const e=Ku[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var gh=Object.defineProperty,Ln=Object.getOwnPropertySymbols,yh=Object.prototype.hasOwnProperty,Dh=Object.prototype.propertyIsEnumerable,Mn=(t,e,i)=>e in t?gh(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,mh=(t,e)=>{for(var i in e||(e={}))yh.call(e,i)&&Mn(t,i,e[i]);if(Ln)for(var i of Ln(e))Dh.call(e,i)&&Mn(t,i,e[i]);return t};function Eh(t,e="-"){const i={},s="relay"+e;return Object.keys(t).forEach(r=>{if(r.startsWith(s)){const h=r.replace(s,""),y=t[r];i[h]=y}}),i}function wh(t){const e=t.indexOf(":"),i=t.indexOf("?")!==-1?t.indexOf("?"):void 0,s=t.substring(0,e),r=t.substring(e+1,i).split("@"),h=typeof i<"u"?t.substring(i):"",y=hi.parse(h);return{protocol:s,topic:r[0],version:parseInt(r[1],10),symKey:y.symKey,relay:Eh(y)}}function _h(t,e="-"){const i="relay",s={};return Object.keys(t).forEach(r=>{const h=i+e+r;t[r]&&(s[h]=t[r])}),s}function bh(t){return`${t.protocol}:${t.topic}@${t.version}?`+hi.stringify(mh({symKey:t.symKey},_h(t.relay)))}const vh={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Sh={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Oe(t,e){const{message:i,code:s}=Sh[t];return{message:e?`${i} ${e}`:i,code:s}}function pi(t,e){const{message:i,code:s}=vh[t];return{message:e?`${i} ${e}`:i,code:s}}function xi(t){return typeof t>"u"}function jn(t,e){return e&&xi(t)?!0:typeof t=="string"&&Boolean(t.trim().length)}function Oh(t){if(jn(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function Ch(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function Ih(t){return t==null?void 0:t.topic}function Ts(t){return typeof t<"u"&&typeof t!==null}const kn=10,Nh=()=>typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),Th=()=>typeof window<"u",Ah=Nh();class Uh{constructor(e){if(this.url=e,this.events=new lt.EventEmitter,this.registering=!1,!Vo(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,i){this.events.on(e,i)}once(e,i){this.events.once(e,i)}off(e,i){this.events.off(e,i)}removeListener(e,i){this.events.removeListener(e,i)}async open(e=this.url){await this.register(e)}async close(){if(typeof this.socket>"u")throw new Error("Connection already closed");this.socket.close(),this.onClose()}async send(e,i){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(qs(e))}catch(s){this.onError(e.id,s)}}register(e=this.url){if(!Vo(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const i=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=i||this.events.listenerCount("open")>=i)&&this.events.setMaxListeners(i+1),new Promise((s,r)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),r(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return r(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=e,this.registering=!0,new Promise((i,s)=>{const r=tg.isReactNative()?void 0:{rejectUnauthorized:!ig(e)},h=new Ah(e,[],r);Th()?h.onerror=y=>{const u=y;s(this.emitError(u.error))}:h.on("error",y=>{s(this.emitError(y))}),h.onopen=()=>{this.onOpen(h),i(h)}})}onOpen(e){e.onmessage=i=>this.onPayload(i),e.onclose=()=>this.onClose(),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(){this.socket=void 0,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const i=typeof e.data=="string"?qo(e.data):e.data;this.events.emit("payload",i)}onError(e,i){const s=this.parseError(i),r=s.message||s.toString(),h=Js(e,r);this.events.emit("payload",h)}parseError(e,i=this.url){return sg(e,i,"WS")}resetMaxListeners(){this.events.getMaxListeners()>kn&&this.events.setMaxListeners(kn)}emitError(e){const i=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for URL: ${this.url}`));return this.events.emit("register_error",i),i}}var Li={},Ph={get exports(){return Li},set exports(t){Li=t}};(function(t,e){var i=200,s="__lodash_hash_undefined__",r=1,h=2,y=9007199254740991,u="[object Arguments]",g="[object Array]",E="[object AsyncFunction]",D="[object Boolean]",b="[object Date]",A="[object Error]",v="[object Function]",I="[object GeneratorFunction]",_="[object Map]",R="[object Number]",k="[object Null]",a="[object Object]",f="[object Promise]",d="[object Proxy]",p="[object RegExp]",c="[object Set]",n="[object String]",l="[object Symbol]",P="[object Undefined]",x="[object WeakMap]",B="[object ArrayBuffer]",q="[object DataView]",X="[object Float32Array]",O="[object Float64Array]",U="[object Int8Array]",V="[object Int16Array]",$="[object Int32Array]",M="[object Uint8Array]",z="[object Uint8ClampedArray]",L="[object Uint16Array]",K="[object Uint32Array]",te=/[\\^$.*+?()[\]{}|]/g,F=/^\[object .+?Constructor\]$/,Z=/^(?:0|[1-9]\d*)$/,W={};W[X]=W[O]=W[U]=W[V]=W[$]=W[M]=W[z]=W[L]=W[K]=!0,W[u]=W[g]=W[B]=W[D]=W[q]=W[b]=W[A]=W[v]=W[_]=W[R]=W[a]=W[p]=W[c]=W[n]=W[x]=!1;var Q=typeof Ht=="object"&&Ht&&Ht.Object===Object&&Ht,T=typeof self=="object"&&self&&self.Object===Object&&self,N=Q||T||Function("return this")(),S=e&&!e.nodeType&&e,o=S&&!0&&t&&!t.nodeType&&t,w=o&&o.exports===S,H=w&&Q.process,G=function(){try{return H&&H.binding&&H.binding("util")}catch{}}(),le=G&&G.isTypedArray;function De(m,C){for(var j=-1,Y=m==null?0:m.length,Ce=0,oe=[];++j<Y;){var Pe=m[j];C(Pe,j,m)&&(oe[Ce++]=Pe)}return oe}function pe(m,C){for(var j=-1,Y=C.length,Ce=m.length;++j<Y;)m[Ce+j]=C[j];return m}function we(m,C){for(var j=-1,Y=m==null?0:m.length;++j<Y;)if(C(m[j],j,m))return!0;return!1}function Re(m,C){for(var j=-1,Y=Array(m);++j<m;)Y[j]=C(j);return Y}function Te(m){return function(C){return m(C)}}function ye(m,C){return m.has(C)}function fe(m,C){return m==null?void 0:m[C]}function de(m){var C=-1,j=Array(m.size);return m.forEach(function(Y,Ce){j[++C]=[Ce,Y]}),j}function ue(m,C){return function(j){return m(C(j))}}function ce(m){var C=-1,j=Array(m.size);return m.forEach(function(Y){j[++C]=Y}),j}var ae=Array.prototype,ne=Function.prototype,ie=Object.prototype,he=N["__core-js_shared__"],ge=ne.toString,re=ie.hasOwnProperty,me=function(){var m=/[^.]+$/.exec(he&&he.keys&&he.keys.IE_PROTO||"");return m?"Symbol(src)_1."+m:""}(),Ee=ie.toString,be=RegExp("^"+ge.call(re).replace(te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ve=w?N.Buffer:void 0,_e=N.Symbol,gt=N.Uint8Array,_t=ie.propertyIsEnumerable,Ut=ae.splice,ot=_e?_e.toStringTag:void 0,$t=Object.getOwnPropertySymbols,mi=ve?ve.isBuffer:void 0,Hi=ue(Object.keys,Object),xe=Qt(N,"DataView"),Ae=Qt(N,"Map"),Le=Qt(N,"Promise"),Me=Qt(N,"Set"),je=Qt(N,"WeakMap"),Ue=Qt(Object,"create"),Ke=Ft(xe),Fe=Ft(Ae),Be=Ft(Le),He=Ft(Me),Ve=Ft(je),ze=_e?_e.prototype:void 0,ke=ze?ze.valueOf:void 0;function Ie(m){var C=-1,j=m==null?0:m.length;for(this.clear();++C<j;){var Y=m[C];this.set(Y[0],Y[1])}}function qe(){this.__data__=Ue?Ue(null):{},this.size=0}function Ge(m){var C=this.has(m)&&delete this.__data__[m];return this.size-=C?1:0,C}function hf(m){var C=this.__data__;if(Ue){var j=C[m];return j===s?void 0:j}return re.call(C,m)?C[m]:void 0}function lf(m){var C=this.__data__;return Ue?C[m]!==void 0:re.call(C,m)}function df(m,C){var j=this.__data__;return this.size+=this.has(m)?0:1,j[m]=Ue&&C===void 0?s:C,this}Ie.prototype.clear=qe,Ie.prototype.delete=Ge,Ie.prototype.get=hf,Ie.prototype.has=lf,Ie.prototype.set=df;function St(m){var C=-1,j=m==null?0:m.length;for(this.clear();++C<j;){var Y=m[C];this.set(Y[0],Y[1])}}function pf(){this.__data__=[],this.size=0}function ff(m){var C=this.__data__,j=qi(C,m);if(j<0)return!1;var Y=C.length-1;return j==Y?C.pop():Ut.call(C,j,1),--this.size,!0}function gf(m){var C=this.__data__,j=qi(C,m);return j<0?void 0:C[j][1]}function yf(m){return qi(this.__data__,m)>-1}function Df(m,C){var j=this.__data__,Y=qi(j,m);return Y<0?(++this.size,j.push([m,C])):j[Y][1]=C,this}St.prototype.clear=pf,St.prototype.delete=ff,St.prototype.get=gf,St.prototype.has=yf,St.prototype.set=Df;function Kt(m){var C=-1,j=m==null?0:m.length;for(this.clear();++C<j;){var Y=m[C];this.set(Y[0],Y[1])}}function mf(){this.size=0,this.__data__={hash:new Ie,map:new(Ae||St),string:new Ie}}function Ef(m){var C=Gi(this,m).delete(m);return this.size-=C?1:0,C}function wf(m){return Gi(this,m).get(m)}function _f(m){return Gi(this,m).has(m)}function bf(m,C){var j=Gi(this,m),Y=j.size;return j.set(m,C),this.size+=j.size==Y?0:1,this}Kt.prototype.clear=mf,Kt.prototype.delete=Ef,Kt.prototype.get=wf,Kt.prototype.has=_f,Kt.prototype.set=bf;function Vi(m){var C=-1,j=m==null?0:m.length;for(this.__data__=new Kt;++C<j;)this.add(m[C])}function vf(m){return this.__data__.set(m,s),this}function Sf(m){return this.__data__.has(m)}Vi.prototype.add=Vi.prototype.push=vf,Vi.prototype.has=Sf;function Pt(m){var C=this.__data__=new St(m);this.size=C.size}function Of(){this.__data__=new St,this.size=0}function Cf(m){var C=this.__data__,j=C.delete(m);return this.size=C.size,j}function If(m){return this.__data__.get(m)}function Nf(m){return this.__data__.has(m)}function Tf(m,C){var j=this.__data__;if(j instanceof St){var Y=j.__data__;if(!Ae||Y.length<i-1)return Y.push([m,C]),this.size=++j.size,this;j=this.__data__=new Kt(Y)}return j.set(m,C),this.size=j.size,this}Pt.prototype.clear=Of,Pt.prototype.delete=Cf,Pt.prototype.get=If,Pt.prototype.has=Nf,Pt.prototype.set=Tf;function Af(m,C){var j=Wi(m),Y=!j&&Vf(m),Ce=!j&&!Y&&Vs(m),oe=!j&&!Y&&!Ce&&Fo(m),Pe=j||Y||Ce||oe,We=Pe?Re(m.length,String):[],Je=We.length;for(var Ne in m)(C||re.call(m,Ne))&&!(Pe&&(Ne=="length"||Ce&&(Ne=="offset"||Ne=="parent")||oe&&(Ne=="buffer"||Ne=="byteLength"||Ne=="byteOffset")||$f(Ne,Je)))&&We.push(Ne);return We}function qi(m,C){for(var j=m.length;j--;)if(ko(m[j][0],C))return j;return-1}function Uf(m,C,j){var Y=C(m);return Wi(m)?Y:pe(Y,j(m))}function Ei(m){return m==null?m===void 0?P:k:ot&&ot in Object(m)?kf(m):Hf(m)}function xo(m){return wi(m)&&Ei(m)==u}function Lo(m,C,j,Y,Ce){return m===C?!0:m==null||C==null||!wi(m)&&!wi(C)?m!==m&&C!==C:Pf(m,C,j,Y,Lo,Ce)}function Pf(m,C,j,Y,Ce,oe){var Pe=Wi(m),We=Wi(C),Je=Pe?g:Rt(m),Ne=We?g:Rt(C);Je=Je==u?a:Je,Ne=Ne==u?a:Ne;var at=Je==a,yt=Ne==a,et=Je==Ne;if(et&&Vs(m)){if(!Vs(C))return!1;Pe=!0,at=!1}if(et&&!at)return oe||(oe=new Pt),Pe||Fo(m)?Mo(m,C,j,Y,Ce,oe):Mf(m,C,Je,j,Y,Ce,oe);if(!(j&r)){var ut=at&&re.call(m,"__wrapped__"),ht=yt&&re.call(C,"__wrapped__");if(ut||ht){var xt=ut?m.value():m,Ot=ht?C.value():C;return oe||(oe=new Pt),Ce(xt,Ot,j,Y,oe)}}return et?(oe||(oe=new Pt),jf(m,C,j,Y,Ce,oe)):!1}function Rf(m){if(!Ko(m)||Ff(m))return!1;var C=zo(m)?be:F;return C.test(Ft(m))}function xf(m){return wi(m)&&$o(m.length)&&!!W[Ei(m)]}function Lf(m){if(!Bf(m))return Hi(m);var C=[];for(var j in Object(m))re.call(m,j)&&j!="constructor"&&C.push(j);return C}function Mo(m,C,j,Y,Ce,oe){var Pe=j&r,We=m.length,Je=C.length;if(We!=Je&&!(Pe&&Je>We))return!1;var Ne=oe.get(m);if(Ne&&oe.get(C))return Ne==C;var at=-1,yt=!0,et=j&h?new Vi:void 0;for(oe.set(m,C),oe.set(C,m);++at<We;){var ut=m[at],ht=C[at];if(Y)var xt=Pe?Y(ht,ut,at,C,m,oe):Y(ut,ht,at,m,C,oe);if(xt!==void 0){if(xt)continue;yt=!1;break}if(et){if(!we(C,function(Ot,Bt){if(!ye(et,Bt)&&(ut===Ot||Ce(ut,Ot,j,Y,oe)))return et.push(Bt)})){yt=!1;break}}else if(!(ut===ht||Ce(ut,ht,j,Y,oe))){yt=!1;break}}return oe.delete(m),oe.delete(C),yt}function Mf(m,C,j,Y,Ce,oe,Pe){switch(j){case q:if(m.byteLength!=C.byteLength||m.byteOffset!=C.byteOffset)return!1;m=m.buffer,C=C.buffer;case B:return!(m.byteLength!=C.byteLength||!oe(new gt(m),new gt(C)));case D:case b:case R:return ko(+m,+C);case A:return m.name==C.name&&m.message==C.message;case p:case n:return m==C+"";case _:var We=de;case c:var Je=Y&r;if(We||(We=ce),m.size!=C.size&&!Je)return!1;var Ne=Pe.get(m);if(Ne)return Ne==C;Y|=h,Pe.set(m,C);var at=Mo(We(m),We(C),Y,Ce,oe,Pe);return Pe.delete(m),at;case l:if(ke)return ke.call(m)==ke.call(C)}return!1}function jf(m,C,j,Y,Ce,oe){var Pe=j&r,We=jo(m),Je=We.length,Ne=jo(C),at=Ne.length;if(Je!=at&&!Pe)return!1;for(var yt=Je;yt--;){var et=We[yt];if(!(Pe?et in C:re.call(C,et)))return!1}var ut=oe.get(m);if(ut&&oe.get(C))return ut==C;var ht=!0;oe.set(m,C),oe.set(C,m);for(var xt=Pe;++yt<Je;){et=We[yt];var Ot=m[et],Bt=C[et];if(Y)var Bo=Pe?Y(Bt,Ot,et,C,m,oe):Y(Ot,Bt,et,m,C,oe);if(!(Bo===void 0?Ot===Bt||Ce(Ot,Bt,j,Y,oe):Bo)){ht=!1;break}xt||(xt=et=="constructor")}if(ht&&!xt){var Yi=m.constructor,Xi=C.constructor;Yi!=Xi&&"constructor"in m&&"constructor"in C&&!(typeof Yi=="function"&&Yi instanceof Yi&&typeof Xi=="function"&&Xi instanceof Xi)&&(ht=!1)}return oe.delete(m),oe.delete(C),ht}function jo(m){return Uf(m,Wf,zf)}function Gi(m,C){var j=m.__data__;return Kf(C)?j[typeof C=="string"?"string":"hash"]:j.map}function Qt(m,C){var j=fe(m,C);return Rf(j)?j:void 0}function kf(m){var C=re.call(m,ot),j=m[ot];try{m[ot]=void 0;var Y=!0}catch{}var Ce=Ee.call(m);return Y&&(C?m[ot]=j:delete m[ot]),Ce}var zf=$t?function(m){return m==null?[]:(m=Object(m),De($t(m),function(C){return _t.call(m,C)}))}:Yf,Rt=Ei;(xe&&Rt(new xe(new ArrayBuffer(1)))!=q||Ae&&Rt(new Ae)!=_||Le&&Rt(Le.resolve())!=f||Me&&Rt(new Me)!=c||je&&Rt(new je)!=x)&&(Rt=function(m){var C=Ei(m),j=C==a?m.constructor:void 0,Y=j?Ft(j):"";if(Y)switch(Y){case Ke:return q;case Fe:return _;case Be:return f;case He:return c;case Ve:return x}return C});function $f(m,C){return C=C??y,!!C&&(typeof m=="number"||Z.test(m))&&m>-1&&m%1==0&&m<C}function Kf(m){var C=typeof m;return C=="string"||C=="number"||C=="symbol"||C=="boolean"?m!=="__proto__":m===null}function Ff(m){return!!me&&me in m}function Bf(m){var C=m&&m.constructor,j=typeof C=="function"&&C.prototype||ie;return m===j}function Hf(m){return Ee.call(m)}function Ft(m){if(m!=null){try{return ge.call(m)}catch{}try{return m+""}catch{}}return""}function ko(m,C){return m===C||m!==m&&C!==C}var Vf=xo(function(){return arguments}())?xo:function(m){return wi(m)&&re.call(m,"callee")&&!_t.call(m,"callee")},Wi=Array.isArray;function qf(m){return m!=null&&$o(m.length)&&!zo(m)}var Vs=mi||Xf;function Gf(m,C){return Lo(m,C)}function zo(m){if(!Ko(m))return!1;var C=Ei(m);return C==v||C==I||C==E||C==d}function $o(m){return typeof m=="number"&&m>-1&&m%1==0&&m<=y}function Ko(m){var C=typeof m;return m!=null&&(C=="object"||C=="function")}function wi(m){return m!=null&&typeof m=="object"}var Fo=le?Te(le):xf;function Wf(m){return qf(m)?Af(m):Lf(m)}function Yf(){return[]}function Xf(){return!1}t.exports=Gf})(Ph,Li);function Rh(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),s=0;s<i.length;s++)i[s]=255;for(var r=0;r<t.length;r++){var h=t.charAt(r),y=h.charCodeAt(0);if(i[y]!==255)throw new TypeError(h+" is ambiguous");i[y]=r}var u=t.length,g=t.charAt(0),E=Math.log(u)/Math.log(256),D=Math.log(256)/Math.log(u);function b(I){if(I instanceof Uint8Array||(ArrayBuffer.isView(I)?I=new Uint8Array(I.buffer,I.byteOffset,I.byteLength):Array.isArray(I)&&(I=Uint8Array.from(I))),!(I instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(I.length===0)return"";for(var _=0,R=0,k=0,a=I.length;k!==a&&I[k]===0;)k++,_++;for(var f=(a-k)*D+1>>>0,d=new Uint8Array(f);k!==a;){for(var p=I[k],c=0,n=f-1;(p!==0||c<R)&&n!==-1;n--,c++)p+=256*d[n]>>>0,d[n]=p%u>>>0,p=p/u>>>0;if(p!==0)throw new Error("Non-zero carry");R=c,k++}for(var l=f-R;l!==f&&d[l]===0;)l++;for(var P=g.repeat(_);l<f;++l)P+=t.charAt(d[l]);return P}function A(I){if(typeof I!="string")throw new TypeError("Expected String");if(I.length===0)return new Uint8Array;var _=0;if(I[_]!==" "){for(var R=0,k=0;I[_]===g;)R++,_++;for(var a=(I.length-_)*E+1>>>0,f=new Uint8Array(a);I[_];){var d=i[I.charCodeAt(_)];if(d===255)return;for(var p=0,c=a-1;(d!==0||p<k)&&c!==-1;c--,p++)d+=u*f[c]>>>0,f[c]=d%256>>>0,d=d/256>>>0;if(d!==0)throw new Error("Non-zero carry");k=p,_++}if(I[_]!==" "){for(var n=a-k;n!==a&&f[n]===0;)n++;for(var l=new Uint8Array(R+(a-n)),P=R;n!==a;)l[P++]=f[n++];return l}}}function v(I){var _=A(I);if(_)return _;throw new Error(`Non-${e} character`)}return{encode:b,decodeUnsafe:A,decode:v}}var xh=Rh,Lh=xh;const zn=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Mh=t=>new TextEncoder().encode(t),jh=t=>new TextDecoder().decode(t);class kh{constructor(e,i,s){this.name=e,this.prefix=i,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class zh{constructor(e,i,s){if(this.name=e,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return $n(this,e)}}class $h{constructor(e){this.decoders=e}or(e){return $n(this,e)}decode(e){const i=e[0],s=this.decoders[i];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const $n=(t,e)=>new $h({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Kh{constructor(e,i,s,r){this.name=e,this.prefix=i,this.baseEncode=s,this.baseDecode=r,this.encoder=new kh(e,i,s),this.decoder=new zh(e,i,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Mi=({name:t,prefix:e,encode:i,decode:s})=>new Kh(t,e,i,s),fi=({prefix:t,name:e,alphabet:i})=>{const{encode:s,decode:r}=Lh(i,e);return Mi({prefix:t,name:e,encode:s,decode:h=>zn(r(h))})},Fh=(t,e,i,s)=>{const r={};for(let D=0;D<e.length;++D)r[e[D]]=D;let h=t.length;for(;t[h-1]==="=";)--h;const y=new Uint8Array(h*i/8|0);let u=0,g=0,E=0;for(let D=0;D<h;++D){const b=r[t[D]];if(b===void 0)throw new SyntaxError(`Non-${s} character`);g=g<<i|b,u+=i,u>=8&&(u-=8,y[E++]=255&g>>u)}if(u>=i||255&g<<8-u)throw new SyntaxError("Unexpected end of data");return y},Bh=(t,e,i)=>{const s=e[e.length-1]==="=",r=(1<<i)-1;let h="",y=0,u=0;for(let g=0;g<t.length;++g)for(u=u<<8|t[g],y+=8;y>i;)y-=i,h+=e[r&u>>y];if(y&&(h+=e[r&u<<i-y]),s)for(;h.length*i&7;)h+="=";return h},Xe=({name:t,prefix:e,bitsPerChar:i,alphabet:s})=>Mi({prefix:e,name:t,encode(r){return Bh(r,s,i)},decode(r){return Fh(r,s,i,t)}}),Hh=Mi({prefix:"\0",name:"identity",encode:t=>jh(t),decode:t=>Mh(t)});var Vh=Object.freeze({__proto__:null,identity:Hh});const qh=Xe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Gh=Object.freeze({__proto__:null,base2:qh});const Wh=Xe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Yh=Object.freeze({__proto__:null,base8:Wh});const Xh=fi({prefix:"9",name:"base10",alphabet:"0123456789"});var Jh=Object.freeze({__proto__:null,base10:Xh});const Zh=Xe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Qh=Xe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var el=Object.freeze({__proto__:null,base16:Zh,base16upper:Qh});const tl=Xe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),il=Xe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),sl=Xe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),rl=Xe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),nl=Xe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ol=Xe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),al=Xe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),cl=Xe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ul=Xe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var hl=Object.freeze({__proto__:null,base32:tl,base32upper:il,base32pad:sl,base32padupper:rl,base32hex:nl,base32hexupper:ol,base32hexpad:al,base32hexpadupper:cl,base32z:ul});const ll=fi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),dl=fi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var pl=Object.freeze({__proto__:null,base36:ll,base36upper:dl});const fl=fi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),gl=fi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var yl=Object.freeze({__proto__:null,base58btc:fl,base58flickr:gl});const Dl=Xe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ml=Xe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),El=Xe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),wl=Xe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var _l=Object.freeze({__proto__:null,base64:Dl,base64pad:ml,base64url:El,base64urlpad:wl});const Kn=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),bl=Kn.reduce((t,e,i)=>(t[i]=e,t),[]),vl=Kn.reduce((t,e,i)=>(t[e.codePointAt(0)]=i,t),[]);function Sl(t){return t.reduce((e,i)=>(e+=bl[i],e),"")}function Ol(t){const e=[];for(const i of t){const s=vl[i.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${i}`);e.push(s)}return new Uint8Array(e)}const Cl=Mi({prefix:"\u{1F680}",name:"base256emoji",encode:Sl,decode:Ol});var Il=Object.freeze({__proto__:null,base256emoji:Cl}),Nl=Bn,Fn=128,Tl=127,Al=~Tl,Ul=Math.pow(2,31);function Bn(t,e,i){e=e||[],i=i||0;for(var s=i;t>=Ul;)e[i++]=t&255|Fn,t/=128;for(;t&Al;)e[i++]=t&255|Fn,t>>>=7;return e[i]=t|0,Bn.bytes=i-s+1,e}var Pl=As,Rl=128,Hn=127;function As(t,s){var i=0,s=s||0,r=0,h=s,y,u=t.length;do{if(h>=u)throw As.bytes=0,new RangeError("Could not decode varint");y=t[h++],i+=r<28?(y&Hn)<<r:(y&Hn)*Math.pow(2,r),r+=7}while(y>=Rl);return As.bytes=h-s,i}var xl=Math.pow(2,7),Ll=Math.pow(2,14),Ml=Math.pow(2,21),jl=Math.pow(2,28),kl=Math.pow(2,35),zl=Math.pow(2,42),$l=Math.pow(2,49),Kl=Math.pow(2,56),Fl=Math.pow(2,63),Bl=function(t){return t<xl?1:t<Ll?2:t<Ml?3:t<jl?4:t<kl?5:t<zl?6:t<$l?7:t<Kl?8:t<Fl?9:10},Hl={encode:Nl,decode:Pl,encodingLength:Bl},Vn=Hl;const qn=(t,e,i=0)=>(Vn.encode(t,e,i),e),Gn=t=>Vn.encodingLength(t),Us=(t,e)=>{const i=e.byteLength,s=Gn(t),r=s+Gn(i),h=new Uint8Array(r+i);return qn(t,h,0),qn(i,h,s),h.set(e,r),new Vl(t,i,e,h)};class Vl{constructor(e,i,s,r){this.code=e,this.size=i,this.digest=s,this.bytes=r}}const Wn=({name:t,code:e,encode:i})=>new ql(t,e,i);class ql{constructor(e,i,s){this.name=e,this.code=i,this.encode=s}digest(e){if(e instanceof Uint8Array){const i=this.encode(e);return i instanceof Uint8Array?Us(this.code,i):i.then(s=>Us(this.code,s))}else throw Error("Unknown type, must be binary type")}}const Yn=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Gl=Wn({name:"sha2-256",code:18,encode:Yn("SHA-256")}),Wl=Wn({name:"sha2-512",code:19,encode:Yn("SHA-512")});var Yl=Object.freeze({__proto__:null,sha256:Gl,sha512:Wl});const Xn=0,Xl="identity",Jn=zn;var Jl=Object.freeze({__proto__:null,identity:{code:Xn,name:Xl,encode:Jn,digest:t=>Us(Xn,Jn(t))}});new TextEncoder,new TextDecoder;const Zn={...Vh,...Gh,...Yh,...Jh,...el,...hl,...pl,...yl,..._l,...Il};({...Yl,...Jl});function Zl(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Qn(t,e,i,s){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:i},decoder:{decode:s}}}const eo=Qn("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Ps=Qn("ascii","a",t=>{let e="a";for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},t=>{t=t.substring(1);const e=Zl(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}),Ql={utf8:eo,"utf-8":eo,hex:Zn.base16,latin1:Ps,ascii:Ps,binary:Ps,...Zn};function ed(t,e="utf8"){const i=Ql[e];if(!i)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):i.decoder.decode(`${i.prefix}${t}`)}const to="wc",td=2,Rs="core",Nt=`${to}@${2}:${Rs}:`,id={name:Rs,logger:"error"},sd={database:":memory:"},rd="crypto",io="client_ed25519_seed",nd=J.ONE_DAY,od="keychain",ad="0.3",cd="messages",ud="0.3",hd=J.SIX_HOURS,ld="publisher",so="irn",dd="error",pd="wss://relay.walletconnect.com",fd="relayer",Qe={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},gd="_subscription",ji={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},ro=J.ONE_SECOND,yd="2.3.2",Dd="0.3",Et={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},md="subscription",Ed="0.3",wd=J.FIVE_SECONDS*1e3,_d="pairing",bd="0.3",gi={wc_pairingDelete:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:J.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:J.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:J.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:J.ONE_DAY,prompt:!1,tag:0},res:{ttl:J.ONE_DAY,prompt:!1,tag:0}}},wt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},vd="history",Sd="0.3",Od="expirer",ct={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Cd="0.3";let Id=class{constructor(t,e){this.core=t,this.logger=e,this.keychain=new Map,this.name=od,this.version=ad,this.initialized=!1,this.storagePrefix=Nt,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()},this.get=i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:r}=Oe("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(r)}return s},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=t,this.logger=Se.generateChildLogger(e,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,An(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Un(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=Oe("NOT_INITIALIZED",this.name);throw new Error(t)}}};class Nd{constructor(e,i,s){this.core=e,this.logger=i,this.name=rd,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=r=>(this.isInitialized(),this.keychain.has(r)),this.getClientId=async()=>{this.isInitialized();const r=await this.getClientSeed(),h=sn(r);return tn(h.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const r=Bu();return this.setPrivateKey(r.publicKey,r.privateKey)},this.signJWT=async r=>{this.isInitialized();const h=await this.getClientSeed(),y=sn(h),u=bs();return await pu(u,r,nd,y)},this.generateSharedKey=(r,h,y)=>{this.isInitialized();const u=this.getPrivateKey(r),g=Hu(u,h);return this.setSymKey(g,y)},this.setSymKey=async(r,h)=>{this.isInitialized();const y=h||Vu(r);return await this.keychain.set(y,r),y},this.deleteKeyPair=async r=>{this.isInitialized(),await this.keychain.del(r)},this.deleteSymKey=async r=>{this.isInitialized(),await this.keychain.del(r)},this.encode=async(r,h,y)=>{this.isInitialized();const u=Sn(y),g=qs(h);if(On(u)){const A=u.senderPublicKey,v=u.receiverPublicKey;r=await this.generateSharedKey(A,v)}const E=this.getSymKey(r),{type:D,senderPublicKey:b}=u;return Gu({type:D,symKey:E,message:g,senderPublicKey:b})},this.decode=async(r,h,y)=>{this.isInitialized();const u=Xu(h,y);if(On(u)){const D=u.receiverPublicKey,b=u.senderPublicKey;r=await this.generateSharedKey(D,b)}const g=this.getSymKey(r),E=Wu({symKey:g,encoded:h});return qo(E)},this.core=e,this.logger=Se.generateChildLogger(i,this.name),this.keychain=s||new Id(this.core,this.logger)}get context(){return Se.getLoggerContext(this.logger)}getPayloadType(e){const i=Ss(e);return li(i.type)}async setPrivateKey(e,i){return await this.keychain.set(e,i),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(io)}catch{e=bs(),await this.keychain.set(io,e)}return ed(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}}let Td=class extends va{constructor(t,e){super(t,e),this.logger=t,this.core=e,this.messages=new Map,this.name=cd,this.version=ud,this.initialized=!1,this.storagePrefix=Nt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,s)=>{this.isInitialized();const r=vs(s);let h=this.messages.get(i);return typeof h>"u"&&(h={}),typeof h[r]<"u"||(h[r]=s,this.messages.set(i,h),await this.persist()),r},this.get=i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s},this.has=(i,s)=>{this.isInitialized();const r=this.get(i),h=vs(s);return typeof r[h]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=Se.generateChildLogger(t,this.name),this.core=e}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,An(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Un(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=Oe("NOT_INITIALIZED",this.name);throw new Error(t)}}};class Ad extends Sa{constructor(e,i){super(e,i),this.relayer=e,this.logger=i,this.events=new lt.EventEmitter,this.name=ld,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(s,r,h)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:r,opts:h}});try{const y=(h==null?void 0:h.ttl)||hd,u=Is(h),g=(h==null?void 0:h.prompt)||!1,E=(h==null?void 0:h.tag)||0,D={topic:s,message:r,opts:{ttl:y,relay:u,prompt:g,tag:E}},b=vs(r);this.queue.set(b,D);try{await await Rn(this.rpcPublish(s,r,y,u,g,E),this.publishTimeout),this.relayer.events.emit(Qe.publish,D)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(Qe.connection_stalled);return}this.onPublish(b,D),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:r,opts:h}})}catch(y){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(y),y}},this.on=(s,r)=>{this.events.on(s,r)},this.once=(s,r)=>{this.events.once(s,r)},this.off=(s,r)=>{this.events.off(s,r)},this.removeListener=(s,r)=>{this.events.removeListener(s,r)},this.relayer=e,this.logger=Se.generateChildLogger(i,this.name),this.registerEventListeners()}get context(){return Se.getLoggerContext(this.logger)}rpcPublish(e,i,s,r,h,y){var u,g,E,D;const b={method:Ns(r.protocol).publish,params:{topic:e,message:i,ttl:s,prompt:h,tag:y}};return xi((u=b.params)==null?void 0:u.prompt)&&((g=b.params)==null||delete g.prompt),xi((E=b.params)==null?void 0:E.tag)&&((D=b.params)==null||delete D.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:b}),this.relayer.provider.request(b)}onPublish(e,i){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:i,message:s,opts:r}=e;await this.publish(i,s,r)})}registerEventListeners(){this.relayer.core.heartbeat.on(si.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}class Ud{constructor(){this.map=new Map,this.set=(e,i)=>{const s=this.get(e);this.exists(e,i)||this.map.set(e,[...s,i])},this.get=e=>this.map.get(e)||[],this.exists=(e,i)=>this.get(e).includes(i),this.delete=(e,i)=>{if(typeof i>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const s=this.get(e);if(!this.exists(e,i))return;const r=s.filter(h=>h!==i);if(!r.length){this.map.delete(e);return}this.map.set(e,r)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Pd=Object.defineProperty,Rd=Object.defineProperties,xd=Object.getOwnPropertyDescriptors,no=Object.getOwnPropertySymbols,Ld=Object.prototype.hasOwnProperty,Md=Object.prototype.propertyIsEnumerable,oo=(t,e,i)=>e in t?Pd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,ki=(t,e)=>{for(var i in e||(e={}))Ld.call(e,i)&&oo(t,i,e[i]);if(no)for(var i of no(e))Md.call(e,i)&&oo(t,i,e[i]);return t},xs=(t,e)=>Rd(t,xd(e));class jd extends Ia{constructor(e,i){super(e,i),this.relayer=e,this.logger=i,this.subscriptions=new Map,this.topicMap=new Ud,this.events=new lt.EventEmitter,this.name=md,this.version=Ed,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pendingSubInterval=20,this.storagePrefix=Nt,this.subscribeTimeout=1e4,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable())},this.subscribe=async(s,r)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:r}});try{const h=Is(r),y={topic:s,relay:h};this.pending.set(s,y);const u=await this.rpcSubscribe(s,h);return this.onSubscribe(u,y),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:r}}),u}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}},this.unsubscribe=async(s,r)=>{this.isInitialized(),typeof(r==null?void 0:r.id)<"u"?await this.unsubscribeById(s,r.id,r):await this.unsubscribeByTopic(s,r)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((r,h)=>{const y=new J.Watch;y.start(this.pendingSubscriptionWatchLabel);const u=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(u),y.stop(this.pendingSubscriptionWatchLabel),r(!0)),y.elapsed(this.pendingSubscriptionWatchLabel)>=wd&&(clearInterval(u),y.stop(this.pendingSubscriptionWatchLabel),h(!1))},this.pendingSubInterval)}),this.on=(s,r)=>{this.events.on(s,r)},this.once=(s,r)=>{this.events.once(s,r)},this.off=(s,r)=>{this.events.off(s,r)},this.removeListener=(s,r)=>{this.events.removeListener(s,r)},this.restart=async()=>{await this.restore(),await this.reset()},this.relayer=e,this.logger=Se.generateChildLogger(i,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,i){let s=!1;try{s=this.getSubscription(e).topic===i}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.initialized=!1}async unsubscribeByTopic(e,i){const s=this.topicMap.get(e);await Promise.all(s.map(async r=>await this.unsubscribeById(e,r,i)))}async unsubscribeById(e,i,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:i,opts:s}});try{const r=Is(s);await this.rpcUnsubscribe(e,i,r);const h=pi("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,i,h),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:i,opts:s}})}catch(r){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(r),r}}async rpcSubscribe(e,i){const s={method:Ns(i.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});let r;try{r=await await Rn(this.relayer.provider.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Qe.connection_stalled)}return r}rpcUnsubscribe(e,i,s){const r={method:Ns(s.protocol).unsubscribe,params:{topic:e,id:i}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),this.relayer.provider.request(r)}onSubscribe(e,i){this.setSubscription(e,xs(ki({},i),{id:e})),this.pending.delete(i.topic)}onResubscribe(e,i){this.addSubscription(e,xs(ki({},i),{id:e})),this.pending.delete(i.topic)}async onUnsubscribe(e,i,s){this.events.removeAllListeners(i),this.hasSubscription(i,e)&&this.deleteSubscription(i,s),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,i){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:i}),this.addSubscription(e,i))}addSubscription(e,i){this.subscriptions.set(e,ki({},i)),this.topicMap.set(i.topic,e),this.events.emit(Et.created,i)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const i=this.subscriptions.get(e);if(!i){const{message:s}=Oe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return i}deleteSubscription(e,i){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:i});const s=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(s.topic,e),this.events.emit(Et.deleted,xs(ki({},s),{reason:i}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Et.sync)}async reset(){this.cached.length&&await Promise.all(this.cached.map(async e=>await this.resubscribe(e))),this.events.emit(Et.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:i}=Oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async resubscribe(e){if(!this.ids.includes(e.id)){const{topic:i,relay:s}=e,r={topic:i,relay:s};this.pending.set(r.topic,r);const h=await this.rpcSubscribe(r.topic,r.relay);this.onResubscribe(h,r)}}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}checkPending(){this.relayer.transportExplicitlyClosed||this.pending.forEach(async e=>{const i=await this.rpcSubscribe(e.topic,e.relay);this.onSubscribe(i,e)})}registerEventListeners(){this.relayer.core.heartbeat.on(si.HEARTBEAT_EVENTS.pulse,()=>{this.checkPending()}),this.relayer.on(Qe.connect,async()=>{await this.onConnect()}),this.relayer.on(Qe.disconnect,()=>{this.onDisconnect()}),this.events.on(Et.created,async e=>{const i=Et.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:e}),await this.persist()}),this.events.on(Et.deleted,async e=>{const i=Et.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}}var kd=Object.defineProperty,ao=Object.getOwnPropertySymbols,zd=Object.prototype.hasOwnProperty,$d=Object.prototype.propertyIsEnumerable,co=(t,e,i)=>e in t?kd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Kd=(t,e)=>{for(var i in e||(e={}))zd.call(e,i)&&co(t,i,e[i]);if(ao)for(var i of ao(e))$d.call(e,i)&&co(t,i,e[i]);return t};let Fd=class extends Oa{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new lt.EventEmitter,this.name=fd,this.transportExplicitlyClosed=!1,this.initialized=!1,this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Se.generateChildLogger(t.logger,this.name):bi(Se.getDefaultLoggerOptions({level:t.logger||dd})),this.messages=new Td(this.logger,t.core),this.subscriber=new jd(this,this.logger),this.publisher=new Ad(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||pd,this.projectId=t.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.provider=await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return Se.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,e,i){this.isInitialized(),await this.publisher.publish(t,e,i),await this.recordMessageEvent({topic:t,message:e})}async subscribe(t,e){this.isInitialized();let i="";return await Promise.all([new Promise(s=>{this.subscriber.once(Et.created,r=>{r.topic===t&&s()})}),new Promise(async s=>{i=await this.subscriber.subscribe(t,e),s()})]),i}async unsubscribe(t,e){this.isInitialized(),await this.subscriber.unsubscribe(t,e)}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}off(t,e){this.events.off(t,e)}removeListener(t,e){this.events.removeListener(t,e)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(Qe.transport_closed))}async transportOpen(t){this.relayUrl=t||this.relayUrl,this.transportExplicitlyClosed=!1;try{await Promise.all([new Promise(e=>{this.initialized||e(),this.subscriber.once(Et.resubscribed,()=>{e()})}),await Promise.race([this.provider.connect(),new Promise((e,i)=>this.once(Qe.transport_closed,()=>{i(new Error("closeTransport called before connection was established"))}))])])}catch(e){const i=e;if(!/socket hang up/i.test(i.message))throw new Error(i.message);this.logger.error(i),this.events.emit(Qe.transport_closed)}}async restartTransport(t){await this.transportClose(),await new Promise(e=>setTimeout(e,ro)),await this.transportOpen(t)}async createProvider(){const t=await this.core.crypto.signJWT(this.relayUrl);return new _i(new Uh(uh({sdkVersion:yd,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t})))}async recordMessageEvent(t){const{topic:e,message:i}=t;await this.messages.set(e,i)}async shouldIgnoreMessageEvent(t){const{topic:e,message:i}=t;return await this.subscriber.isSubscribed(e)?this.messages.has(e,i):!0}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),Zs(t)){if(!t.method.endsWith(gd))return;const e=t.params,{topic:i,message:s}=e.data,r={topic:i,message:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Kd({type:"event",event:e.id},r)),this.events.emit(e.id,r),await this.acknowledgePayload(t),await this.onMessageEvent(r)}}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Qe.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const e=Qs(t.id,!0);await this.provider.connection.send(e)}registerEventListeners(){this.provider.on(ji.payload,t=>this.onProviderPayload(t)),this.provider.on(ji.connect,()=>{this.events.emit(Qe.connect)}),this.provider.on(ji.disconnect,()=>{this.events.emit(Qe.disconnect),this.attemptToReconnect()}),this.provider.on(ji.error,t=>this.events.emit(Qe.error,t)),this.events.on(Qe.connection_stalled,async()=>{await this.restartTransport()})}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.transportOpen()},J.toMiliseconds(ro))}isInitialized(){if(!this.initialized){const{message:t}=Oe("NOT_INITIALIZED",this.name);throw new Error(t)}}};var Bd=Object.defineProperty,uo=Object.getOwnPropertySymbols,Hd=Object.prototype.hasOwnProperty,Vd=Object.prototype.propertyIsEnumerable,ho=(t,e,i)=>e in t?Bd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,lo=(t,e)=>{for(var i in e||(e={}))Hd.call(e,i)&&ho(t,i,e[i]);if(uo)for(var i of uo(e))Vd.call(e,i)&&ho(t,i,e[i]);return t};class zi extends Ca{constructor(e,i,s,r=Nt,h=void 0){super(e,i,s,r),this.core=e,this.logger=i,this.name=s,this.map=new Map,this.version=Dd,this.cached=[],this.initialized=!1,this.storagePrefix=Nt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(y=>{Ch(y)?this.map.set(y.id,y):Ih(y)?this.map.set(y.topic,y):this.getKey&&y!==null&&!xi(y)&&this.map.set(this.getKey(y),y)}),this.cached=[],this.initialized=!0)},this.set=async(y,u)=>{this.isInitialized(),this.map.has(y)?await this.update(y,u):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:y,value:u}),this.map.set(y,u),await this.persist())},this.get=y=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:y}),this.getData(y)),this.getAll=y=>(this.isInitialized(),y?this.values.filter(u=>Object.keys(y).every(g=>Li(u[g],y[g]))):this.values),this.update=async(y,u)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:y,update:u});const g=lo(lo({},this.getData(y)),u);this.map.set(y,g),await this.persist()},this.delete=async(y,u)=>{this.isInitialized(),this.map.has(y)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:y,reason:u}),this.map.delete(y),await this.persist())},this.logger=Se.generateChildLogger(i,this.name),this.storagePrefix=r,this.getKey=h}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const i=this.map.get(e);if(!i){const{message:s}=Oe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}return i}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:i}=Oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class qd{constructor(e,i){this.core=e,this.logger=i,this.name=_d,this.version=bd,this.events=new lt,this.initialized=!1,this.storagePrefix=Nt,this.ignoredPayloadTypes=[Xt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=bs(),r=await this.core.crypto.setSymKey(s),h=Os(J.FIVE_MINUTES),y={protocol:so},u={topic:r,expiry:h,relay:y,active:!1},g=bh({protocol:this.core.protocol,version:this.core.version,topic:r,symKey:s,relay:y});return await this.pairings.set(r,u),await this.core.relayer.subscribe(r),this.core.expirer.set(r,h),{topic:r,uri:g}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:r,symKey:h,relay:y}=wh(s.uri),u=Os(J.FIVE_MINUTES),g={topic:r,relay:y,expiry:u,active:!1};return await this.pairings.set(r,g),await this.core.crypto.setSymKey(h,r),await this.core.relayer.subscribe(r,{relay:y}),this.core.expirer.set(r,u),s.activatePairing&&await this.activate({topic:r}),g},this.activate=async({topic:s})=>{this.isInitialized();const r=Os(J.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:r}),this.core.expirer.set(s,r)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:r}=s;if(this.pairings.keys.includes(r)){const h=await this.sendRequest(r,"wc_pairingPing",{}),{done:y,resolve:u,reject:g}=hh();this.events.once(Cs("pairing_ping",h),({error:E})=>{E?g(E):u()}),await y()}},this.updateExpiry=async({topic:s,expiry:r})=>{this.isInitialized(),await this.pairings.update(s,{expiry:r})},this.updateMetadata=async({topic:s,metadata:r})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:r})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:r}=s;this.pairings.keys.includes(r)&&(await this.sendRequest(r,"wc_pairingDelete",pi("USER_DISCONNECTED")),await this.deletePairing(r))},this.sendRequest=async(s,r,h)=>{const y=er(r,h),u=await this.core.crypto.encode(s,y),g=gi[r].req;return this.core.history.set(s,y),await this.core.relayer.publish(s,u,g),y.id},this.sendResult=async(s,r,h)=>{const y=Qs(s,h),u=await this.core.crypto.encode(r,y),g=await this.core.history.get(r,s),E=gi[g.request.method].res;await this.core.relayer.publish(r,u,E),await this.core.history.resolve(y)},this.sendError=async(s,r,h)=>{const y=Js(s,h),u=await this.core.crypto.encode(r,y),g=await this.core.history.get(r,s),E=gi[g.request.method]?gi[g.request.method].res:gi.unregistered_method.res;await this.core.relayer.publish(r,u,E),await this.core.history.resolve(y)},this.deletePairing=async(s,r)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,pi("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),r?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(r=>Pn(r.expiry));await Promise.all(s.map(r=>this.deletePairing(r.topic)))},this.onRelayEventRequest=s=>{const{topic:r,payload:h}=s,y=h.method;if(this.pairings.keys.includes(r))switch(y){case"wc_pairingPing":return this.onPairingPingRequest(r,h);case"wc_pairingDelete":return this.onPairingDeleteRequest(r,h);default:return this.onUnknownRpcMethodRequest(r,h)}},this.onRelayEventResponse=async s=>{const{topic:r,payload:h}=s,y=(await this.core.history.get(r,h.id)).request.method;if(this.pairings.keys.includes(r))switch(y){case"wc_pairingPing":return this.onPairingPingResponse(r,h);default:return this.onUnknownRpcMethodResponse(y)}},this.onPairingPingRequest=async(s,r)=>{const{id:h}=r;try{this.isValidPing({topic:s}),await this.sendResult(h,s,!0),this.events.emit("pairing_ping",{id:h,topic:s})}catch(y){await this.sendError(h,s,y),this.logger.error(y)}},this.onPairingPingResponse=(s,r)=>{const{id:h}=r;setTimeout(()=>{Lt(r)?this.events.emit(Cs("pairing_ping",h),{}):Ct(r)&&this.events.emit(Cs("pairing_ping",h),{error:r.error})},500)},this.onPairingDeleteRequest=async(s,r)=>{const{id:h}=r;try{this.isValidDisconnect({topic:s}),await this.sendResult(h,s,!0),await this.deletePairing(s),this.events.emit("pairing_delete",{id:h,topic:s})}catch(y){await this.sendError(h,s,y),this.logger.error(y)}},this.onUnknownRpcMethodRequest=async(s,r)=>{const{id:h,method:y}=r;try{if(this.registeredMethods.includes(y))return;const u=pi("WC_METHOD_UNSUPPORTED",y);await this.sendError(h,s,u),this.logger.error(u)}catch(u){await this.sendError(h,s,u),this.logger.error(u)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(pi("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{if(!Ts(s)){const{message:r}=Oe("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(r)}if(!Oh(s.uri)){const{message:r}=Oe("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(r)}},this.isValidPing=async s=>{if(!Ts(s)){const{message:h}=Oe("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(h)}const{topic:r}=s;await this.isValidPairingTopic(r)},this.isValidDisconnect=async s=>{if(!Ts(s)){const{message:h}=Oe("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(h)}const{topic:r}=s;await this.isValidPairingTopic(r)},this.isValidPairingTopic=async s=>{if(!jn(s,!1)){const{message:r}=Oe("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(r)}if(!this.pairings.keys.includes(s)){const{message:r}=Oe("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(r)}if(Pn(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:r}=Oe("EXPIRED",`pairing topic: ${s}`);throw new Error(r)}},this.core=e,this.logger=Se.generateChildLogger(i,this.name),this.pairings=new zi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Se.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Qe.message,async e=>{const{topic:i,message:s}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const r=await this.core.crypto.decode(i,s);Zs(r)?(this.core.history.set(i,r),this.onRelayEventRequest({topic:i,payload:r})):Go(r)&&(await this.core.history.resolve(r),this.onRelayEventResponse({topic:i,payload:r}))})}registerExpirerEvents(){this.core.expirer.on(ct.expired,async e=>{const{topic:i}=ph(e.target);i&&this.pairings.keys.includes(i)&&(await this.deletePairing(i,!0),this.events.emit("pairing_expire",{topic:i}))})}}class Gd extends ba{constructor(e,i){super(e,i),this.core=e,this.logger=i,this.records=new Map,this.events=new lt.EventEmitter,this.name=vd,this.version=Sd,this.cached=[],this.initialized=!1,this.storagePrefix=Nt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,r,h)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:r,chainId:h}),this.records.has(r.id))return;const y={id:r.id,topic:s,request:{method:r.method,params:r.params||null},chainId:h};this.records.set(y.id,y),this.events.emit(wt.created,y)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const r=await this.getRecord(s.id);typeof r.response>"u"&&(r.response=Ct(s)?{error:s.error}:{result:s.result},this.records.set(r.id,r),this.events.emit(wt.updated,r))},this.get=async(s,r)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:r}),await this.getRecord(r)),this.delete=(s,r)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:r}),this.values.forEach(h=>{if(h.topic===s){if(typeof r<"u"&&h.id!==r)return;this.records.delete(h.id),this.events.emit(wt.deleted,h)}})},this.exists=async(s,r)=>(this.isInitialized(),this.records.has(r)?(await this.getRecord(r)).topic===s:!1),this.on=(s,r)=>{this.events.on(s,r)},this.once=(s,r)=>{this.events.once(s,r)},this.off=(s,r)=>{this.events.off(s,r)},this.removeListener=(s,r)=>{this.events.removeListener(s,r)},this.logger=Se.generateChildLogger(i,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(i=>{if(typeof i.response<"u")return;const s={topic:i.topic,request:er(i.request.method,i.request.params,i.id),chainId:i.chainId};return e.push(s)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const i=this.records.get(e);if(!i){const{message:s}=Oe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return i}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(wt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:i}=Oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(wt.created,e=>{const i=wt.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:e}),this.persist()}),this.events.on(wt.updated,e=>{const i=wt.updated;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:e}),this.persist()}),this.events.on(wt.deleted,e=>{const i=wt.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Wd extends Na{constructor(e,i){super(e,i),this.core=e,this.logger=i,this.expirations=new Map,this.events=new lt.EventEmitter,this.name=Od,this.version=Cd,this.cached=[],this.initialized=!1,this.storagePrefix=Nt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const r=this.formatTarget(s);return typeof this.getExpiration(r)<"u"}catch{return!1}},this.set=(s,r)=>{this.isInitialized();const h=this.formatTarget(s),y={target:h,expiry:r};this.expirations.set(h,y),this.checkExpiry(h,y),this.events.emit(ct.created,{target:h,expiration:y})},this.get=s=>{this.isInitialized();const r=this.formatTarget(s);return this.getExpiration(r)},this.del=s=>{if(this.isInitialized(),this.has(s)){const r=this.formatTarget(s),h=this.getExpiration(r);this.expirations.delete(r),this.events.emit(ct.deleted,{target:r,expiration:h})}},this.on=(s,r)=>{this.events.on(s,r)},this.once=(s,r)=>{this.events.once(s,r)},this.off=(s,r)=>{this.events.off(s,r)},this.removeListener=(s,r)=>{this.events.removeListener(s,r)},this.logger=Se.generateChildLogger(i,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return lh(e);if(typeof e=="number")return dh(e);const{message:i}=Oe("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(i)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(ct.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:i}=Oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const i=this.expirations.get(e);if(!i){const{message:s}=Oe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}return i}checkExpiry(e,i){const{expiry:s}=i;J.toMiliseconds(s)-Date.now()<=0&&this.expire(e,i)}expire(e,i){this.expirations.delete(e),this.events.emit(ct.expired,{target:e,expiration:i})}checkExpirations(){this.expirations.forEach((e,i)=>this.checkExpiry(i,e))}registerEventListeners(){this.core.heartbeat.on(si.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(ct.created,e=>{const i=ct.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:e}),this.persist()}),this.events.on(ct.expired,e=>{const i=ct.expired;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:e}),this.persist()}),this.events.on(ct.deleted,e=>{const i=ct.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=Oe("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Yd=Object.defineProperty,po=Object.getOwnPropertySymbols,Xd=Object.prototype.hasOwnProperty,Jd=Object.prototype.propertyIsEnumerable,fo=(t,e,i)=>e in t?Yd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,go=(t,e)=>{for(var i in e||(e={}))Xd.call(e,i)&&fo(t,i,e[i]);if(po)for(var i of po(e))Jd.call(e,i)&&fo(t,i,e[i]);return t};class Ls extends _a{constructor(e){super(e),this.protocol=to,this.version=td,this.name=Rs,this.events=new lt.EventEmitter,this.initialized=!1,this.on=(s,r)=>this.events.on(s,r),this.once=(s,r)=>this.events.once(s,r),this.off=(s,r)=>this.events.off(s,r),this.removeListener=(s,r)=>this.events.removeListener(s,r),this.projectId=e==null?void 0:e.projectId;const i=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:bi(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||id.logger}));this.logger=Se.generateChildLogger(i,this.name),this.heartbeat=new si.HeartBeat,this.crypto=new Nd(this,this.logger,e==null?void 0:e.keychain),this.history=new Gd(this,this.logger),this.expirer=new Wd(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new oa(go(go({},sd),e==null?void 0:e.storageOptions)),this.relayer=new Fd({core:this,logger:this.logger,relayUrl:e==null?void 0:e.relayUrl,projectId:this.projectId}),this.pairing=new qd(this,this.logger)}static async init(e){const i=new Ls(e);return await i.initialize(),i}get context(){return Se.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const Zd=Ls;let Qd=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},ep=class{constructor(t){this.client=t}};var Ms={};Object.defineProperty(Ms,"__esModule",{value:!0});var yo=Ms.getWindowMetadata=void 0;const Do=Gs;function tp(){let t,e;try{t=Do.getDocumentOrThrow(),e=Do.getLocationOrThrow()}catch{return null}function i(){const D=t.getElementsByTagName("link"),b=[];for(let A=0;A<D.length;A++){const v=D[A],I=v.getAttribute("rel");if(I&&I.toLowerCase().indexOf("icon")>-1){const _=v.getAttribute("href");if(_)if(_.toLowerCase().indexOf("https:")===-1&&_.toLowerCase().indexOf("http:")===-1&&_.indexOf("//")!==0){let R=e.protocol+"//"+e.host;if(_.indexOf("/")===0)R+=_;else{const k=e.pathname.split("/");k.pop();const a=k.join("/");R+=a+"/"+_}b.push(R)}else if(_.indexOf("//")===0){const R=e.protocol+_;b.push(R)}else b.push(_)}}return b}function s(...D){const b=t.getElementsByTagName("meta");for(let A=0;A<b.length;A++){const v=b[A],I=["itemprop","property","name"].map(_=>v.getAttribute(_)).filter(_=>_?D.includes(_):!1);if(I.length&&I){const _=v.getAttribute("content");if(_)return _}}return""}function r(){let D=s("name","og:site_name","og:title","twitter:title");return D||(D=t.title),D}function h(){return s("description","og:description","twitter:description","keywords")}const y=r(),u=h(),g=e.origin,E=i();return{description:u,url:g,icons:E,name:y}}yo=Ms.getWindowMetadata=tp;var ip={};(function(t){const e=Ys,i=Xs,s=Ws,r=Ds,h=a=>a==null,y=Symbol("encodeFragmentIdentifier");function u(a){switch(a.arrayFormat){case"index":return f=>(d,p)=>{const c=d.length;return p===void 0||a.skipNull&&p===null||a.skipEmptyString&&p===""?d:p===null?[...d,[D(f,a),"[",c,"]"].join("")]:[...d,[D(f,a),"[",D(c,a),"]=",D(p,a)].join("")]};case"bracket":return f=>(d,p)=>p===void 0||a.skipNull&&p===null||a.skipEmptyString&&p===""?d:p===null?[...d,[D(f,a),"[]"].join("")]:[...d,[D(f,a),"[]=",D(p,a)].join("")];case"colon-list-separator":return f=>(d,p)=>p===void 0||a.skipNull&&p===null||a.skipEmptyString&&p===""?d:p===null?[...d,[D(f,a),":list="].join("")]:[...d,[D(f,a),":list=",D(p,a)].join("")];case"comma":case"separator":case"bracket-separator":{const f=a.arrayFormat==="bracket-separator"?"[]=":"=";return d=>(p,c)=>c===void 0||a.skipNull&&c===null||a.skipEmptyString&&c===""?p:(c=c===null?"":c,p.length===0?[[D(d,a),f,D(c,a)].join("")]:[[p,D(c,a)].join(a.arrayFormatSeparator)])}default:return f=>(d,p)=>p===void 0||a.skipNull&&p===null||a.skipEmptyString&&p===""?d:p===null?[...d,D(f,a)]:[...d,[D(f,a),"=",D(p,a)].join("")]}}function g(a){let f;switch(a.arrayFormat){case"index":return(d,p,c)=>{if(f=/\[(\d*)\]$/.exec(d),d=d.replace(/\[\d*\]$/,""),!f){c[d]=p;return}c[d]===void 0&&(c[d]={}),c[d][f[1]]=p};case"bracket":return(d,p,c)=>{if(f=/(\[\])$/.exec(d),d=d.replace(/\[\]$/,""),!f){c[d]=p;return}if(c[d]===void 0){c[d]=[p];return}c[d]=[].concat(c[d],p)};case"colon-list-separator":return(d,p,c)=>{if(f=/(:list)$/.exec(d),d=d.replace(/:list$/,""),!f){c[d]=p;return}if(c[d]===void 0){c[d]=[p];return}c[d]=[].concat(c[d],p)};case"comma":case"separator":return(d,p,c)=>{const n=typeof p=="string"&&p.includes(a.arrayFormatSeparator),l=typeof p=="string"&&!n&&b(p,a).includes(a.arrayFormatSeparator);p=l?b(p,a):p;const P=n||l?p.split(a.arrayFormatSeparator).map(x=>b(x,a)):p===null?p:b(p,a);c[d]=P};case"bracket-separator":return(d,p,c)=>{const n=/(\[\])$/.test(d);if(d=d.replace(/\[\]$/,""),!n){c[d]=p&&b(p,a);return}const l=p===null?[]:p.split(a.arrayFormatSeparator).map(P=>b(P,a));if(c[d]===void 0){c[d]=l;return}c[d]=[].concat(c[d],l)};default:return(d,p,c)=>{if(c[d]===void 0){c[d]=p;return}c[d]=[].concat(c[d],p)}}}function E(a){if(typeof a!="string"||a.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function D(a,f){return f.encode?f.strict?e(a):encodeURIComponent(a):a}function b(a,f){return f.decode?i(a):a}function A(a){return Array.isArray(a)?a.sort():typeof a=="object"?A(Object.keys(a)).sort((f,d)=>Number(f)-Number(d)).map(f=>a[f]):a}function v(a){const f=a.indexOf("#");return f!==-1&&(a=a.slice(0,f)),a}function I(a){let f="";const d=a.indexOf("#");return d!==-1&&(f=a.slice(d)),f}function _(a){a=v(a);const f=a.indexOf("?");return f===-1?"":a.slice(f+1)}function R(a,f){return f.parseNumbers&&!Number.isNaN(Number(a))&&typeof a=="string"&&a.trim()!==""?a=Number(a):f.parseBooleans&&a!==null&&(a.toLowerCase()==="true"||a.toLowerCase()==="false")&&(a=a.toLowerCase()==="true"),a}function k(a,f){f=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},f),E(f.arrayFormatSeparator);const d=g(f),p=Object.create(null);if(typeof a!="string"||(a=a.trim().replace(/^[?#&]/,""),!a))return p;for(const c of a.split("&")){if(c==="")continue;let[n,l]=s(f.decode?c.replace(/\+/g," "):c,"=");l=l===void 0?null:["comma","separator","bracket-separator"].includes(f.arrayFormat)?l:b(l,f),d(b(n,f),l,p)}for(const c of Object.keys(p)){const n=p[c];if(typeof n=="object"&&n!==null)for(const l of Object.keys(n))n[l]=R(n[l],f);else p[c]=R(n,f)}return f.sort===!1?p:(f.sort===!0?Object.keys(p).sort():Object.keys(p).sort(f.sort)).reduce((c,n)=>{const l=p[n];return Boolean(l)&&typeof l=="object"&&!Array.isArray(l)?c[n]=A(l):c[n]=l,c},Object.create(null))}t.extract=_,t.parse=k,t.stringify=(a,f)=>{if(!a)return"";f=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},f),E(f.arrayFormatSeparator);const d=l=>f.skipNull&&h(a[l])||f.skipEmptyString&&a[l]==="",p=u(f),c={};for(const l of Object.keys(a))d(l)||(c[l]=a[l]);const n=Object.keys(c);return f.sort!==!1&&n.sort(f.sort),n.map(l=>{const P=a[l];return P===void 0?"":P===null?D(l,f):Array.isArray(P)?P.length===0&&f.arrayFormat==="bracket-separator"?D(l,f)+"[]":P.reduce(p(l),[]).join("&"):D(l,f)+"="+D(P,f)}).filter(l=>l.length>0).join("&")},t.parseUrl=(a,f)=>{f=Object.assign({decode:!0},f);const[d,p]=s(a,"#");return Object.assign({url:d.split("?")[0]||"",query:k(_(a),f)},f&&f.parseFragmentIdentifier&&p?{fragmentIdentifier:b(p,f)}:{})},t.stringifyUrl=(a,f)=>{f=Object.assign({encode:!0,strict:!0,[y]:!0},f);const d=v(a.url).split("?")[0]||"",p=t.extract(a.url),c=t.parse(p,{sort:!1}),n=Object.assign(c,a.query);let l=t.stringify(n,f);l&&(l=`?${l}`);let P=I(a.url);return a.fragmentIdentifier&&(P=`#${f[y]?D(a.fragmentIdentifier,f):a.fragmentIdentifier}`),`${d}${l}${P}`},t.pick=(a,f,d)=>{d=Object.assign({parseFragmentIdentifier:!0,[y]:!1},d);const{url:p,query:c,fragmentIdentifier:n}=t.parseUrl(a,d);return t.stringifyUrl({url:p,query:r(c,f),fragmentIdentifier:n},d)},t.exclude=(a,f,d)=>{const p=Array.isArray(f)?c=>!f.includes(c):(c,n)=>!f(c,n);return t.pick(a,p,d)}})(ip);const sp=1;function rp(){return yo()||{name:"",description:"",url:"",icons:[""]}}function Tt(t,e){return t.filter(i=>e.includes(i)).length===t.length}function zt(t,e){return J.fromMiliseconds((e||Date.now())+J.toMiliseconds(t))}function Jt(t){return J.fromMiliseconds(Date.now())>=J.toMiliseconds(t)}function Zt(t){const e=J.toMiliseconds(t||J.FIVE_MINUTES);let i,s,r;return{resolve:h=>{r&&i&&(clearTimeout(r),i(h))},reject:h=>{r&&s&&(clearTimeout(r),s(h))},done:()=>new Promise((h,y)=>{r=setTimeout(y,e),i=h,s=y})}}function np(t){const[e,i]=t.split(":"),s={id:void 0,topic:void 0};if(e==="topic"&&typeof i=="string")s.topic=i;else if(e==="id"&&Number.isInteger(Number(i)))s.id=Number(i);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${i}`);return s}function $e(t,e){return`${t}${e?`:${e}`:""}`}function yi(t){const e=[];return t.forEach(i=>{const[s,r]=i.split(":");e.push(`${s}:${r}`)}),e}function op(t){const e=[];return Object.values(t).forEach(i=>{e.push(...yi(i.accounts))}),e}function ap(t,e){const i=[];return Object.values(t).forEach(s=>{yi(s.accounts).includes(e)&&i.push(...s.methods)}),i}function cp(t,e){const i=[];return Object.values(t).forEach(s=>{yi(s.accounts).includes(e)&&i.push(...s.events)}),i}function up(t,e){const i=Fi(t,e);if(i)throw new Error(i.message);const s={};for(const[r,h]of Object.entries(t))s[r]={methods:h.methods,events:h.events,chains:h.accounts.map(y=>`${y.split(":")[0]}:${y.split(":")[1]}`)};return s}const hp={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},lp={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function ee(t,e){const{message:i,code:s}=lp[t];return{message:e?`${i} ${e}`:i,code:s}}function nt(t,e){const{message:i,code:s}=hp[t];return{message:e?`${i} ${e}`:i,code:s}}function $i(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Ki(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function bt(t){return typeof t>"u"}function it(t,e){return e&&bt(t)?!0:typeof t=="string"&&Boolean(t.trim().length)}function js(t,e){return e&&bt(t)?!0:typeof t=="number"&&!isNaN(t)}function dp(t,e){const{requiredNamespaces:i}=e,s=Object.keys(t.namespaces),r=Object.keys(i);let h=!0;return Tt(r,s)?(s.forEach(y=>{const{accounts:u,methods:g,events:E}=t.namespaces[y],D=yi(u),b=i[y];(!Tt(b.chains,D)||!Tt(b.methods,g)||!Tt(b.events,E))&&(h=!1)}),h):!1}function ks(t){return it(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function pp(t){if(it(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const i=e[0]+":"+e[1];return!!e[2]&&ks(i)}}return!1}function fp(t,e){let i=null;return it(t==null?void 0:t.publicKey,!1)||(i=ee("MISSING_OR_INVALID",`${e} controller public key should be a string`)),i}function mo(t){let e=!0;return $i(t)?t.length&&(e=t.every(i=>it(i,!1))):e=!1,e}function gp(t,e,i){let s=null;return $i(e)?e.forEach(r=>{s||(!ks(r)||!r.includes(t))&&(s=nt("UNSUPPORTED_CHAINS",`${i}, chain ${r} should be a string and conform to "namespace:chainId" format`))}):s=nt("UNSUPPORTED_CHAINS",`${i}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),s}function yp(t,e){let i=null;return Object.entries(t).forEach(([s,r])=>{if(i)return;const h=gp(s,r==null?void 0:r.chains,`${e} requiredNamespace`);h&&(i=h)}),i}function Dp(t,e){let i=null;return $i(t)?t.forEach(s=>{i||pp(s)||(i=nt("UNSUPPORTED_ACCOUNTS",`${e}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):i=nt("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),i}function mp(t,e){let i=null;return Object.values(t).forEach(s=>{if(i)return;const r=Dp(s==null?void 0:s.accounts,`${e} namespace`);r&&(i=r)}),i}function Ep(t,e){let i=null;return mo(t==null?void 0:t.methods)?mo(t==null?void 0:t.events)||(i=nt("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):i=nt("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),i}function Eo(t,e){let i=null;return Object.values(t).forEach(s=>{if(i)return;const r=Ep(s,`${e}, namespace`);r&&(i=r)}),i}function wp(t,e){let i=null;if(t&&Ki(t)){const s=Eo(t,e);s&&(i=s);const r=yp(t,e);r&&(i=r)}else i=ee("MISSING_OR_INVALID",`${e}, requiredNamespaces should be an object with data`);return i}function Fi(t,e){let i=null;if(t&&Ki(t)){const s=Eo(t,e);s&&(i=s);const r=mp(t,e);r&&(i=r)}else i=ee("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return i}function wo(t){return it(t.protocol,!0)}function _p(t,e){let i=!1;return e&&!t?i=!0:t&&$i(t)&&t.length&&t.forEach(s=>{i=wo(s)}),i}function bp(t){return typeof t=="number"}function ft(t){return typeof t<"u"&&typeof t!==null}function vp(t){return!(!t||typeof t!="object"||!t.code||!js(t.code,!1)||!t.message||!it(t.message,!1))}function Sp(t){return!(bt(t)||!it(t.method,!1))}function Op(t){return!(bt(t)||bt(t.result)&&bt(t.error)||!js(t.id,!1)||!it(t.jsonrpc,!1))}function Cp(t){return!(bt(t)||!it(t.name,!1))}function _o(t,e){return!(!ks(e)||!op(t).includes(e))}function Ip(t,e,i){return it(i,!1)?ap(t,e).includes(i):!1}function Np(t,e,i){return it(i,!1)?cp(t,e).includes(i):!1}function bo(t,e,i){let s=null;const r=Object.keys(t),h=Object.keys(e);return Tt(r,h)?r.forEach(y=>{if(s)return;const u=t[y].chains,g=yi(e[y].accounts);Tt(u,g)?Tt(t[y].methods,e[y].methods)?Tt(t[y].events,e[y].events)||(s=ee("NON_CONFORMING_NAMESPACES",`${i} namespaces events don't satisfy requiredNamespaces events for ${y}`)):s=ee("NON_CONFORMING_NAMESPACES",`${i} namespaces methods don't satisfy requiredNamespaces methods for ${y}`):s=ee("NON_CONFORMING_NAMESPACES",`${i} namespaces accounts don't satisfy requiredNamespaces chains for ${y}`)}):s=ee("NON_CONFORMING_NAMESPACES",`${i} namespaces keys don't satisfy requiredNamespaces`),s}function Tp(t,e){return js(t,!1)&&t<=e.max&&t>=e.min}const vo="wc",So=2,Oo="client",zs=`${vo}@${So}:${Oo}:`,$s={name:Oo,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Ap="proposal",Up="session",Bi=J.SEVEN_DAYS,Pp="engine",Di={wc_sessionPropose:{req:{ttl:J.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1104},res:{ttl:J.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1106},res:{ttl:J.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:J.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:J.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1112},res:{ttl:J.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:J.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:J.THIRTY_SECONDS,prompt:!1,tag:1115}}},Ks={min:J.FIVE_MINUTES,max:J.SEVEN_DAYS},Rp="request";var xp=Object.defineProperty,Lp=Object.defineProperties,Mp=Object.getOwnPropertyDescriptors,Co=Object.getOwnPropertySymbols,jp=Object.prototype.hasOwnProperty,kp=Object.prototype.propertyIsEnumerable,Io=(t,e,i)=>e in t?xp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,vt=(t,e)=>{for(var i in e||(e={}))jp.call(e,i)&&Io(t,i,e[i]);if(Co)for(var i of Co(e))kp.call(e,i)&&Io(t,i,e[i]);return t},Fs=(t,e)=>Lp(t,Mp(e));class zp extends ep{constructor(e){super(e),this.name=Pp,this.events=new lt,this.initialized=!1,this.ignoredPayloadTypes=[sp],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(Di)}),this.initialized=!0)},this.connect=async i=>{this.isInitialized(),await this.isValidConnect(i);const{pairingTopic:s,requiredNamespaces:r,relays:h}=i;let y=s,u,g=!1;if(y&&(g=this.client.core.pairing.pairings.get(y).active),!y||!g){const{topic:R,uri:k}=await this.client.core.pairing.create();y=R,u=k}const E=await this.client.core.crypto.generateKeyPair(),D={requiredNamespaces:r,relays:h??[{protocol:so}],proposer:{publicKey:E,metadata:this.client.metadata}},{reject:b,resolve:A,done:v}=Zt();if(this.events.once($e("session_connect"),async({error:R,session:k})=>{if(R)b(R);else if(k){k.self.publicKey=E;const a=Fs(vt({},k),{requiredNamespaces:k.requiredNamespaces});await this.client.session.set(k.topic,a),await this.setExpiry(k.topic,k.expiry),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:k.peer.metadata}),A(a)}}),!y){const{message:R}=ee("NO_MATCHING_KEY",`connect() pairing topic: ${y}`);throw new Error(R)}const I=await this.sendRequest(y,"wc_sessionPropose",D),_=zt(J.FIVE_MINUTES);return await this.setProposal(I,vt({id:I,expiry:_},D)),{uri:u,approval:v}},this.pair=async i=>(this.isInitialized(),await this.client.core.pairing.pair(i)),this.approve=async i=>{this.isInitialized(),await this.isValidApprove(i);const{id:s,relayProtocol:r,namespaces:h}=i,y=this.client.proposal.get(s);let{pairingTopic:u,proposer:g,requiredNamespaces:E}=y;Ki(E)||(E=up(h,"approve()"),this.client.proposal.set(s,Fs(vt({},y),{requiredNamespaces:E})));const D=await this.client.core.crypto.generateKeyPair(),b=g.publicKey,A=await this.client.core.crypto.generateSharedKey(D,b),v={relay:{protocol:r??"irn"},namespaces:h,requiredNamespaces:E,controller:{publicKey:D,metadata:this.client.metadata},expiry:zt(Bi)};await this.client.core.relayer.subscribe(A);const I=await this.sendRequest(A,"wc_sessionSettle",v),{done:_,resolve:R,reject:k}=Zt();this.events.once($e("session_approve",I),({error:f})=>{f?k(f):R(this.client.session.get(A))});const a=Fs(vt({},v),{topic:A,acknowledged:!1,self:v.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:D});return await this.client.session.set(A,a),await this.setExpiry(A,zt(Bi)),u&&await this.client.core.pairing.updateMetadata({topic:u,metadata:a.peer.metadata}),u&&s&&(await this.sendResult(s,u,{relay:{protocol:r??"irn"},responderPublicKey:D}),await this.client.proposal.delete(s,nt("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:u})),{topic:A,acknowledged:_}},this.reject=async i=>{this.isInitialized(),await this.isValidReject(i);const{id:s,reason:r}=i,{pairingTopic:h}=this.client.proposal.get(s);h&&(await this.sendError(s,h,r),await this.client.proposal.delete(s,nt("USER_DISCONNECTED")))},this.update=async i=>{this.isInitialized(),await this.isValidUpdate(i);const{topic:s,namespaces:r}=i,h=await this.sendRequest(s,"wc_sessionUpdate",{namespaces:r}),{done:y,resolve:u,reject:g}=Zt();return this.events.once($e("session_update",h),({error:E})=>{E?g(E):u()}),await this.client.session.update(s,{namespaces:r}),{acknowledged:y}},this.extend=async i=>{this.isInitialized(),await this.isValidExtend(i);const{topic:s}=i,r=await this.sendRequest(s,"wc_sessionExtend",{}),{done:h,resolve:y,reject:u}=Zt();return this.events.once($e("session_extend",r),({error:g})=>{g?u(g):y()}),await this.setExpiry(s,zt(Bi)),{acknowledged:h}},this.request=async i=>{this.isInitialized(),await this.isValidRequest(i);const{chainId:s,request:r,topic:h,expiry:y}=i,u=await this.sendRequest(h,"wc_sessionRequest",{request:r,chainId:s},y),{done:g,resolve:E,reject:D}=Zt(y);return this.events.once($e("session_request",u),({error:b,result:A})=>{b?D(b):E(A)}),await g()},this.respond=async i=>{this.isInitialized(),await this.isValidRespond(i);const{topic:s,response:r}=i,{id:h}=r;Lt(r)?await this.sendResult(h,s,r.result):Ct(r)&&await this.sendError(h,s,r.error),this.deletePendingSessionRequest(i.response.id,{message:"fulfilled",code:0})},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:s}=i;if(this.client.session.keys.includes(s)){const r=await this.sendRequest(s,"wc_sessionPing",{}),{done:h,resolve:y,reject:u}=Zt();this.events.once($e("session_ping",r),({error:g})=>{g?u(g):y()}),await h()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async i=>{this.isInitialized(),await this.isValidEmit(i);const{topic:s,event:r,chainId:h}=i;await this.sendRequest(s,"wc_sessionEvent",{event:r,chainId:h})},this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.client.session.keys.includes(s)?(await this.sendRequest(s,"wc_sessionDelete",nt("USER_DISCONNECTED")),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=i=>(this.isInitialized(),this.client.session.getAll().filter(s=>dp(s,i))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(i,s)=>{const{self:r}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await Promise.all([this.client.session.delete(i,nt("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(r.publicKey),this.client.core.crypto.deleteSymKey(i),s?Promise.resolve():this.client.core.expirer.del(i)])},this.deleteProposal=async(i,s)=>{await Promise.all([this.client.proposal.delete(i,nt("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(i)])},this.deletePendingSessionRequest=async(i,s,r=!1)=>{await Promise.all([this.client.pendingRequest.delete(i,s),r?Promise.resolve():this.client.core.expirer.del(i)])},this.setExpiry=async(i,s)=>{this.client.session.keys.includes(i)&&await this.client.session.update(i,{expiry:s}),this.client.core.expirer.set(i,s)},this.setProposal=async(i,s)=>{await this.client.proposal.set(i,s),this.client.core.expirer.set(i,s.expiry)},this.setPendingSessionRequest=async i=>{const s=Di.wc_sessionRequest.req.ttl,{id:r,topic:h,params:y}=i;await this.client.pendingRequest.set(r,{id:r,topic:h,params:y}),s&&this.client.core.expirer.set(r,zt(s))},this.sendRequest=async(i,s,r,h)=>{const y=er(s,r),u=await this.client.core.crypto.encode(i,y),g=Di[s].req;return h&&(g.ttl=h),this.client.core.history.set(i,y),this.client.core.relayer.publish(i,u,g),y.id},this.sendResult=async(i,s,r)=>{const h=Qs(i,r),y=await this.client.core.crypto.encode(s,h),u=await this.client.core.history.get(s,i),g=Di[u.request.method].res;this.client.core.relayer.publish(s,y,g),await this.client.core.history.resolve(h)},this.sendError=async(i,s,r)=>{const h=Js(i,r),y=await this.client.core.crypto.encode(s,h),u=await this.client.core.history.get(s,i),g=Di[u.request.method].res;this.client.core.relayer.publish(s,y,g),await this.client.core.history.resolve(h)},this.cleanup=async()=>{const i=[],s=[];this.client.session.getAll().forEach(r=>{Jt(r.expiry)&&i.push(r.topic)}),this.client.proposal.getAll().forEach(r=>{Jt(r.expiry)&&s.push(r.id)}),await Promise.all([...i.map(r=>this.deleteSession(r)),...s.map(r=>this.deleteProposal(r))])},this.onRelayEventRequest=i=>{const{topic:s,payload:r}=i,h=r.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeRequest(s,r);case"wc_sessionSettle":return this.onSessionSettleRequest(s,r);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,r);case"wc_sessionExtend":return this.onSessionExtendRequest(s,r);case"wc_sessionPing":return this.onSessionPingRequest(s,r);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,r);case"wc_sessionRequest":return this.onSessionRequest(s,r);case"wc_sessionEvent":return this.onSessionEventRequest(s,r);default:return this.client.logger.info(`Unsupported request method ${h}`)}},this.onRelayEventResponse=async i=>{const{topic:s,payload:r}=i,h=(await this.client.core.history.get(s,r.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(s,r);case"wc_sessionSettle":return this.onSessionSettleResponse(s,r);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,r);case"wc_sessionExtend":return this.onSessionExtendResponse(s,r);case"wc_sessionPing":return this.onSessionPingResponse(s,r);case"wc_sessionRequest":return this.onSessionRequestResponse(s,r);default:return this.client.logger.info(`Unsupported response method ${h}`)}},this.onSessionProposeRequest=async(i,s)=>{const{params:r,id:h}=s;try{this.isValidConnect(vt({},s.params));const y=zt(J.FIVE_MINUTES),u=vt({id:h,pairingTopic:i,expiry:y},r);await this.setProposal(h,u),this.client.events.emit("session_proposal",{id:h,params:u})}catch(y){await this.sendError(h,i,y),this.client.logger.error(y)}},this.onSessionProposeResponse=async(i,s)=>{const{id:r}=s;if(Lt(s)){const{result:h}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const y=this.client.proposal.get(r);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:y});const u=y.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:u});const g=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:g});const E=await this.client.core.crypto.generateSharedKey(u,g);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:E});const D=await this.client.core.relayer.subscribe(E);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:D}),await this.client.core.pairing.activate({topic:i})}else Ct(s)&&(await this.client.proposal.delete(r,nt("USER_DISCONNECTED")),this.events.emit($e("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(i,s)=>{const{id:r,params:h}=s;try{this.isValidSessionSettleRequest(h);const{relay:y,controller:u,expiry:g,namespaces:E,requiredNamespaces:D}=s.params,b={topic:i,relay:y,expiry:g,namespaces:E,acknowledged:!0,requiredNamespaces:D,controller:u.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:u.publicKey,metadata:u.metadata}};await this.sendResult(s.id,i,!0),this.events.emit($e("session_connect"),{session:b})}catch(y){await this.sendError(r,i,y),this.client.logger.error(y)}},this.onSessionSettleResponse=async(i,s)=>{const{id:r}=s;Lt(s)?(await this.client.session.update(i,{acknowledged:!0}),this.events.emit($e("session_approve",r),{})):Ct(s)&&(await this.client.session.delete(i,nt("USER_DISCONNECTED")),this.events.emit($e("session_approve",r),{error:s.error}))},this.onSessionUpdateRequest=async(i,s)=>{const{params:r,id:h}=s;try{this.isValidUpdate(vt({topic:i},r)),await this.client.session.update(i,{namespaces:r.namespaces}),await this.sendResult(h,i,!0),this.client.events.emit("session_update",{id:h,topic:i,params:r})}catch(y){await this.sendError(h,i,y),this.client.logger.error(y)}},this.onSessionUpdateResponse=(i,s)=>{const{id:r}=s;Lt(s)?this.events.emit($e("session_update",r),{}):Ct(s)&&this.events.emit($e("session_update",r),{error:s.error})},this.onSessionExtendRequest=async(i,s)=>{const{id:r}=s;try{this.isValidExtend({topic:i}),await this.setExpiry(i,zt(Bi)),await this.sendResult(r,i,!0),this.client.events.emit("session_extend",{id:r,topic:i})}catch(h){await this.sendError(r,i,h),this.client.logger.error(h)}},this.onSessionExtendResponse=(i,s)=>{const{id:r}=s;Lt(s)?this.events.emit($e("session_extend",r),{}):Ct(s)&&this.events.emit($e("session_extend",r),{error:s.error})},this.onSessionPingRequest=async(i,s)=>{const{id:r}=s;try{this.isValidPing({topic:i}),await this.sendResult(r,i,!0),this.client.events.emit("session_ping",{id:r,topic:i})}catch(h){await this.sendError(r,i,h),this.client.logger.error(h)}},this.onSessionPingResponse=(i,s)=>{const{id:r}=s;setTimeout(()=>{Lt(s)?this.events.emit($e("session_ping",r),{}):Ct(s)&&this.events.emit($e("session_ping",r),{error:s.error})},500)},this.onSessionDeleteRequest=async(i,s)=>{const{id:r}=s;try{this.isValidDisconnect({topic:i,reason:s.params}),this.client.core.relayer.once(Qe.publish,async()=>{await this.deleteSession(i)}),await this.sendResult(r,i,!0),this.client.events.emit("session_delete",{id:r,topic:i})}catch(h){await this.sendError(r,i,h),this.client.logger.error(h)}},this.onSessionRequest=async(i,s)=>{const{id:r,params:h}=s;try{this.isValidRequest(vt({topic:i},h)),await this.setPendingSessionRequest({id:r,topic:i,params:h}),this.client.events.emit("session_request",{id:r,topic:i,params:h})}catch(y){await this.sendError(r,i,y),this.client.logger.error(y)}},this.onSessionRequestResponse=(i,s)=>{const{id:r}=s;Lt(s)?this.events.emit($e("session_request",r),{result:s.result}):Ct(s)&&this.events.emit($e("session_request",r),{error:s.error})},this.onSessionEventRequest=async(i,s)=>{const{id:r,params:h}=s;try{this.isValidEmit(vt({topic:i},h)),this.client.events.emit("session_event",{id:r,topic:i,params:h})}catch(y){await this.sendError(r,i,y),this.client.logger.error(y)}},this.isValidConnect=async i=>{if(!ft(i)){const{message:u}=ee("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(i)}`);throw new Error(u)}const{pairingTopic:s,requiredNamespaces:r,relays:h}=i;if(bt(s)||await this.isValidPairingTopic(s),!bt(r)&&Ki(r)===0)return;const y=wp(r,"connect()");if(y)throw new Error(y.message);if(!_p(h,!0)){const{message:u}=ee("MISSING_OR_INVALID",`connect() relays: ${h}`);throw new Error(u)}},this.isValidApprove=async i=>{if(!ft(i))throw new Error(ee("MISSING_OR_INVALID",`approve() params: ${i}`).message);const{id:s,namespaces:r,relayProtocol:h}=i;await this.isValidProposalId(s);const y=this.client.proposal.get(s),u=Fi(r,"approve()");if(u)throw new Error(u.message);const g=bo(y.requiredNamespaces,r,"update()");if(g)throw new Error(g.message);if(!it(h,!0)){const{message:E}=ee("MISSING_OR_INVALID",`approve() relayProtocol: ${h}`);throw new Error(E)}},this.isValidReject=async i=>{if(!ft(i)){const{message:h}=ee("MISSING_OR_INVALID",`reject() params: ${i}`);throw new Error(h)}const{id:s,reason:r}=i;if(await this.isValidProposalId(s),!vp(r)){const{message:h}=ee("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(r)}`);throw new Error(h)}},this.isValidSessionSettleRequest=i=>{if(!ft(i)){const{message:E}=ee("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${i}`);throw new Error(E)}const{relay:s,controller:r,namespaces:h,expiry:y}=i;if(!wo(s)){const{message:E}=ee("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(E)}const u=fp(r,"onSessionSettleRequest()");if(u)throw new Error(u.message);const g=Fi(h,"onSessionSettleRequest()");if(g)throw new Error(g.message);if(Jt(y)){const{message:E}=ee("EXPIRED","onSessionSettleRequest()");throw new Error(E)}},this.isValidUpdate=async i=>{if(!ft(i)){const{message:g}=ee("MISSING_OR_INVALID",`update() params: ${i}`);throw new Error(g)}const{topic:s,namespaces:r}=i;await this.isValidSessionTopic(s);const h=this.client.session.get(s),y=Fi(r,"update()");if(y)throw new Error(y.message);const u=bo(h.requiredNamespaces,r,"update()");if(u)throw new Error(u.message)},this.isValidExtend=async i=>{if(!ft(i)){const{message:r}=ee("MISSING_OR_INVALID",`extend() params: ${i}`);throw new Error(r)}const{topic:s}=i;await this.isValidSessionTopic(s)},this.isValidRequest=async i=>{if(!ft(i)){const{message:g}=ee("MISSING_OR_INVALID",`request() params: ${i}`);throw new Error(g)}const{topic:s,request:r,chainId:h,expiry:y}=i;await this.isValidSessionTopic(s);const{namespaces:u}=this.client.session.get(s);if(!_o(u,h)){const{message:g}=ee("MISSING_OR_INVALID",`request() chainId: ${h}`);throw new Error(g)}if(!Sp(r)){const{message:g}=ee("MISSING_OR_INVALID",`request() ${JSON.stringify(r)}`);throw new Error(g)}if(!Ip(u,h,r.method)){const{message:g}=ee("MISSING_OR_INVALID",`request() method: ${r.method}`);throw new Error(g)}if(y&&!Tp(y,Ks)){const{message:g}=ee("MISSING_OR_INVALID",`request() expiry: ${y}. Expiry must be a number (in seconds) between ${Ks.min} and ${Ks.max}`);throw new Error(g)}},this.isValidRespond=async i=>{if(!ft(i)){const{message:h}=ee("MISSING_OR_INVALID",`respond() params: ${i}`);throw new Error(h)}const{topic:s,response:r}=i;if(await this.isValidSessionTopic(s),!Op(r)){const{message:h}=ee("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(r)}`);throw new Error(h)}},this.isValidPing=async i=>{if(!ft(i)){const{message:r}=ee("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(r)}const{topic:s}=i;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async i=>{if(!ft(i)){const{message:u}=ee("MISSING_OR_INVALID",`emit() params: ${i}`);throw new Error(u)}const{topic:s,event:r,chainId:h}=i;await this.isValidSessionTopic(s);const{namespaces:y}=this.client.session.get(s);if(!_o(y,h)){const{message:u}=ee("MISSING_OR_INVALID",`emit() chainId: ${h}`);throw new Error(u)}if(!Cp(r)){const{message:u}=ee("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(r)}`);throw new Error(u)}if(!Np(y,h,r.name)){const{message:u}=ee("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(r)}`);throw new Error(u)}},this.isValidDisconnect=async i=>{if(!ft(i)){const{message:r}=ee("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(r)}const{topic:s}=i;await this.isValidSessionOrPairingTopic(s)}}isInitialized(){if(!this.initialized){const{message:e}=ee("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(Qe.message,async e=>{const{topic:i,message:s}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const r=await this.client.core.crypto.decode(i,s);Zs(r)?(this.client.core.history.set(i,r),this.onRelayEventRequest({topic:i,payload:r})):Go(r)&&(await this.client.core.history.resolve(r),this.onRelayEventResponse({topic:i,payload:r}))})}registerExpirerEvents(){this.client.core.expirer.on(ct.expired,async e=>{const{topic:i,id:s}=np(e.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,ee("EXPIRED"),!0);i?this.client.session.keys.includes(i)&&(await this.deleteSession(i,!0),this.client.events.emit("session_expire",{topic:i})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}isValidPairingTopic(e){if(!it(e,!1)){const{message:i}=ee("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(i)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:i}=ee("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(i)}if(Jt(this.client.core.pairing.pairings.get(e).expiry)){const{message:i}=ee("EXPIRED",`pairing topic: ${e}`);throw new Error(i)}}async isValidSessionTopic(e){if(!it(e,!1)){const{message:i}=ee("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(i)}if(!this.client.session.keys.includes(e)){const{message:i}=ee("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(i)}if(Jt(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:i}=ee("EXPIRED",`session topic: ${e}`);throw new Error(i)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(it(e,!1)){const{message:i}=ee("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(i)}else{const{message:i}=ee("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(i)}}async isValidProposalId(e){if(!bp(e)){const{message:i}=ee("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(i)}if(!this.client.proposal.keys.includes(e)){const{message:i}=ee("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(i)}if(Jt(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:i}=ee("EXPIRED",`proposal id: ${e}`);throw new Error(i)}}}class $p extends zi{constructor(e,i){super(e,i,Ap,zs),this.core=e,this.logger=i}}class Kp extends zi{constructor(e,i){super(e,i,Up,zs),this.core=e,this.logger=i}}class Fp extends zi{constructor(e,i){super(e,i,Rp,zs),this.core=e,this.logger=i}}class Bs extends Qd{constructor(e){super(e),this.protocol=vo,this.version=So,this.name=$s.name,this.events=new lt.EventEmitter,this.on=(s,r)=>this.events.on(s,r),this.once=(s,r)=>this.events.once(s,r),this.off=(s,r)=>this.events.off(s,r),this.removeListener=(s,r)=>this.events.removeListener(s,r),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(r){throw this.logger.error(r.message),r}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(r){throw this.logger.error(r.message),r}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(r){throw this.logger.error(r.message),r}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(r){throw this.logger.error(r.message),r}},this.update=async s=>{try{return await this.engine.update(s)}catch(r){throw this.logger.error(r.message),r}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(r){throw this.logger.error(r.message),r}},this.request=async s=>{try{return await this.engine.request(s)}catch(r){throw this.logger.error(r.message),r}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(r){throw this.logger.error(r.message),r}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(r){throw this.logger.error(r.message),r}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(r){throw this.logger.error(r.message),r}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(r){throw this.logger.error(r.message),r}},this.find=s=>{try{return this.engine.find(s)}catch(r){throw this.logger.error(r.message),r}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(e==null?void 0:e.name)||$s.name,this.metadata=(e==null?void 0:e.metadata)||rp();const i=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:bi(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||$s.logger}));this.core=(e==null?void 0:e.core)||new Zd(e),this.logger=Se.generateChildLogger(i,this.name),this.session=new Kp(this.core,this.logger),this.proposal=new $p(this.core,this.logger),this.pendingRequest=new Fp(this.core,this.logger),this.engine=new zp(this)}static async init(e){const i=new Bs(e);return await i.initialize(),i}get context(){return Se.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}var Hs={};Object.defineProperty(Hs,"__esModule",{value:!0}),Hs.getWindowMetadata=void 0;const No=Gs;function Bp(){let t,e;try{t=No.getDocumentOrThrow(),e=No.getLocationOrThrow()}catch{return null}function i(){const D=t.getElementsByTagName("link"),b=[];for(let A=0;A<D.length;A++){const v=D[A],I=v.getAttribute("rel");if(I&&I.toLowerCase().indexOf("icon")>-1){const _=v.getAttribute("href");if(_)if(_.toLowerCase().indexOf("https:")===-1&&_.toLowerCase().indexOf("http:")===-1&&_.indexOf("//")!==0){let R=e.protocol+"//"+e.host;if(_.indexOf("/")===0)R+=_;else{const k=e.pathname.split("/");k.pop();const a=k.join("/");R+=a+"/"+_}b.push(R)}else if(_.indexOf("//")===0){const R=e.protocol+_;b.push(R)}else b.push(_)}}return b}function s(...D){const b=t.getElementsByTagName("meta");for(let A=0;A<b.length;A++){const v=b[A],I=["itemprop","property","name"].map(_=>v.getAttribute(_)).filter(_=>_?D.includes(_):!1);if(I.length&&I){const _=v.getAttribute("content");if(_)return _}}return""}function r(){let D=s("name","og:site_name","og:title","twitter:title");return D||(D=t.title),D}function h(){return s("description","og:description","twitter:description","keywords")}const y=r(),u=h(),g=e.origin,E=i();return{description:u,url:g,icons:E,name:y}}Hs.getWindowMetadata=Bp;var Hp={};(function(t){const e=Ys,i=Xs,s=Ws,r=Ds,h=a=>a==null,y=Symbol("encodeFragmentIdentifier");function u(a){switch(a.arrayFormat){case"index":return f=>(d,p)=>{const c=d.length;return p===void 0||a.skipNull&&p===null||a.skipEmptyString&&p===""?d:p===null?[...d,[D(f,a),"[",c,"]"].join("")]:[...d,[D(f,a),"[",D(c,a),"]=",D(p,a)].join("")]};case"bracket":return f=>(d,p)=>p===void 0||a.skipNull&&p===null||a.skipEmptyString&&p===""?d:p===null?[...d,[D(f,a),"[]"].join("")]:[...d,[D(f,a),"[]=",D(p,a)].join("")];case"colon-list-separator":return f=>(d,p)=>p===void 0||a.skipNull&&p===null||a.skipEmptyString&&p===""?d:p===null?[...d,[D(f,a),":list="].join("")]:[...d,[D(f,a),":list=",D(p,a)].join("")];case"comma":case"separator":case"bracket-separator":{const f=a.arrayFormat==="bracket-separator"?"[]=":"=";return d=>(p,c)=>c===void 0||a.skipNull&&c===null||a.skipEmptyString&&c===""?p:(c=c===null?"":c,p.length===0?[[D(d,a),f,D(c,a)].join("")]:[[p,D(c,a)].join(a.arrayFormatSeparator)])}default:return f=>(d,p)=>p===void 0||a.skipNull&&p===null||a.skipEmptyString&&p===""?d:p===null?[...d,D(f,a)]:[...d,[D(f,a),"=",D(p,a)].join("")]}}function g(a){let f;switch(a.arrayFormat){case"index":return(d,p,c)=>{if(f=/\[(\d*)\]$/.exec(d),d=d.replace(/\[\d*\]$/,""),!f){c[d]=p;return}c[d]===void 0&&(c[d]={}),c[d][f[1]]=p};case"bracket":return(d,p,c)=>{if(f=/(\[\])$/.exec(d),d=d.replace(/\[\]$/,""),!f){c[d]=p;return}if(c[d]===void 0){c[d]=[p];return}c[d]=[].concat(c[d],p)};case"colon-list-separator":return(d,p,c)=>{if(f=/(:list)$/.exec(d),d=d.replace(/:list$/,""),!f){c[d]=p;return}if(c[d]===void 0){c[d]=[p];return}c[d]=[].concat(c[d],p)};case"comma":case"separator":return(d,p,c)=>{const n=typeof p=="string"&&p.includes(a.arrayFormatSeparator),l=typeof p=="string"&&!n&&b(p,a).includes(a.arrayFormatSeparator);p=l?b(p,a):p;const P=n||l?p.split(a.arrayFormatSeparator).map(x=>b(x,a)):p===null?p:b(p,a);c[d]=P};case"bracket-separator":return(d,p,c)=>{const n=/(\[\])$/.test(d);if(d=d.replace(/\[\]$/,""),!n){c[d]=p&&b(p,a);return}const l=p===null?[]:p.split(a.arrayFormatSeparator).map(P=>b(P,a));if(c[d]===void 0){c[d]=l;return}c[d]=[].concat(c[d],l)};default:return(d,p,c)=>{if(c[d]===void 0){c[d]=p;return}c[d]=[].concat(c[d],p)}}}function E(a){if(typeof a!="string"||a.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function D(a,f){return f.encode?f.strict?e(a):encodeURIComponent(a):a}function b(a,f){return f.decode?i(a):a}function A(a){return Array.isArray(a)?a.sort():typeof a=="object"?A(Object.keys(a)).sort((f,d)=>Number(f)-Number(d)).map(f=>a[f]):a}function v(a){const f=a.indexOf("#");return f!==-1&&(a=a.slice(0,f)),a}function I(a){let f="";const d=a.indexOf("#");return d!==-1&&(f=a.slice(d)),f}function _(a){a=v(a);const f=a.indexOf("?");return f===-1?"":a.slice(f+1)}function R(a,f){return f.parseNumbers&&!Number.isNaN(Number(a))&&typeof a=="string"&&a.trim()!==""?a=Number(a):f.parseBooleans&&a!==null&&(a.toLowerCase()==="true"||a.toLowerCase()==="false")&&(a=a.toLowerCase()==="true"),a}function k(a,f){f=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},f),E(f.arrayFormatSeparator);const d=g(f),p=Object.create(null);if(typeof a!="string"||(a=a.trim().replace(/^[?#&]/,""),!a))return p;for(const c of a.split("&")){if(c==="")continue;let[n,l]=s(f.decode?c.replace(/\+/g," "):c,"=");l=l===void 0?null:["comma","separator","bracket-separator"].includes(f.arrayFormat)?l:b(l,f),d(b(n,f),l,p)}for(const c of Object.keys(p)){const n=p[c];if(typeof n=="object"&&n!==null)for(const l of Object.keys(n))n[l]=R(n[l],f);else p[c]=R(n,f)}return f.sort===!1?p:(f.sort===!0?Object.keys(p).sort():Object.keys(p).sort(f.sort)).reduce((c,n)=>{const l=p[n];return Boolean(l)&&typeof l=="object"&&!Array.isArray(l)?c[n]=A(l):c[n]=l,c},Object.create(null))}t.extract=_,t.parse=k,t.stringify=(a,f)=>{if(!a)return"";f=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},f),E(f.arrayFormatSeparator);const d=l=>f.skipNull&&h(a[l])||f.skipEmptyString&&a[l]==="",p=u(f),c={};for(const l of Object.keys(a))d(l)||(c[l]=a[l]);const n=Object.keys(c);return f.sort!==!1&&n.sort(f.sort),n.map(l=>{const P=a[l];return P===void 0?"":P===null?D(l,f):Array.isArray(P)?P.length===0&&f.arrayFormat==="bracket-separator"?D(l,f)+"[]":P.reduce(p(l),[]).join("&"):D(l,f)+"="+D(P,f)}).filter(l=>l.length>0).join("&")},t.parseUrl=(a,f)=>{f=Object.assign({decode:!0},f);const[d,p]=s(a,"#");return Object.assign({url:d.split("?")[0]||"",query:k(_(a),f)},f&&f.parseFragmentIdentifier&&p?{fragmentIdentifier:b(p,f)}:{})},t.stringifyUrl=(a,f)=>{f=Object.assign({encode:!0,strict:!0,[y]:!0},f);const d=v(a.url).split("?")[0]||"",p=t.extract(a.url),c=t.parse(p,{sort:!1}),n=Object.assign(c,a.query);let l=t.stringify(n,f);l&&(l=`?${l}`);let P=I(a.url);return a.fragmentIdentifier&&(P=`#${f[y]?D(a.fragmentIdentifier,f):a.fragmentIdentifier}`),`${d}${l}${P}`},t.pick=(a,f,d)=>{d=Object.assign({parseFragmentIdentifier:!0,[y]:!1},d);const{url:p,query:c,fragmentIdentifier:n}=t.parseUrl(a,d);return t.stringifyUrl({url:p,query:r(c,f),fragmentIdentifier:n},d)},t.exclude=(a,f,d)=>{const p=Array.isArray(f)?c=>!f.includes(c):(c,n)=>!f(c,n);return t.pick(a,p,d)}})(Hp);const Vp={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function qp(t,e){const{message:i,code:s}=Vp[t];return{message:e?`${i} ${e}`:i,code:s}}function Gp(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Wp(t){var e;const i=(e=t[Object.keys(t)[0]])==null?void 0:e.chains[0];return[i.split(":")[0],i.split(":")[1]]}function At(t,e){let i;return e.rpcMap&&(i=e.rpcMap[Yp([t])]),i}function Yp(t){return Number(t[0].split(":")[1])}class Xp{constructor(e){this.name="eip155",this.namespace=e.namespace,this.client=e.client,this.events=e.events,this.httpProviders=this.createHttpProviders(),this.chainId=this.getDefaultChainId()}async request(e){var i;switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":{const s=e.request.params?(i=e.request.params[0])==null?void 0:i.chainId:"0x0";return this.setDefaultChain(parseInt(s,16).toString()),null}case"eth_chainId":return this.getDefaultChainId()}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,i){if(this.chainId=parseInt(e),!this.httpProviders[e]){const s=i||At(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit("chainChanged",this.chainId)}requestAccounts(){return this.getAccounts()}createHttpProvider(e,i){const s=i||At(e,this.namespace);return typeof s>"u"?void 0:new _i(new Ji(s))}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{e[i]=this.createHttpProvider(i)}),e}getAccounts(){const e=this.namespace.accounts;return e?e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return parseInt(e.split(":")[1])}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}}class Jp{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{e[i]=this.createHttpProvider(i)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setDefaultChain(e,i){if(this.chainId=e,!this.httpProviders[e]){const s=i||At(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||At(e,this.namespace);return typeof s>"u"?void 0:new _i(new Ji(s))}}class Zp{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{e[i]=this.createHttpProvider(i)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setDefaultChain(e,i){if(this.chainId=e,!this.httpProviders[e]){const s=i||At(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||At(e,this.namespace);return typeof s>"u"?void 0:new _i(new Ji(s))}}class Qp{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{e[i]=this.createHttpProvider(i)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setDefaultChain(e,i){if(this.chainId=e,!this.httpProviders[e]){const s=i||At(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||At(e,this.namespace);return typeof s>"u"?void 0:new _i(new Ji(s))}}const To="error",ef="wss://relay.walletconnect.com",tf="wc",sf="universal_provider",Ao=`${tf}@${2}:${sf}:`;var rf=Object.defineProperty,nf=Object.defineProperties,of=Object.getOwnPropertyDescriptors,Uo=Object.getOwnPropertySymbols,af=Object.prototype.hasOwnProperty,cf=Object.prototype.propertyIsEnumerable,Po=(t,e,i)=>e in t?rf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Ro=(t,e)=>{for(var i in e||(e={}))af.call(e,i)&&Po(t,i,e[i]);if(Uo)for(var i of Uo(e))cf.call(e,i)&&Po(t,i,e[i]);return t},uf=(t,e)=>nf(t,of(e));tr=class Yo{constructor(e){this.events=new lt,this.rpcProviders={},this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:bi(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||To}))}static async init(e){const i=new Yo(e);return await i.initialize(),i}async request(e,i){const[s,r]=this.validateChain(i);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Ro({},e),chainId:`${s}:${r}`,topic:this.session.topic})}sendAsync(e,i,s){this.request(e,s).then(r=>i(null,r)).catch(r=>i(r,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:qp("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");const{namespaces:i}=e;return this.setNamespaces(i),this.createProviders(),await this.cleanupPendingPairings(),e.skipPairing===!0?void 0:await this.pair(e.pairingTopic)}on(e,i){this.events.on(e,i)}once(e,i){this.events.once(e,i)}removeListener(e,i){this.events.removeListener(e,i)}off(e,i){this.events.off(e,i)}get isWalletConnect(){return!0}async pair(e){const{uri:i,approval:s}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces});return i&&(this.uri=i,this.events.emit("display_uri",i)),this.session=await s(),this.onSessionUpdate(),this.onConnect(),this.session}setDefaultChain(e,i){try{const[s,r]=this.validateChain(e);this.getProvider(s).setDefaultChain(r,i)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const i=this.client.pairing.getAll();if(Gp(i)){for(const s of i)e.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${i.length}`)}}async checkStorage(){if(this.namespaces=await this.client.core.storage.getItem(`${Ao}/namespaces`)||{},this.namespaces&&this.createProviders(),this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.onSessionUpdate()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await Bs.init({logger:this.providerOpts.logger||To,relayUrl:this.providerOpts.relayUrl||ef,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach(e=>{switch(e){case"eip155":this.rpcProviders[e]=new Xp({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"solana":this.rpcProviders[e]=new Jp({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"cosmos":this.rpcProviders[e]=new Zp({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"polkadot":break;case"cip34":this.rpcProviders[e]=new Qp({client:this.client,namespace:this.namespaces[e],events:this.events});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:i}=e,{event:s}=i;s.name==="accountsChanged"?this.events.emit("accountsChanged",s.data):s.name==="chainChanged"?this.onChainChanged(s.data,i.chainId):this.events.emit(s.name,s.data),this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:i})=>{var s;const{namespaces:r}=i,h=(s=this.client)==null?void 0:s.session.get(e);this.session=uf(Ro({},h),{namespaces:r}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:i})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e)})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var i;this.getProvider(e).updateNamespace((i=this.session)==null?void 0:i.namespaces[e])})}setNamespaces(e){if(!e||!Object.keys(e).length)throw new Error("Namespaces must be not empty");this.client.core.storage.setItem(`${Ao}/namespaces`,e),this.namespaces=e}validateChain(e){const[i,s]=(e==null?void 0:e.split(":"))||["",""];if(i&&!Object.keys(this.namespaces).includes(i))throw new Error(`Namespace '${i}' is not configured. Please call connect() first with namespace config.`);return!i||!s?Wp(this.namespaces):[i,s]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,i){const[s,r]=this.validateChain(i);this.getProvider(s).setDefaultChain(r),this.events.emit("chainChanged",e)}onConnect(){this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.rpcProviders={},await this.cleanupPendingPairings({deletePairings:!0})}},Wo=tr});export{Wo as UniversalProvider,og as __tla,tr as default};
