function generateIndicatorIndex(){return Math.floor(5e5*Math.random()+1)}function generateEmptyDataStart(t,e){let r=[];for(var a=t;a<e;a++)r.push(0);return r}function createIndicator(t,e){let r=null;"EMA"==e&&(r=addEMA(t)),"SMA"==e&&(r=addSMA(t)),"BBANDS"==e&&(r=addBBANDS(t)),"ATR"==e&&(r=addATR(t)),"MACD"==e&&(r=addMACD(t)),"SO"==e&&(r=addSO(t)),"RSI"==e&&(r=addRSI(t)),"CCI"==e&&(r=addCCI(t)),"ROC"==e&&(r=addROC(t)),"ADX"==e&&(r=addADX(t));let a=$('<li cid="'+r.index+'" tid="'+e+'"><span>'+r.title+"</span><ul></ul></li>");$("#"+t).find(".dash-pan-ads-i > ul").append(a);let i=$('<li><i class="gw fa-duotone fa-gear"></i></li>');i.click((function(){editIndicator(t,e,r.index)})),$("#"+t).find('.dash-pan-ads-i > ul > li[cid="'+r.index+'"] > ul').append(i);let o=$('<li><i class="gw fa-duotone fa-eye"></i></li>');o.click((function(){toggleIndicatorGraph(t,r.index-1,e)})),$("#"+t).find('.dash-pan-ads-i > ul > li[cid="'+r.index+'"] > ul').append(o);let n=$('<li><i class="gw fa-duotone fa-trash-can"></i></li>');n.click((function(){deleteIndicatorGraph(t,r.index-1,e)})),$("#"+t).find('.dash-pan-ads-i > ul > li[cid="'+r.index+'"] > ul').append(n),$.post($("body").attr("hrefapp")+"/app/modules/dashboard/src/actions/addIndicator.php",{chart:t,indic:e,key:r.index,title:r.title}).done((function(t){let e=jQuery.parseJSON(t);1==e.error&&showAlert("Oops",e.msg,"error")})).fail((function(){showAlert("Ooops","Fail to add indicator","error")}))}function formatDataGraph(t){return jQuery.map(t,(function(t){if(t>10)return t.toFixed(2);if(t%1!=0){let e=(t+"").split(".");if(e.length<2)return t;if(e[1].length>5)return t.toFixed(5)}return t}))}function addIndicatorGraph(t,e,r,a,i,o=0,n="line",d=null){let s=generateEmptyDataStart(e.length,chartList[t].data.length);"line"==n?(e=formatDataGraph(e),chartList[t].option.series.push({name:i,type:n,xAxisIndex:o,yAxisIndex:o,symbolSize:5,data:$.merge(s,e),smooth:!1,symbolSize:0,lineStyle:{color:r,width:a},markLine:{symbol:["none","none"],data:[],animation:!1},itemStyle:{color:r},areaStyle:{color:r,opacity:null==d?0:.6}})):"bar"==n&&chartList[t].option.series.push({name:"MACD",type:"bar",xAxisIndex:o,yAxisIndex:o,data:$.merge(s,e),markLine:{data:[],animation:!1},itemStyle:{normal:{color:r},opacity:1}}),chartList[t].graph.setOption(chartList[t].option)}function refreshGridSize(t,e=!0){let r=[];if($.each(chartList[t].option.grid,(function(e,a){chartList[t].option.grid[e].show&&r.push(e),e>0&&!chartList[t].option.grid[e].show&&(chartList[t].option.grid[e].height="0%",chartList[t].option.grid[e].top="200%")})),1==r.length)chartList[t].option.grid[0].height="100%";else if(2==r.length)chartList[t].option.grid[0].height="65%",chartList[t].option.grid[r[1]].top="70%",chartList[t].option.grid[r[1]].height="30%";else{chartList[t].option.grid[0].height="50%";for(var a=1;a<r.length;a++){let e=50/(r.length-1),i=55+e*(a-1);chartList[t].option.grid[r[a]].height=e-5+"%",chartList[t].option.grid[r[a]].top=i+"%"}}e&&chartList[t].graph.setOption(chartList[t].option)}function addGrid(t){return chartList[t].option.grid.push({left:"0px",right:"30px",top:"75%",height:"25%",containLabel:!0,borderColor:"#1d2435",show:!0,tooltip:{trigger:"axis"}}),chartList[t].option.xAxis.push({type:"category",data:chartList[t].option.xAxis[0].data,gridIndex:chartList[t].option.grid.length-1,axisLabel:{margin:8,textStyle:{fontSize:"18px",color:"#a1a1a1"}},axisTick:{show:!1},axisPointer:{show:!0,lineStyle:{color:"#4a505f",type:"solid"},label:{shadowBlur:0,margin:0,backgroundColor:"#4f576d",color:"#f7f8f9"}},splitLine:{show:!0,lineStyle:{color:"#303745",type:"solid"}}}),chartList[t].option.yAxis.push({scale:!0,gridIndex:chartList[t].option.grid.length-1,position:"right",boundaryGap:["10%","10%"],triggerEvent:!0,nameGap:100,axisLabel:{textStyle:{fontSize:".18rem",color:"#a1a1a1"},align:"left"},axisTick:{show:!1},axisLine:{show:!1,lineStyle:{color:"#3d4554"}},axisPointer:{show:!0,lineStyle:{color:"#4a505f",type:"solid"},label:{shadowBlur:0,margin:0,backgroundColor:"#4f576d",color:"#f7f8f9"}},splitLine:{show:!0,lineStyle:{color:"#303745",type:"solid"}}}),chartList[t].option.dataZoom.push({type:"inside",xAxisIndex:[0,chartList[t].option.grid.length],startValue:chartList[t].data.length-100,endValue:chartList[t].data.length}),refreshGridSize(t,!1),_defineContainerColor(t,!1),chartList[t].graph.setOption(chartList[t].option),chartList[t].option.grid.length}function addLineChart(t,e,r,a,i=2,o="solid"){chartList[t].option.series[a].markLine.data.push({yAxis:r,symbol:"circle",symbolSize:[0,0],lineStyle:{color:e,width:i,type:o}}),chartList[t].graph.setOption(chartList[t].option)}function addEMA(t,e=generateIndicatorIndex(),r=14,a="#c21b26",i=1,o=!1){return o?EMA.calculate({period:r,values:chartList[t].data}):(chartIndicator[t][e]={indicator:"EMA",serieIndex:chartList[t].option.series.length,gridIndex:0,parms:{period:r,colour:a,thickness:i}},addIndicatorGraph(t,EMA.calculate({period:r,values:chartList[t].data}),a,i,"EMA ("+r+")"),{index:e,title:"EMA ("+r+")"})}function updateEMA(t,e){let r=chartIndicator[t][e],a=addEMA(t,e,r.parms.period,r.parms.colour,r.parms.thickness,!0);a=formatDataGraph(a),chartList[t].option.series[parseInt(r.serieIndex)].data=$.merge(generateEmptyDataStart(a.length,chartList[t].data_candles.length),a)}function changeEMA(t,e,r){chartIndicator[t][e].parms.period=parseInt(r.period),chartIndicator[t][e].parms.thickness=r.thickness,chartIndicator[t][e].parms.colour=r.colour;let a=chartIndicator[t][e];chartList[t].option.series[a.serieIndex].lineStyle={color:r.colour,width:r.thickness},chartList[t].option.series[a.serieIndex].name="EMA ("+r.period+")",$('[tid="EMA"][cid="'+e+'"]').find("span").html("EMA ("+r.period+")"),updateSMA(t,e),chartList[t].graph.setOption(chartList[t].option)}function addSMA(t,e=generateIndicatorIndex(),r=14,a="#da4931",i=1,o=!1){return o?SMA.calculate({period:r,values:chartList[t].data}):(chartIndicator[t][e]={indicator:"SMA",gridIndex:0,serieIndex:chartList[t].option.series.length,parms:{period:r,colour:a,thickness:i}},addIndicatorGraph(t,SMA.calculate({period:r,values:chartList[t].data}),a,i,"SMA ("+r+")"),{index:e,title:"SMA ("+r+")"})}function updateSMA(t,e){let r=chartIndicator[t][e],a=addSMA(t,e,r.parms.period,r.parms.colour,r.parms.thickness,!0);a=formatDataGraph(a),chartList[t].option.series[parseInt(r.serieIndex)].data=$.merge(generateEmptyDataStart(a.length,chartList[t].data_candles.length),a)}function changeSMA(t,e,r){chartIndicator[t][e].parms.period=parseInt(r.period),chartIndicator[t][e].parms.thickness=r.thickness,chartIndicator[t][e].parms.colour=r.colour;let a=chartIndicator[t][e];chartList[t].option.series[a.serieIndex].lineStyle={color:r.colour,width:r.thickness},chartList[t].option.series[a.serieIndex].name="SMA ("+r.period+")",$('[tid="SMA"][cid="'+e+'"]').find("span").html("SMA ("+r.period+")"),updateSMA(t,e),chartList[t].graph.setOption(chartList[t].option)}function addBBANDS(t,e=generateIndicatorIndex(),r=20,a=2,i="#5ff347",o=1,n="#18dae6",d=1,s="#c21b26",c=1,l=!1){let p=[],h=[],I=[];return $.each(BollingerBands.calculate({period:r,values:chartList[t].data,stdDev:a}),(function(t,e){p.push(e.middle),h.push(e.upper),I.push(e.lower)})),l?{middle:p,upper:h,lower:I}:(chartIndicator[t][e]={indicator:"BBANDS",gridIndex:0,serieIndex:chartList[t].option.series.length,parms:{period:r,deviation:a,uppercolor:i,upperthickness:o,middlecolor:n,middlethickness:d,lowercolor:s,lowerthickness:c}},addIndicatorGraph(t,h,i,o,"BBANDS Upper ("+r+", "+a+")"),addIndicatorGraph(t,p,n,d,"BBANDS Middle ("+r+", "+a+")"),addIndicatorGraph(t,I,s,c,"BBANDS Lower ("+r+", "+a+")"),{index:e,title:"BBANDS ("+r+", "+a+")"})}function updateBBANDS(t,e){let r=chartIndicator[t][e],a=addBBANDS(t,e,r.parms.period,r.parms.deviation,r.parms.uppercolor,r.parms.upperthickness,r.parms.middlecolor,r.parms.middlethickness,r.parms.lowercolor,r.parms.lowerthickness,!0);a.upper=formatDataGraph(a.upper),a.middle=formatDataGraph(a.middle),a.lower=formatDataGraph(a.lower),chartList[t].option.series[parseInt(r.serieIndex)].data=$.merge(generateEmptyDataStart(a.upper.length,chartList[t].data_candles.length),a.upper),chartList[t].option.series[parseInt(r.serieIndex)+1].data=$.merge(generateEmptyDataStart(a.middle.length,chartList[t].data_candles.length),a.middle),chartList[t].option.series[parseInt(r.serieIndex)+2].data=$.merge(generateEmptyDataStart(a.lower.length,chartList[t].data_candles.length),a.lower)}function changeBBANDS(t,e,r){chartIndicator[t][e].parms.deviation=parseInt(r.deviation),chartIndicator[t][e].parms.lowercolor=r.lower_colour,chartIndicator[t][e].parms.lowerthickness=r.thickness,chartIndicator[t][e].parms.middlecolor=r.middle_colour,chartIndicator[t][e].parms.middlethickness=r.thickness,chartIndicator[t][e].parms.period=parseInt(r.period),chartIndicator[t][e].parms.uppercolor=r.upper_colour,chartIndicator[t][e].parms.upperthickness=r.thickness;let a=chartIndicator[t][e];chartList[t].option.series[a.serieIndex].lineStyle={color:r.upper_colour,width:r.thickness},chartList[t].option.series[a.serieIndex].name="BBANDS Upper ("+r.period+", "+r.deviation+")",chartList[t].option.series[a.serieIndex+1].lineStyle={color:r.middle_colour,width:r.thickness},chartList[t].option.series[a.serieIndex+1].name="BBANDS Middle ("+r.period+", "+r.deviation+")",chartList[t].option.series[a.serieIndex+2].lineStyle={color:r.lower_colour,width:r.thickness},chartList[t].option.series[a.serieIndex+2].name="BBANDS Lower ("+r.period+", "+r.deviation+")",$('[tid="BBANDS"][cid="'+e+'"]').find("span").html("BBANDS ("+r.period+", "+r.deviation+")"),updateBBANDS(t,e),chartList[t].graph.setOption(chartList[t].option)}function addMACD(t,e=generateIndicatorIndex(),r=12,a=26,i=9,o=1,n="#5ff347",d="#18dae6",s="#df2323",c="#29c359",l=!1){let p=null;l||(p=addGrid(t));let h=[],I=[],u=[];return $.each(MACD.calculate({values:chartList[t].data,fastPeriod:r,slowPeriod:a,signalPeriod:i,SimpleMAOscillator:!1,SimpleMASignal:!1}),(function(t,e){h.push(e.signal),I.push(e.MACD),u.push(e.histogram)})),l?{signalData:h,macd:I,histogram:u}:(chartIndicator[t][e]={indicator:"MACD",gridIndex:p,serieIndex:chartList[t].option.series.length,parms:{fastperiod:r,slowPeriod:a,signalPeriod:i,thickness:o,macd_colour:n,signal_colour:d,historgram_up_colour:s,historgram_low_colour:c}},addIndicatorGraph(t,u,(function(t){return t.data>=0?s:c}),1,"MACD ("+r+", "+a+", "+i+")",p,"bar"),addIndicatorGraph(t,I,n,o,"DEA ("+r+", "+a+", "+i+")",p,"line"),addIndicatorGraph(t,h,d,o,"DIF ("+r+", "+a+", "+i+")",p,"line"),{index:e,title:"MACD ("+r+", "+a+", "+i+")"})}function updateMACD(t,e){let r=chartIndicator[t][e],a=addMACD(t,e,r.parms.fastperiod,r.parms.slowPeriod,r.parms.signalPeriod,r.parms.thickness,r.parms.macd_colour,r.parms.signal_colour,r.parms.historgram_up_colour,r.parms.historgram_low_colour,!0);a.macd=formatDataGraph(a.macd),a.signalData=formatDataGraph(a.signalData),chartList[t].option.series[parseInt(r.serieIndex)].data=$.merge(generateEmptyDataStart(a.histogram.length,chartList[t].data_candles.length),a.histogram),chartList[t].option.series[parseInt(r.serieIndex)+1].data=$.merge(generateEmptyDataStart(a.macd.length,chartList[t].data_candles.length),a.macd),chartList[t].option.series[parseInt(r.serieIndex)+2].data=$.merge(generateEmptyDataStart(a.signalData.length,chartList[t].data_candles.length),a.signalData)}function changeMACD(t,e,r){chartIndicator[t][e].parms.fastperiod=parseInt(r.fastperiod),chartIndicator[t][e].parms.slowPeriod=parseInt(r.slowperiod),chartIndicator[t][e].parms.signalPeriod=parseInt(r.signalperiod),chartIndicator[t][e].parms.thickness=r.thickness,chartIndicator[t][e].parms.macd_colour=r.macd_colour,chartIndicator[t][e].parms.signal_colour=r.signal_colour;let a=chartIndicator[t][e];chartList[t].option.series[a.serieIndex+1].lineStyle={color:r.macd_colour,width:r.thickness},chartList[t].option.series[a.serieIndex+1].name="DEA ("+r.fastperiod+", "+r.slowperiod+", "+r.signalperiod+")",chartList[t].option.series[a.serieIndex+2].lineStyle={color:r.signal_colour,width:r.thickness},chartList[t].option.series[a.serieIndex+2].name="DIF ("+r.fastperiod+", "+r.slowperiod+", "+r.signalperiod+")",$('[tid="MACD"][cid="'+e+'"]').find("span").html("MACD ("+r.fastperiod+", "+r.slowperiod+", "+r.signalperiod+")"),updateMACD(t,e),chartList[t].graph.setOption(chartList[t].option)}function addATR(t,e=generateIndicatorIndex(),r=14,a="#ef642e",i=1,o=!1){let n=null;o||(n=addGrid(t));let d={high:[],low:[],close:[],period:r};return $.each(chartList[t].data_candles,(function(t,e){d.high.push(e.high),d.low.push(e.low),d.close.push(e.close)})),o?ATR.calculate(d):(chartIndicator[t][e]={indicator:"ATR",gridIndex:n,serieIndex:chartList[t].option.series.length,parms:{period:r,colour:a,thickness:i}},addIndicatorGraph(t,ATR.calculate(d),a,i,"ATR ("+r+")",n,"line"),{index:e,title:"ATR ("+r+")"})}function updateATR(t,e){let r=chartIndicator[t][e],a=addATR(t,e,r.parms.period,r.parms.color,r.parms.thickness,!0);a=formatDataGraph(a),chartList[t].option.series[parseInt(r.serieIndex)].data=$.merge(generateEmptyDataStart(a.length,chartList[t].data_candles.length),a)}function changeATR(t,e,r){chartIndicator[t][e].parms.period=parseInt(r.period),chartIndicator[t][e].parms.thickness=r.thickness,chartIndicator[t][e].parms.colour=r.colour;let a=chartIndicator[t][e];chartList[t].option.series[a.serieIndex].lineStyle={color:r.colour,width:r.thickness},chartList[t].option.series[a.serieIndex].name="ATR ("+r.period+")",$('[tid="ATR"][cid="'+e+'"]').find("span").html("ATR ("+r.period+")"),updateSMA(t,e),chartList[t].graph.setOption(chartList[t].option)}function addSO(t,e=generateIndicatorIndex(),r=14,a=3,i=1,o=80,n="#5ff347",d=20,s="#c21b26",c="#d0e521",l="#18dae6",p=!1){let h=null;p||(h=addGrid(t));let I={high:[],low:[],close:[],period:r,signalPeriod:a};$.each(chartList[t].data_candles,(function(t,e){I.high.push(e.high),I.low.push(e.low),I.close.push(e.close)}));let u=[],m=[];return $.each(Stochastic.calculate(I),(function(t,e){u.push(e.k),m.push(e.d)})),p?{k:u,d:m}:(chartIndicator[t][e]={indicator:"SO",gridIndex:h,serieIndex:chartList[t].option.series.length,parms:{kPeriod:r,dPeriod:a,thickness:i,overbuy:o,overbuy_color:n,oversell:d,oversell_color:s,kseries_color:c,dseries_color:l}},addIndicatorGraph(t,u,c,i,"SO K ("+r+", "+a+")",h,"line"),addIndicatorGraph(t,m,l,i,"SO D ("+r+", "+a+")",h,"line"),addLineChart(t,n,o,chartList[t].option.series.length-1),addLineChart(t,s,d,chartList[t].option.series.length-1),{index:e,title:"SO ("+r+", "+a+")"})}function updateSO(t,e){let r=chartIndicator[t][e],a=addSO(t,e,r.parms.kPeriod,r.parms.dPeriod,r.parms.thickness,r.parms.overbuy,r.parms.overbuy_color,r.parms.oversell,r.parms.oversell_color,r.parms.kseries_color,r.parms.dseries_color,!0);a.d=formatDataGraph(a.d),a.k=formatDataGraph(a.k),chartList[t].option.series[parseInt(r.serieIndex)].data=$.merge(generateEmptyDataStart(a.d.length,chartList[t].data_candles.length),a.d),chartList[t].option.series[parseInt(r.serieIndex)+1].data=$.merge(generateEmptyDataStart(a.k.length,chartList[t].data_candles.length),a.k)}function changeSO(t,e,r){chartIndicator[t][e].parms.kPeriod=parseInt(r.kperiod),chartIndicator[t][e].parms.dPeriod=parseInt(r.dperiod),chartIndicator[t][e].parms.thickness=r.thickness,chartIndicator[t][e].parms.overbuy=r.overbuy_value,chartIndicator[t][e].parms.overbuy_color=r.overbuy_color,chartIndicator[t][e].parms.oversell=r.oversold_value,chartIndicator[t][e].parms.oversell_color=r.oversold_color,chartIndicator[t][e].parms.kseries_color=r.kseries_color,chartIndicator[t][e].parms.dseries_color=r.dseries_color;let a=chartIndicator[t][e];chartList[t].option.series[a.serieIndex].lineStyle={color:r.dseries_color,width:r.thickness},chartList[t].option.series[a.serieIndex].name="SO D ("+r.kperiod+", "+r.dperiod+")",chartList[t].option.series[a.serieIndex+1].lineStyle={color:r.kseries_color,width:r.thickness},chartList[t].option.series[a.serieIndex+1].name="SO K ("+r.kperiod+", "+r.dperiod+")",chartList[t].option.series[a.serieIndex+1].markLine.data[0].lineStyle.color=r.overbuy_color,chartList[t].option.series[a.serieIndex+1].markLine.data[0].yAxis=r.overbuy_value,chartList[t].option.series[a.serieIndex+1].markLine.data[1].lineStyle.color=r.oversold_color,chartList[t].option.series[a.serieIndex+1].markLine.data[1].yAxis=r.oversold_value,$('[tid="SO"][cid="'+e+'"]').find("span").html("SO ("+r.kperiod+", "+r.dperiod+")"),updateSO(t,e),chartList[t].graph.setOption(chartList[t].option)}function addRSI(t,e=generateIndicatorIndex(),r=14,a="#18dae6",i=1,o=70,n="#5ff347",d=30,s="#c21b26",c=!1){let l=null;return c||(l=addGrid(t)),c?RSI.calculate({values:chartList[t].data,period:r}):(chartIndicator[t][e]={indicator:"RSI",gridIndex:l,serieIndex:chartList[t].option.series.length,parms:{period:r,color:a,thickness:i,over:o,over_color:n,under:d,under_color:s}},addIndicatorGraph(t,RSI.calculate({values:chartList[t].data,period:r}),a,i,"RSI ("+r+")",l,"line"),addLineChart(t,n,o,chartList[t].option.series.length-1),addLineChart(t,s,d,chartList[t].option.series.length-1),{index:e,title:"RSI ("+r+")"})}function updateRSI(t,e){let r=chartIndicator[t][e],a=addRSI(t,e,r.parms.period,r.parms.color,r.parms.thickness,r.parms.over,r.parms.over_color,r.parms.under,r.parms.under_color,!0);a=formatDataGraph(a),chartList[t].option.series[parseInt(r.serieIndex)].data=$.merge(generateEmptyDataStart(a.length,chartList[t].data_candles.length),a)}function changeRSI(t,e,r){chartIndicator[t][e].parms.period=parseInt(r.period),chartIndicator[t][e].parms.color=r.colour,chartIndicator[t][e].parms.thickness=r.thickness,chartIndicator[t][e].parms.over=r.over_value,chartIndicator[t][e].parms.over_color=r.over_color,chartIndicator[t][e].parms.under=r.under_value,chartIndicator[t][e].parms.under_color=r.under_color;let a=chartIndicator[t][e];chartList[t].option.series[a.serieIndex].lineStyle={color:r.colour,width:r.thickness},chartList[t].option.series[a.serieIndex].name="RSI ("+r.period+")",chartList[t].option.series[a.gridIndex].markLine.data[0].lineStyle.color=r.over_color,chartList[t].option.series[a.gridIndex].markLine.data[0].yAxis=r.over_value,chartList[t].option.series[a.serieIndex].markLine.data[1].lineStyle.color=r.under_color,chartList[t].option.series[a.serieIndex].markLine.data[1].yAxis=r.under_value,$('[tid="RSI"][cid="'+e+'"]').find("span").html("SO ("+r.period+")"),updateRSI(t,e),chartList[t].graph.setOption(chartList[t].option)}function addCCI(t,e=generateIndicatorIndex(),r=14,a="#5ff347",i=1,o="#eda129",n=!1){let d=null;n||(d=addGrid(t));let s={open:[],high:[],low:[],close:[],period:r};return $.each(chartList[t].data_candles,(function(t,e){s.high.push(e.high),s.low.push(e.low),s.close.push(e.close),s.open.push(e.open)})),n?CCI.calculate(s):(chartIndicator[t][e]={indicator:"CCI",gridIndex:d,serieIndex:chartList[t].option.series.length,parms:{period:r,color:a,thickness:i,color_trend:o}},addIndicatorGraph(t,CCI.calculate(s),a,i,"CCI ("+r+")",d,"line"),addLineChart(t,o,100,chartList[t].option.series.length-1,1),addLineChart(t,o,-100,chartList[t].option.series.length-1,1),{index:e,title:"CCI ("+r+")"})}function updateCCI(t,e){let r=chartIndicator[t][e],a=addCCI(t,e,r.parms.period,r.parms.color,r.parms.thickness,r.parms.color_trend,!0);a=formatDataGraph(a),chartList[t].option.series[parseInt(r.serieIndex)].data=$.merge(generateEmptyDataStart(a.length,chartList[t].data_candles.length),a)}function changeCCI(t,e,r){chartIndicator[t][e].parms.period=parseInt(r.period),chartIndicator[t][e].parms.color=r.colour,chartIndicator[t][e].parms.thickness=r.thickness,chartIndicator[t][e].parms.color_trend=r.colour_trend;let a=chartIndicator[t][e];chartList[t].option.series[a.serieIndex].lineStyle={color:r.colour,width:r.thickness},chartList[t].option.series[a.serieIndex].name="CCI ("+r.period+")",chartList[t].option.series[a.gridIndex].markLine.data[0].lineStyle.color=r.colour_trend,chartList[t].option.series[a.serieIndex].markLine.data[1].lineStyle.color=r.colour_trend,$('[tid="CCI"][cid="'+e+'"]').find("span").html("CCI ("+r.period+")"),updateCCI(t,e),chartList[t].graph.setOption(chartList[t].option)}function addROC(t,e=generateIndicatorIndex(),r=12,a="#5ff347",i=1,o=!1){let n=null;return o||(n=addGrid(t)),o?ROC.calculate({values:chartList[t].data,period:r}):(chartIndicator[t][e]={indicator:"ROC",gridIndex:n,serieIndex:chartList[t].option.series.length,parms:{period:r,color:a,thickness:i}},addIndicatorGraph(t,ROC.calculate({values:chartList[t].data,period:r}),a,i,"ROC ("+r+")",n,"line"),addLineChart(t,"#f5f5f5",0,chartList[t].option.series.length-1,1,"dashed"),{index:e,title:"ROC ("+r+")"})}function updateROC(t,e){let r=chartIndicator[t][e],a=addROC(t,e,r.parms.period,r.parms.color,r.parms.thickness,!0);a=formatDataGraph(a),chartList[t].option.series[parseInt(r.serieIndex)].data=$.merge(generateEmptyDataStart(a.length,chartList[t].data_candles.length),a)}function changeROC(t,e,r){chartIndicator[t][e].parms.period=parseInt(r.period),chartIndicator[t][e].parms.color=r.colour,chartIndicator[t][e].parms.thickness=r.thickness;let a=chartIndicator[t][e];chartList[t].option.series[a.serieIndex].lineStyle={color:r.colour,width:r.thickness},chartList[t].option.series[a.serieIndex].name="ROC ("+r.period+")",$('[tid="ROC"][cid="'+e+'"]').find("span").html("ROC ("+r.period+")"),updateROC(t,e),chartList[t].graph.setOption(chartList[t].option)}function addADX(t,e=generateIndicatorIndex(),r=14,a=1,i="#5ff347",o="#da4931",n="#c21b26",d=!1){let s=null;d||(s=addGrid(t));let c={high:[],low:[],close:[],period:r};$.each(chartList[t].data_candles,(function(t,e){c.high.push(e.high),c.low.push(e.low),c.close.push(e.close)}));let l=[],p=[],h=[];return $.each(ADX.calculate(c),(function(t,e){l.push(e.adx),p.push(e.mdi),h.push(e.pdi)})),d?{adx:l,mdi:p,pdi:h}:(chartIndicator[t][e]={indicator:"ADX",gridIndex:s,serieIndex:chartList[t].option.series.length,parms:{period:r,thickness:a,adxcolor:i,mdicolor:o,pdicolor:n}},addIndicatorGraph(t,l,i,a,"ADX ("+r+")",s,"line"),addIndicatorGraph(t,p,o,a,"MDI ("+r+")",s,"line"),addIndicatorGraph(t,h,n,a,"PDI ("+r+")",s,"line"),{index:e,title:"ADX ("+r+")"})}function updateADX(t,e){let r=chartIndicator[t][e],a=addADX(t,e,r.parms.period,r.parms.thickness,r.parms.adxcolor,r.parms.mdicolor,r.parms.pdicolor,!0);a.adx=formatDataGraph(a.adx),a.mdi=formatDataGraph(a.mdi),a.pdi=formatDataGraph(a.pdi),chartList[t].option.series[parseInt(r.serieIndex)].data=$.merge(generateEmptyDataStart(a.adx.length,chartList[t].data_candles.length),a.adx),chartList[t].option.series[parseInt(r.serieIndex)+1].data=$.merge(generateEmptyDataStart(a.adx.length,chartList[t].data_candles.length),a.mdi),chartList[t].option.series[parseInt(r.serieIndex)+2].data=$.merge(generateEmptyDataStart(a.adx.length,chartList[t].data_candles.length),a.pdi)}function changeADX(t,e,r){chartIndicator[t][e].parms.period=parseInt(r.period),chartIndicator[t][e].parms.thickness=r.thickness,chartIndicator[t][e].parms.adxcolor=r.adxseries_color,chartIndicator[t][e].parms.mdicolor=r.ndi_color,chartIndicator[t][e].parms.pdicolor=r.pdi_color;let a=chartIndicator[t][e];chartList[t].option.series[a.serieIndex].lineStyle={color:r.adxseries_color,width:r.thickness},chartList[t].option.series[a.serieIndex].name="ADX ("+r.period+")",chartList[t].option.series[a.serieIndex+1].lineStyle={color:r.ndi_color,width:r.thickness},chartList[t].option.series[a.serieIndex+1].name="MDI ("+r.period+")",chartList[t].option.series[a.serieIndex+2].lineStyle={color:r.pdi_color,width:r.thickness},chartList[t].option.series[a.serieIndex+2].name="PDI ("+r.period+")",$('[tid="ADX"][cid="'+e+'"]').find("span").html("ADX ("+r.period+")"),updateADX(t,e),chartList[t].graph.setOption(chartList[t].option)}function updateGraphIndicator(t){$.each(chartIndicator[t],(function(e,r){"EMA"==r.indicator&&updateEMA(t,e),"SMA"==r.indicator&&updateSMA(t,e),"BBANDS"==r.indicator&&updateBBANDS(t,e),"ATR"==r.indicator&&updateATR(t,e),"MACD"==r.indicator&&updateMACD(t,e),"SO"==r.indicator&&updateSO(t,e),"CMF"==r.indicator&&updateCMF(t,e),"RSI"==r.indicator&&updateRSI(t,e),"CCI"==r.indicator&&updateCCI(t,e),"ROC"==r.indicator&&updateROC(t,e),"ADX"==r.indicator&&updateADX(t,e)}))}function initIndicatorsGraph(t){(t=$('.dash-pan-cry[id="'+t+'"]')).find(".dash-pan-ads-i > ul > li").each((function(){let e=$(this),r=$(this).attr("id-args").split(",");0==$(this).attr("id-args").length&&(r=[]),"EMA"==e.attr("tid")&&addEMA(t.attr("id"),e.attr("cid"),parseInt(r[0]),r[1],r[2]),"SMA"==e.attr("tid")&&addSMA(t.attr("id"),e.attr("cid"),parseInt(r[0]),r[1],r[2]),"BBANDS"==e.attr("tid")&&addBBANDS(t.attr("id"),e.attr("cid"),parseInt(r[0]),parseInt(r[1]),r[3],r[2],r[4],r[2],r[5],r[2]),"ATR"==e.attr("tid")&&addATR(t.attr("id"),e.attr("cid"),parseInt(r[0]),r[1],r[2]),"MACD"==e.attr("tid")&&addMACD(t.attr("id"),e.attr("cid"),parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3]),r[4],r[5],r[6]),"SO"==e.attr("tid")&&addSO(t.attr("id"),e.attr("cid"),parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),r[3],r[4],r[5],r[6],r[7],r[8],r[9]),"CCI"==e.attr("tid")&&addCCI(t.attr("id"),e.attr("cid"),parseInt(r[0]),r[1],r[2],r[3]),"ROC"==e.attr("tid")&&addROC(t.attr("id"),e.attr("cid"),parseInt(r[0]),r[1],r[2]),"ADX"==e.attr("tid")&&addADX(t.attr("id"),e.attr("cid"),parseInt(r[0]),r[1],r[2],r[3],r[4],r[5]),"RSI"==e.attr("tid")&&addRSI(t.attr("id"),e.attr("cid"),parseInt(r[0]),r[1],r[2],r[3],r[4],r[5],r[6]),$(this).find(".fa-cog").off("click").click((function(){editIndicator(t.attr("id"),e.attr("tid"),e.attr("cid"))})),$(this).find(".fa-eye").off("click").click((function(){toggleIndicatorGraph(t.attr("id"),parseInt(e.attr("cid"))-1,e.attr("tid"))})),$(this).find(".fa-trash").off("click").click((function(){deleteIndicatorGraph(t.attr("id"),parseInt(e.attr("cid"))-1,e.attr("tid"))}))}))}function updateIndicatorStyle(t){"EMA"==t.indicator&&changeEMA(t.container,t.indicator_key,t.data),"SMA"==t.indicator&&changeSMA(t.container,t.indicator_key,t.data),"BBANDS"==t.indicator&&changeBBANDS(t.container,t.indicator_key,t.data),"ATR"==t.indicator&&changeATR(t.container,t.indicator_key,t.data),"MACD"==t.indicator&&changeMACD(t.container,t.indicator_key,t.data),"SO"==t.indicator&&changeSO(t.container,t.indicator_key,t.data),"CCI"==t.indicator&&changeCCI(t.container,t.indicator_key,t.data),"ROC"==t.indicator&&changeROC(t.container,t.indicator_key,t.data),"ADX"==t.indicator&&changeADX(t.container,t.indicator_key,t.data),"RSI"==t.indicator&&changeRSI(t.container,t.indicator_key,t.data)}function toggleIndicatorGraph(t,e,r,a=!1){let i=chartIndicator[t][e+1];nSeries=1,"BBANDS"==r&&(nSeries=3),"MACD"==r&&(nSeries=3),"SO"==r&&(nSeries=2),"ADX"==r&&(nSeries=3);let o=1;try{o=chartList[t].option.series[i.serieIndex].lineStyle.opacity}catch(e){o=chartList[t].option.series[i.serieIndex].itemStyle.opacity}a&&(o=1);for(var n=i.serieIndex;n<=i.serieIndex+(nSeries-1);n++){try{chartList[t].option.series[n].lineStyle.opacity=0==o?1:0,chartList[t].option.series[n].symbolSize=0==o?5:0}catch(e){chartList[t].option.series[n].itemStyle.opacity=0==o?1:0}$('[cid="'+(e+1)+'"][tid="'+r+'"]').find(".fa-eye").css("fill",0==o?"#f4f6ff":"#515461")}0!=i.gridIndex&&(chartList[t].option.grid[i.gridIndex-1].show=0==o,refreshGridSize(t,!1)),chartList[t].graph.setOption(chartList[t].option)}function deleteIndicatorGraph(t,e,r){toggleIndicatorGraph(t,e,r,!0),$('li[cid="'+(e+1)+'"]').remove(),$.post($("body").attr("hrefapp")+"/app/modules/dashboard/src/actions/removeIndicator.php",{chart:t,indic:r,key:e}).done((function(t){let e=jQuery.parseJSON(t);1==e.error&&showAlert("Oops",e.msg,"error")})).fail((function(){showAlert("Ooops","Fail to delete indicator","error")}))}
