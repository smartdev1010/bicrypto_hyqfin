function initManageDashboard(){initCoinGraphControllers(),$(".change-dashboard").click((function(){showDashboardManager()})),$(document).mouseup((function(t){var a=$(".change-dashboard-selector");a.is(t.target)||0!==a.has(t.target).length||hideDashboardManager()}))}function addTopListGraphN(t,a,i){}let listCoinGraphQuery=null;function updateListCoinGraph(t=null,a=null,i=null,e=!0,n=0){$(".dash-pan-cry-select-lst").off("scroll").scroll((function(){$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&updateListCoinGraph(t,a,i,!1,$(this).find("li").length+15)})),clearTimeout(listCoinGraphQuery),listCoinGraphQuery=null,listCoinGraphQuery=setTimeout((function(){$.get($("body").attr("hrefapp")+"/app/modules/dashboard/src/actions/getCoinList.php",{q:t,s:n}).done((function(n){let o=jQuery.parseJSON(n);e&&$('.dash-pan-cry-select[graph="'+a+'"]').find("ul.dash-pan-cry-select-lst").html(""),$.each(o,(function(e,n){let o=$('<li class="'+(null==t||0==t.length?"animated flipInX":"")+'"><div class="dash-pan-cry-select-lst-i"><div>'+n.icon+"</div><div><label>"+n.name+'</label><span class="mono">'+n.symbol+'</span></div></div><div class="dash-pan-cry-select-lst-tdn '+($('.wtchl-item[symbol="'+n.symbol+'"]').length>0?"watching-list-present":"")+'" symbol="'+n.symbol+'"><span></span></div></li>');o.click((function(){if("cryptocompare"==n.source)null!=i?i(n):addTopListGraph(n);else{let t="https://wallet.crypto-bridge.org/market/BRIDGE.XXXXXXX_BRIDGE.BTC",a=n.symbol.split("_");t=t.replace("XXXXXXX",a[0]),changeView("mining","iframe",{url:t})}}));let r=$('<i class="gw fa-duotone fa-star"></i>');r.click((function(t){return toggleWatchingList(n.symbol,n.currency),t.preventDefault(),!1})),o.find(".dash-pan-cry-select-lst-tdn").find("span").append(r),$('.dash-pan-cry-select[graph="'+a+'"]').find("ul.dash-pan-cry-select-lst").append(o)}))})).fail((function(){showAlert("Ooops","Fail to load coin list","error")}))}),300)}function showDashboardManager(){$(".change-dashboard-selector").show()}function hideDashboardManager(){$(".change-dashboard-selector").hide()}function initCoinGraphControllers(){$(".dash-pan-cry").each((function(){let t=$(this).attr("id");$(this).off("click").click((function(){$(".dash-pan-cry").removeClass("dash-pan-cry-selected"),$(this).addClass("dash-pan-cry-selected"),changeSelectedTopList($(this).attr("container"),$(this).attr("symbol"),$(this).attr("currency"),$(this).attr("market"))}));let a=$(this).attr("id");$(this).find(".dash-pan-tb-nopt-n").off("click").click((function(){showListCoinChangeGraph(a)})),$(this).find(".dash-pan-lgl").off("click").click((function(){})),$(this).find(".dash-pan-ads-sld").off("click").click((function(){showIndicator(a)})),$(this).find('[graph-ctype="line"]').off("click").click((function(){chartList[t].option.series[0].itemStyle.normal.opacity=0,chartList[t].option.series[1].lineStyle.opacity=1,chartList[t].option.series[1].areaStyle.normal.opacity=1,newType="line",chartList[t].graph.setOption(chartList[t].option);let a=$(this).find("svg").clone();$(this).parent().parent().find("div").html(a),$.post($("body").attr("hrefapp")+"/app/modules/dashboard/src/actions/changeTypeGraph.php",{graph_id:$("#"+t).attr("graph-id"),type:newType}).done((function(t){jQuery.parseJSON(t).error})).fail((function(){showAlert("Oops","Fail to change type graph in database","error")}))})),$(this).find('[graph-ctype="candlestick"]').off("click").click((function(){chartList[t].option.series[0].itemStyle.normal.opacity=1,chartList[t].option.series[1].lineStyle.opacity=0,chartList[t].option.series[1].areaStyle.normal.opacity=0,newType="candlestick",chartList[t].graph.setOption(chartList[t].option);let a=$(this).find("svg").clone();$(this).parent().parent().find("div").html(a),$.post($("body").attr("hrefapp")+"/app/modules/dashboard/src/actions/changeTypeGraph.php",{graph_id:$("#"+t).attr("graph-id"),type:newType}).done((function(t){jQuery.parseJSON(t).error})).fail((function(){showAlert("Oops","Fail to change type graph in database","error")}))})),$(this).find(".dash-pan-cry-select").find('input[type="text"]').off("keyup").keyup((function(){updateListCoinGraph($(this).val(),$(this).attr("graph"),(function(t){addTopListGraph(t,(function(a){changeGraph(t,$(".dash-pan-cry.dash-pan-cry-selected").attr("currency"),$(".dash-pan-cry.dash-pan-cry-selected").attr("id"),a.attr("topitem"),!0,$(".dash-pan-cry.dash-pan-cry-selected").attr("market"))}))}))})),$(this).find(".dash-tgglfullscreen").off("click").click((function(){toggleGraphFullScreen("#"+t)})),$(this).find(".dash-close").off("click").click((function(){removeGraph(t)})),$(this).find(".dash-export").off("click").click((function(){exportChart(t)}))})),$("[indicator]").off("click").click((function(){createIndicator($(this).attr("graph"),$(this).attr("indicator"))})),$(document).mouseup((function(t){var a=$(".dash-pan-cry-select");a.is(t.target)||0!==a.has(t.target).length||a.hide()}))}function changeGraphType(t="candlestick",a){"line"==t?(chartList[a].option.series[0].itemStyle.normal.opacity=0,chartList[a].option.series[1].lineStyle.opacity=1,chartList[a].option.series[1].areaStyle.normal.opacity=1):"candlestick"==t&&(chartList[a].option.series[0].itemStyle.normal.opacity=1,chartList[a].option.series[1].lineStyle.opacity=0,chartList[a].option.series[1].areaStyle.normal.opacity=0),chartList[a].graph.setOption(chartList[a].option),$.post($("body").attr("hrefapp")+"/app/modules/dashboard/src/actions/changeTypeGraph.php",{graph_id:$("#"+a).attr("graph-id"),type:t}).done((function(t){jQuery.parseJSON(t).error})).fail((function(){showAlert("Oops","Fail to change type graph in database","error")}))}function showListCoinChangeGraph(t,a=!1){let i=$("#"+t).find(".dash-pan-cry-select"),e=$("#"+t),n=$(document).height()-e.position().top-20-(i.height()+i.position().top);n<0&&i.css("top",n+"px");let o=$(document).width()-e.position().left-120-(i.width()+i.position().left);o<0&&i.css("left",o+"px"),i.css("display","flex"),updateListCoinGraph(null,t,(function(a){if("not_init"==e.attr("symbol"))addTopListGraph(a,(function(t){$('.top-graphlist-item[topitem="'+t.attr("topitem")+'"]').attr("container",e.attr("id")),changeGraph(a,$(".dash-pan-cry.dash-pan-cry-selected").attr("currency"),$(".dash-pan-cry.dash-pan-cry-selected").attr("id"),t.attr("topitem"),!0,$(".dash-pan-cry.dash-pan-cry-selected").attr("market"))}));else{let i=$('.top-graphlist-item[container="'+t+'"]').attr("topitem");changeGraph(a,$(".dash-pan-cry.dash-pan-cry-selected").attr("currency"),$(".dash-pan-cry.dash-pan-cry-selected").attr("id"),i,!0,$(".dash-pan-cry.dash-pan-cry-selected").attr("market"))}}))}function showIndicator(t){let a=$("#"+t).find(".dash-pan-ads");a.css("display","flex");let i=$("#"+t);a.offset().top+a.height()>$(document).height()&&a.css("bottom","0px");let e=$(document).width()-i.position().left-120-(a.width()+a.position().left);e<0&&a.css("left",e+"px")}function hideIndicator(){$(".dash-pan-ads").hide()}function editIndicator(t,a,i){$.post($("body").attr("hrefapp")+"/app/modules/dashboard/src/actions/editIndicator.php",{graph:t,indic:a,key:i}).done((function(t){hideIndicator(),$("body").addClass("nblr"),$.when($("body").prepend(t)).then((function(){initEditIndicatorControllers()}))})).fail((function(){showAlert("Ooops","Fail to load edit indicator content","error")}))}function closeEditIndicator(){$(".overley").remove(),$("body").removeClass("nblr")}function initEditIndicatorControllers(){$(".btn-closemashdiv").click((function(){closeEditIndicator()})),$(".indicator-cfg-color").each((function(){let t=$(this);t.find("ul").find(".indicator-cfg-color-cell").off("click").click((function(){t.find(".indicator-cfg-postv").val($(this).attr("color")),t.find(".indicator-cfg-val").css("background-color","#"+$(this).attr("color"))}))})),$(".indicator-cfg-line").each((function(){let t=$(this);t.find("ul").find("li").click((function(){t.find(".indicator-cfg-postv").val($(this).find(".indicator-cfg-line").attr("border")),t.find(".indicator-cfg-val").css("border-bottom-width",$(this).find(".indicator-cfg-line").attr("border")+"px")}))})),$(".btn-resetindicator").off("click").click((function(){$(".indicator-cfg-select").each((function(){$(this).find('input[type="hidden"]').val($(this).attr("default"))})),$(".indicator-cfg-txt").each((function(){$(this).val($(this).attr("default"))})),$(".indicator-update-pst").submit()})),$(".indicator-update-pst").off("submit").submit((function(t){return $.post($(this).attr("action"),$(this).serialize()).done((function(t){let a=jQuery.parseJSON(t);0==a.error?(updateIndicatorStyle(jQuery.parseJSON(t)),closeEditIndicator()):showAlert("Oops",a.msg,"error")})).fail((function(){showAlert("Ooops","Fail to update indicator","error")})),t.preventDefault(),!1}))}let tendance={};function initTendanceGraph(t){tendance.hasOwnProperty($("#"+t).attr("symbol"))||(tendance[$("#"+t).attr("symbol")]={BUY:[],SELL:[]}),subscribeStreamerCallback((function(a){if(a.FromSymbol==$("#"+t).attr("symbol")&&a.ToCurrency==$("#"+t).attr("currency")&&"UNKNOWN"!=a.Type&&-1==jQuery.inArray(a.ID,tendance[a.FromSymbol][a.Type])){tendance[a.FromSymbol][a.Type].push(a.ID),tendance[a.FromSymbol][a.Type].length>=300&&(tendance[a.FromSymbol].BUY=tendance[a.FromSymbol].BUY.slice(0,tendance[a.FromSymbol].BUY.length/2),tendance[a.FromSymbol].SELL=tendance[a.FromSymbol].SELL.slice(0,tendance[a.FromSymbol].SELL.length/2));let i=tendance[a.FromSymbol].SELL.length+tendance[a.FromSymbol].BUY.length;if(i>20){let e=Math.round(10-Math.abs((tendance[a.FromSymbol].BUY.length-i)/i*10));if($("#"+t).find(".dash-pan-com-t > ul > li.dash-pan-com-t-buy").length!=e){let a=10;$("#"+t).find(".dash-pan-com-t > ul").find("li").each((function(){a<=e?$(this).hasClass("dash-pan-com-t-buy")||$(this).addClass("dash-pan-com-t-buy"):$(this).removeClass("dash-pan-com-t-buy"),a-=1}))}}}}),0)}function changeGraphPairSymbol(t,a,i){let e=$(".top-graphlist-item-selected").attr("container"),n=$(".top-graphlist-item-selected").attr("topitem");changeGraph({symbol:t,icon:"1",name:t},a,e,n,!0,i)}
