function changeGraph(t,a,e,o,r=!1,i="CCCAGG"){$("#"+e).find(".dash-pan-graph").html(""),$("#"+e).addClass("dash-pan-cry-vsbl"),$("#"+e).html(""),$("#"+e).attr("symbol",t.symbol),$("#"+e).attr("currency",a),$("#"+e).attr("market",i),$("#"+e).find(".dash-pan-tb-nopt-icon").html(t.icon),$("#"+e).find(".dash-pan-tb-nopt-n > label").html(t.name),$("#"+e).find(".dash-pan-tb-nopt-n > span").html(t.symbol),$("#"+e).attr("chart-init","true"),$(".top-graphlist-item-selected").removeClass("top-graphlist-item-selected"),$('.top-graphlist-item[container="'+e+'"]').addClass("top-graphlist-item-selected"),loadLeftInfosCoin(t.symbol,a,i),loadChart(t.symbol,null,e,a,i),r&&($('.top-graphlist-item[topitem="'+o+'"]').attr("symbol",t.symbol),$('.top-graphlist-item[topitem="'+o+'"]').attr("market",i),$('.top-graphlist-item[topitem="'+o+'"]').attr("currency",a),$('.top-graphlist-item[topitem="'+o+'"]').find('[data="CHANGE24HOURPCT"]').html("~"),$('.top-graphlist-item[topitem="'+o+'"]').find('[data="CHANGE24HOURPCT"]').removeClass("top-graphlist-item-evl-up"),$('.top-graphlist-item[topitem="'+o+'"]').find('[data="CHANGE24HOURPCT"]').removeClass("top-graphlist-item-evl-down"),$('.top-graphlist-item[topitem="'+o+'"]').find(".top-graphlist-inf").find("label").html(($(".wallet-top-real").length>0?i+":":"")+t.symbol+"/"+a),$('.top-graphlist-item[topitem="'+o+'"]').find(".top-graphlist-pic").html(t.icon),addSubscribtion(t.icon,a,5,i)),reloadTopListGraph(),$.post($("body").attr("hrefapp")+"/app/modules/dashboard/src/actions/changeGraph.php",{container:e,topitem:o,coinsymbol:t.symbol,currency:a,market:i}).done((function(t){jQuery.parseJSON(t).error})).fail((function(){showAlert("Ooops","Fail to save graph","error")}))}let oldNChart=null;function toggleGraphFullScreen(t,a=!1){$(".dash-pan-cry").removeClass("animated").removeClass("bounceIn"),$(".dash-pannel").hasClass("dash-pannel-fls")||a?($(".dash-pannel").removeClass("dash-pannel-fls"),$(".dash-pannel").attr("nchart",oldNChart),$(".dash-pan-cry").show(),oldNChart=null):($(".dash-pannel").addClass("dash-pannel-fls"),oldNChart=$(".dash-pannel").attr("nchart"),$(".dash-pannel").attr("nchart","1_single"),$(".dash-pan-cry").hide(),$(t).show()),checkGraphResize()}function removeGraph(t){null!=oldNChart&&toggleGraphFullScreen(null,!0),$.post($("body").attr("hrefapp")+"/app/modules/dashboard/src/actions/deleteGraph.php",{container:t}).done((function(t){let a=jQuery.parseJSON(t);1==a.error&&showAlert("Oops",a.msg,"error")})).fail((function(){showAlert("Oops","Fail to delete graph (404, 500)","error")})),$('.top-graphlist-item[container="'+t+'"]').remove(),$(".dash-pan-cry-selected").removeClass("dash-pan-cry-selected"),$("#"+t).addClass("dash-pan-cry-selected");let a=!1;$.each($(".top-graphlist-item"),(function(){if(!$(this).hasClass("top-graphlist-item-view"))return $(this).trigger("click"),a=!0,!1})),a||($("#"+t).attr("symbol","not_init"),$("#"+t).attr("chart-init","false"),$("#"+t).html('<div class="dash-pan-lgl" onclick="showBigSearch(\'addGraphDashboardNotInit\');"><div class="dash-pan-cry-select" graph="'+$("#"+t).attr("id")+'" style="display: none;"><header><input type="text" name="" graph="'+$("#"+t).attr("id")+'" placeholder="Search by name or symbol" value=""></header><ul class="dash-pan-cry-select-lst"></ul></div><img src="'+$("body").attr("hrefapp")+$("body").attr("logopath")+'" alt=""></div>'),initCoinGraphControllers())}let listNotificationChart=[],listOrderChart=[],listInternalOrderChart=[],chartList=[],chartIndicator=[];var currentValueSelected=null,currentDateSelected=null,dataGraphic=[["10/10/2020 12:00:00",7595]];function loadChart(t,a,e,o,r="CCCAGG"){reloadTopListGraph(),loadLeftInfosIsInitied()||loadLeftInfosCoin(t,o,r),$.get($("body").attr("hrefapp")+"/app/modules/dashboard/src/actions/loadChartContent.php",{coin:t,container:e,currency:o,market:r}).done((function(a){if("not_init"==$("#"+e).attr("symbol"))return!1;try{let t=jQuery.parseJSON(a);1==t.error&&showAlert("Oops",t.msg,"error")}catch(i){$.when($("#"+e).html(a)).then((function(){loadStaticSearchBox(),$(".watching-list-exist-addaction").off("click").click((function(){toggleWatchingList($(this).attr("symbol"),$(this).attr("currency"),$(this).attr("market"))})),$("#"+e).attr("symbol",t),$("#"+e).attr("currency",o),$("#"+e).attr("market",r),loadChartData(t,$("#"+e).attr("currency"),$("#"+e).attr("market"),(function(a){chartIndicator[e]={};let o=[];if($.each(a.candles,(function(t,a){o.push(a.close)})),$("#graph-"+e).length>0){chartList[e]={symbol:t,graph:echarts.init(document.getElementById("graph-"+e)),option:null,data:o,data_candles:a.candles};var r=[],i=[];let n=[],s=[];$.each(a.candles,(function(t,a){r.push(a.date),n.push(a.close),s.push(a.volume),i.push([a.open,a.close,a.low,a.high])})),chartList[e].option={animation:!1,backgroundColor:"#f1f5f8",tooltip:{trigger:"axis",backgroundColor:"rgba(255, 255, 255, 0.8)",textStyle:{color:"#1f1f1f"},axisPointer:{animation:!1,type:"cross",lineStyle:{color:"#d7dce0",width:1,opacity:1,type:"solid"}},extraCssText:"border-radius:1px;box-shadow: 0 2px 3px rgba(0, 0, 0, 0.2);",padding:[6,8]},xAxis:[{type:"category",data:r,gridIndex:0,axisLabel:{margin:8,textStyle:{fontSize:"18px",color:"#abafb3"}},axisPointer:{show:!0,lineStyle:{color:"#d7dce0",type:"solid"},label:{shadowBlur:0,margin:0,backgroundColor:"#4f576d",color:"#f7f8f9"}},axisTick:{show:!1},splitLine:{show:!0,lineStyle:{color:"#d7dce0",type:"solid"}}},{gridIndex:0,show:!1,type:"category",data:r,nameGap:0,axisLabel:{margin:0,show:!1,textStyle:{fontSize:"18px",color:"#abafb3"}},axisPointer:{show:!1,lineStyle:{color:"#d7dce0",type:"solid"},label:{shadowBlur:0,margin:0,backgroundColor:"#4f576d",color:"#f7f8f9"}},axisTick:{show:!1},splitLine:{show:!1,lineStyle:{color:"#d7dce0",type:"solid"}}}],yAxis:[{scale:!0,gridIndex:0,position:"right",boundaryGap:["10%","10%"],triggerEvent:!0,nameGap:100,splitNumber:7,axisLabel:{inside:!1,textStyle:{fontSize:".18rem",color:"#abafb3"}},axisTick:{show:!1,length:7},axisLine:{show:!1},axisPointer:{show:!0,lineStyle:{color:"#d7dce0",type:"solid"},label:{shadowBlur:0,margin:0,backgroundColor:"#4f576d",color:"#f7f8f9"}},splitLine:{show:!0,lineStyle:{color:"#d7dce0",type:"solid"}}},{scale:!0,gridIndex:0,position:"left",boundaryGap:["0%","70%"],triggerEvent:!0,nameGap:0,show:!1,axisTick:{show:!1},axisLine:{show:!1},splitLine:{show:!1},axisLabel:{show:!1},axisPointer:{show:!1}}],grid:[{left:"0px",right:"25px",top:"0px",height:"100%",containLabel:!0,borderColor:"#d7dce0",show:!0,tooltip:{trigger:"axis"}}],dataZoom:[{type:"inside",xAxisIndex:[0,1],start:99,end:100,zoomOnMouseWheel:!0},{show:!0,xAxisIndex:[0,1],type:"slider",top:"90%",start:99,end:100,zoomOnMouseWheel:!0}],progressive:100,series:[{type:"candlestick",name:"",data:i,xAxisIndex:0,yAxisIndex:0,progressive:5e3,progressiveChunkMode:"mod",animation:!0,large:!0,animationDuration:1e3,itemStyle:{normal:{opacity:"candlestick"==$("#"+e).attr("type-graph")?1:0,color:"#2CAC40",color0:"#DB4931",borderColor:"#29c359",borderColor0:"#df2323"}},markPoint:{data:[]},markLine:{symbol:["none","none"],precision:a.current_price>10?2:5,data:[{name:"Current price",yAxis:a.current_price,symbol:["none","none"],symbolSize:[0,0],lineStyle:{color:"#fe4f00",width:1,type:"dashed"},label:{middle:"middle"}}],animation:!1}},{type:"line",name:"",data:n,xAxisIndex:0,yAxisIndex:0,symbolSize:0,lineStyle:{color:"#29c359",opacity:"candlestick"==$("#"+e).attr("type-graph")?0:1},markPoint:{data:[]},markLine:{symbol:["none","none"],animation:!1,lineStyle:{opacity:.4,type:"dashed"},data:[]},areaStyle:{normal:{opacity:"candlestick"==$("#"+e).attr("type-graph")?0:1,color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(41, 195, 89, 0.25)"},{offset:1,color:"rgba(41, 195, 89, 0)"}],!1),shadowColor:"rgba(0, 0, 0, 0.1)",shadowBlur:10}}},{name:"Volume",type:"bar",data:s,itemStyle:{normal:{color:function(t){return s[t.dataIndex-1]>s[t.dataIndex]?"#ef232a":colorList="#14b143"},opacity:.1}},yAxisIndex:1,xAxisIndex:1}]},_defineContainerColor(e),chartList[e].graph.setOption(chartList[e].option),chartList[e].graphic=[],$("#graph-"+e).dblclick((function(){createNewNotification(t,$("#"+e).attr("currency"),currentValueSelected,$("#"+e).attr("market"))})),$("#graph-"+e).click((function(){null!=objectClick&&(objectClick(),unselectSelectedGraphic(),objectClick=null)})),chartList[e].graph.on("updateaxispointer",(function(t){$.each(t.axesInfo,(function(t,a){"y"==a.axisDim&&(currentValueSelected=a.value),"x"==a.axisDim&&(currentDateSelected=a.value)}))})),chartList[e].graph.on("datazoom",(function(t){$.each(chartList[e].option.dataZoom,(function(a,o){"slider"!=chartList[e].option.dataZoom[a].type&&(chartList[e].option.dataZoom[a].hasOwnProperty("start")||chartList[e].option.dataZoom[a].hasOwnProperty("startValue"))&&(chartList[e].option.dataZoom[a].start=t.batch[0].start,chartList[e].option.dataZoom[a].end=t.batch[0].end)})),updateToolboxElementGraphZoomSingle(e)})),initCoinGraphControllers(),syncChart(e),initIndicatorsGraph(e),initTendanceGraph(e),initRangePan(e),initToolboxChartControler(),addSubscribtion($("#"+e).attr("symbol"),$("#"+e).attr("currency"),2,$("#"+e).attr("market")),subscribeStreamerCallback((function(t){if(isNaN(t.CHANGE24HOURPCT))return!1;if(t.FROMSYMBOL==$("#"+e).attr("symbol")&&$("#"+e).attr("currency")==t.TOSYMBOL&&$("#"+e).attr("market").toLowerCase()==t.MARKET.toLowerCase()){let a=chartList[e].option.series[0].data[chartList[e].option.series[0].data.length-1],o=parseFloat(t.PRICE);o>parseFloat(a[3])&&(a[3]=t.PRICE),o<parseFloat(a[2])&&(a[2]=t.PRICE),a[1]=o,chartList[e].option.series[0].data[chartList[e].option.series[0].data.length-1]=a,chartList[e].option.series[0].markLine.data[0].yAxis=o,chartList[e].option.series[0].markLine.precision=o>10?2:5;let r=chartList[e].option.series[1].data[chartList[e].option.series[1].data.length-1];r=t.PRICE,chartList[e].option.series[1].data[chartList[e].option.series[1].data.length-1]=r,setTimeout((function(){chartList[e].graph.setOption(chartList[e].option)}),10),($("#"+e).hasClass("dash-pan-cry-selected")||0==$(".dash-pan-cry-selected").length&&0==$(".dash-pan-cry").index($("#"+e)))&&appendPageTitle(t.FROMSYMBOL+"/"+t.TOSYMBOL+": "+t.PRICE+" "+(parseFloat(t.CHANGE24HOURPCT)<0?"▼":"▲")+" "+t.CHANGE24HOURPCT+"%")}}),2),$.each(listNotificationChart[e],(function(a,o){loadChartNotification(e,t,o.value,o.type,o.id)})),$.each(listInternalOrderChart[e],(function(a,o){o.me?loadChartOrder(e,t,o.amount,o.date,o.type):addInternalChartOrder(e,t,o.name,o.picture,o.date,o.type,o.order_id)})),$.each(listOrderChart[e],(function(a,o){loadChartOrder(e,t,o.amount,o.time,o.type)}))}initTrading(e)}),e)}))}}))}function _reloadContainerColor(){for(let t in chartList)_defineContainerColor(t,!0)}function _defineContainerColor(t,a=!1){let e={light:{backgroundColor:"#f1f5f8",border_color:"#f1f5f8",tooltip:{text_color:"#1f1f1f",backgroundColor:"rgba(255, 255, 255, 0.8)",axis_point_color:"#d7dce0"},axisLabel:{label_color:"#abafb3",color:"#d7dce0",axis_pointer:"#d7dce0",label:"#f7f8f9",label_background:"#4f576d",split_line:"#d7dce0",pointer_color:"#f7f8f9"},current_price_color:"#fe4f00"},dark:{backgroundColor:"#1d2435",border_color:"#1d2435",tooltip:{text_color:"#fff",backgroundColor:"rgba(20, 27, 41, 0.8)",axis_point_color:"#fff"},axisLabel:{label_color:"#a1a1a1",color:"#a1a1a1",axis_pointer:"#4a505f",label:"#fff",split_line:"#303745",pointer_color:"#f7f8f9"},current_price_color:"#fff"}},o="dark";"light"==$("body").attr("theme")&&(o="light"),chartList[t].option.backgroundColor=e[o].backgroundColor,chartList[t].option.tooltip.backgroundColor=e[o].tooltip.backgroundColor,chartList[t].option.tooltip.textStyle.color=e[o].tooltip.text_color,chartList[t].option.tooltip.axisPointer.lineStyle.color=e[o].tooltip.axis_point_color,$.each(chartList[t].option.xAxis,(function(a,r){chartList[t].option.xAxis[a].axisLabel.textStyle.color=e[o].axisLabel.label_color,chartList[t].option.xAxis[a].axisPointer.lineStyle.color=e[o].axisLabel.color,chartList[t].option.xAxis[a].axisPointer.label.backgroundColor=e[o].axisLabel.label_background,chartList[t].option.xAxis[a].axisPointer.label.color=e[o].axisLabel.label,chartList[t].option.xAxis[a].splitLine.lineStyle.color=e[o].axisLabel.split_line})),$.each(chartList[t].option.yAxis,(function(a,r){chartList[t].option.yAxis[a].axisPointer.show&&(chartList[t].option.yAxis[a].axisLabel.textStyle.color=e[o].axisLabel.label_color,chartList[t].option.yAxis[a].axisPointer.lineStyle.color=e[o].axisLabel.color,chartList[t].option.yAxis[a].axisPointer.label.backgroundColor=e[o].axisLabel.label_background,chartList[t].option.yAxis[a].axisPointer.label.color=e[o].axisLabel.label),chartList[t].option.yAxis[a].splitLine.show&&(chartList[t].option.yAxis[a].splitLine.lineStyle.color=e[o].axisLabel.split_line)})),$.each(chartList[t].option.grid,(function(a,r){chartList[t].option.grid[a].borderColor=e[o].border_color})),chartList[t].option.series[0].markLine.data[0].lineStyle.color=e[o].current_price_color,chartList[t].option.series[0].markLine.precision=e[o].current_price_color>10?2:5,a&&chartList[t].graph.setOption(chartList[t].option)}function loadChartData(t,a,e,o=null,r){$.get($("body").attr("hrefapp")+"/app/modules/dashboard/src/actions/loadChart.php",{coin:t,currency:a,market:e,type:"load"}).done((function(a){let e=jQuery.parseJSON(a);0==e.error?(listNotificationChart[r]=[],listOrderChart[r]=[],listInternalOrderChart[r]=[],$.each(e.notification_list,(function(a,e){listNotificationChart[r].push({symb:t,value:e.value,type:e.type,id:e.id})})),$.each(e.order_list,(function(t,a){listOrderChart[r].push({time:a.time_order,type:a.type_order,amount:a.amount_order})})),$.each(e.internal_order,(function(t,a){listInternalOrderChart[r].push({name:a.name,picture:a.picture,type:a.type,date:a.date,order_id:a.order_id,me:a.me,amount:a.amount})})),null!=o&&o(e)):showAlert("Oops",e.msg,"error")})).fail((function(){showAlert("Ooops","Fail to load chart data","error")}))}let syncContainer={};function syncChart(t){if(0==$("#"+t).length)return!1;let a=$("#"+t).attr("symbol");syncContainer.hasOwnProperty(t)&&(clearTimeout(syncContainer[t]),syncContainer[t]=null),$.get($("body").attr("hrefapp")+"/app/modules/dashboard/src/actions/loadChart.php",{coin:a,type:"update",market:$("#"+t).attr("market"),currency:$("#"+t).attr("currency")}).done((function(a){let e=jQuery.parseJSON(a);if(0==e.error){let a=[];$.each(e.candles,(function(t,e){a.push(e.close)})),-1===jQuery.inArray(e.candles[e.candles.length-1].date,chartList[t].option.xAxis[0].data)&&(chartList[t].option.series[0].data=chartList[t].option.series[0].data.slice(0,-4),chartList[t].option.series[1].data=chartList[t].option.series[1].data.slice(0,-4),chartList[t].option.xAxis[0].data=chartList[t].option.xAxis[0].data.slice(0,-4),chartList[t].data_candles=chartList[t].data_candles.slice(0,-4),chartList[t].data_candles=$.merge(chartList[t].data_candles,e.candles),chartList[t].data=chartList[t].data.slice(0,-4),chartList[t].data=$.merge(chartList[t].data,a),$.each(e.candles,(function(a,o){chartList[t].option.xAxis[0].data.push(o.date),chartList[t].option.series[0].data.push([o.open,o.close,o.low,o.high]),a==e.candles.length-1?chartList[t].option.series[1].data.push(o.open):chartList[t].option.series[1].data.push(o.close)})),chartList[t].option.series[0].markLine.data[0].yAxis=e.current_price,chartList[t].option.series[0].markLine.precision=e.current_price>10?2:5,updateGraphIndicator(t),chartList[t].graph.setOption(chartList[t].option),reloadContainerGraphic(t))}syncContainer[t]=setTimeout((function(){"not_init"!=$("#"+t).attr("symbol")&&syncChart(t)}),3e3)})).fail((function(){showAlert("Ooops","Fail to load chart content","error")}))}
