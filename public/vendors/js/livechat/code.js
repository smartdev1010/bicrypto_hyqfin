var messenger,typingTimeout,messengerColor,dark_mode,typingNow=0,temporaryMsgId=0,defaultAvatarInSettings=null,messages_page=1;const messagesContainer=$(".messenger-messagingView .m-body"),messengerTitleDefault=$(".messenger-headTitle").text(),messageInput=$("#message-form .m-send"),auth_id=$("meta[name=url]").attr("data-user"),url=$("meta[name=url]").attr("content"),defaultMessengerColor=$("meta[name=messenger-color]").attr("content"),access_token=$('meta[name="csrf-token"]').attr("content"),getMessengerId=()=>$("meta[name=id]").attr("content"),getMessengerType=()=>$("meta[name=type]").attr("content"),setMessengerId=e=>$("meta[name=id]").attr("content",e),setMessengerType=e=>$("meta[name=type]").attr("content",e),escapeHtml=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");function actionOnScroll(e,t,a=!1){$(e).on("scroll",(function(){let e=$(this).get(0);(a?0==e.scrollTop:e.scrollTop+e.clientHeight>=e.scrollHeight)&&t()}))}function routerPush(e,t){return $("meta[name=url]").attr("content",t),window.history.pushState({},e||document.title,t)}function updateSelectedContact(e){$(document).find(".messenger-list-item").removeClass("m-list-active"),$(document).find(".messenger-list-item[data-contact="+(e||getMessengerId())+"]").addClass("m-list-active")}function loadingSVG(e="25px",t="",a=""){return`\n<svg style="${a}" class="loadingSVG ${t}" xmlns="http://www.w3.org/2000/svg" width="${e}" height="${e}" viewBox="0 0 40 40" stroke="#ffffff">\n<g fill="none" fill-rule="evenodd">\n<g transform="translate(2 2)" stroke-width="3">\n<circle stroke-opacity=".1" cx="18" cy="18" r="18"></circle>\n<path d="M36 18c0-9.94-8.06-18-18-18" transform="rotate(349.311 18 18)">\n <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur=".8s" repeatCount="indefinite"></animateTransform>\n</path>\n</g>\n</g>\n</svg>\n`}function loadingWithContainer(e){return`<div class="${e}" style="text-align:center;padding:15px">${loadingSVG("25px","","margin:auto")}</div>`}function listItemLoading(e){let t="";for(let a=0;a<e;a++)t+='\n<div class="loadingPlaceholder">\n<div class="loadingPlaceholder-wrapper">\n<div class="loadingPlaceholder-body">\n<table class="loadingPlaceholder-header">\n <tr>\n   <td style="width: 45px;"><div class="loadingPlaceholder-avatar"></div></td>\n   <td>\n     <div class="loadingPlaceholder-name"></div>\n         <div class="loadingPlaceholder-date"></div>\n   </td>\n </tr>\n</table>\n</div>\n</div>\n</div>\n';return t}function avatarLoading(e){let t="";for(let a=0;a<e;a++)t+='\n<div class="loadingPlaceholder">\n<div class="loadingPlaceholder-wrapper">\n<div class="loadingPlaceholder-body">\n   <table class="loadingPlaceholder-header">\n       <tr>\n           <td style="width: 45px;">\n               <div class="loadingPlaceholder-avatar" style="margin: 2px;"></div>\n           </td>\n       </tr>\n   </table>\n</div>\n</div>\n</div>\n';return t}function sendTempMessageCard(e,t){return console.log("message",e),`\n <div class="message-card mc-sender" data-id="${t}">\n     <p>\n         ${e}\n         <sub>\n             <span class="far fa-clock"></span>\n         </sub>\n     </p>\n </div>\n `}function attachmentTemplate(e,t,a=null){return"image"!=e?'\n<div class="attachment-preview">\n<span class="fas fa-times cancel"></span>\n<p style="padding:0px 30px;"><span class="fas fa-file"></span> '+escapeHtml(t)+"</p>\n</div>\n":'\n<div class="attachment-preview">\n<span class="fas fa-times cancel"></span>\n<div class="image-file chat-image" style="background-image: url(\''+a+'\');"></div>\n<p><span class="fas fa-file-image"></span> '+escapeHtml(t)+"</p>\n</div>\n"}function activeStatusCircle(){return'<span class="activeStatus"></span>'}function cssMediaQueries(){window.matchMedia("(min-width: 980px)").matches&&$(".messenger-listView").removeAttr("style"),window.matchMedia("(max-width: 980px)").matches?($("body").find(".messenger-list-item").find("tr[data-action]").attr("data-action","1"),$("body").find(".favorite-list-item").find("div").attr("data-action","1")):($("body").find(".messenger-list-item").find("tr[data-action]").attr("data-action","0"),$("body").find(".favorite-list-item").find("div").attr("data-action","0"))}$(window).resize((function(){cssMediaQueries()}));let app_modal=function({show:e=!0,name:t,data:a=0,buttons:s=!0,header:n=null,body:o=null}){const r=$(".app-modal[data-name="+t+"]");n&&r.find(".app-modal-header").html(n),o&&r.find(".app-modal-body").html(o),1==s?r.find(".app-modal-footer").show():r.find(".app-modal-footer").hide(),1==e?(r.show(),$(".app-modal-card[data-name="+t+"]").addClass("app-show-modal"),$(".app-modal-card[data-name="+t+"]").attr("data-modal",a)):(r.hide(),$(".app-modal-card[data-name="+t+"]").removeClass("app-show-modal"),$(".app-modal-card[data-name="+t+"]").attr("data-modal",a))};function scrollToBottom(e){$(e).stop().animate({scrollTop:$(e)[0].scrollHeight})}function hScroller(e){const t=document.querySelector(e);let a,s,n=!1;t.addEventListener("mousedown",(e=>{n=!0,a=e.pageX-t.offsetLeft,s=t.scrollLeft})),t.addEventListener("mouseleave",(()=>{n=!1})),t.addEventListener("mouseup",(()=>{n=!1})),t.addEventListener("mousemove",(e=>{if(!n)return;e.preventDefault();const o=1*(e.pageX-t.offsetLeft-a);t.scrollLeft=s-o}))}function disableOnLoad(e=!0){1==e?($(".add-to-favorite").hide(),$(".messenger-sendCard").hide(),messagesContainer.css("opacity",".5"),messageInput.attr("readonly","readonly"),$("#message-form button").attr("disabled","disabled"),$(".upload-attachment").attr("disabled","disabled")):(getMessengerId()!=auth_id&&$(".add-to-favorite").show(),$(".messenger-sendCard").show(),messagesContainer.css("opacity","1"),messageInput.removeAttr("readonly"),$("#message-form button").removeAttr("disabled"),$(".upload-attachment").removeAttr("disabled"))}function errorMessageCard(e){messagesContainer.find(".message-card[data-id="+e+"]").addClass("mc-error"),messagesContainer.find(".message-card[data-id="+e+"]").find("svg.loadingSVG").remove(),messagesContainer.find(".message-card[data-id="+e+"] p").prepend('<span class="fas fa-exclamation-triangle"></span>')}function IDinfo(e,t){temporaryMsgId=0,typingNow=0,NProgress.start(),disableOnLoad(),0!=messenger?(getSharedPhotos(e),$.ajax({url:url+"/idInfo",method:"POST",data:{_token:access_token,id:e,type:t},dataType:"JSON",success:a=>{$(".messenger-infoView").find(".avatar").css("background-image",'url("'+a.user_avatar+'")'),$(".header-avatar").css("background-image",'url("'+a.user_avatar+'")'),$(".messenger-infoView-btns .delete-conversation").show(),$(".messenger-infoView-shared").show(),fetchMessages(e,t,!0),messageInput.focus(),$(".messenger-infoView .info-name").html(a.fetch.name),$(".m-header-messaging .user-name").html(a.fetch.name),a.favorite>0?$(".add-to-favorite").addClass("favorite"):$(".add-to-favorite").removeClass("favorite"),$("#message-form").trigger("reset"),cancelAttachment(),messageInput.focus()},error:()=>{console.error("Error, check server response!"),NProgress.done(),NProgress.remove()}})):(NProgress.done(),NProgress.remove())}function sendMessage(){let e=`temp_${temporaryMsgId+=1}`,t=!!$(".upload-attachment").val();const a=$.trim(messageInput.val());if(a.length>0||t){const s=new FormData($("#message-form")[0]);s.append("id",getMessengerId()),s.append("type",getMessengerType()),s.append("temporaryMsgId",e),s.append("_token",access_token),$.ajax({url:$("#message-form").attr("action"),method:"POST",data:s,dataType:"JSON",processData:!1,contentType:!1,beforeSend:()=>{$(".messages").find(".message-hint").remove(),t?messagesContainer.find(".messages").append(sendTempMessageCard(a+"\n"+loadingSVG("28px"),e)):messagesContainer.find(".messages").append(sendTempMessageCard(a,e)),scrollToBottom(messagesContainer),messageInput.css({height:"42px"}),$("#message-form").trigger("reset"),cancelAttachment(),messageInput.focus()},success:t=>{if(t.error>0)errorMessageCard(e),console.error(t.error_msg);else{updateContactItem(getMessengerId());const e=messagesContainer.find(`.message-card[data-id=${t.tempID}]`);e.before(t.message),e.remove(),scrollToBottom(messagesContainer),sendContactItemUpdates(!0)}},error:()=>{errorMessageCard(e),console.error("Failed sending the message! Please, check your server response.")}})}return!1}let messagesPage=1,noMoreMessages=!1,messagesLoading=!1;function setMessagesLoading(e=!1){e?messagesContainer.find(".messages").prepend(loadingWithContainer("loading-messages")):(messagesContainer.find(".messages").find(".loading-messages").remove(),NProgress.done(),NProgress.remove()),messagesLoading=e}function fetchMessages(e,t,a=!1){if(a&&(messagesPage=1,noMoreMessages=!1),0!=messenger&&!noMoreMessages&&!messagesLoading){const a=messagesContainer.find(".messages");setMessagesLoading(!0),$.ajax({url:url+"/fetchMessages",method:"POST",data:{_token:access_token,id:e,type:t,page:messagesPage},dataType:"JSON",success:e=>{if(setMessagesLoading(!1),1==messagesPage)a.html(e.messages),scrollToBottom(messagesContainer);else{const t=a.find(a.find(".message-card")[0]),s=t.offset().top-messagesContainer.scrollTop();a.prepend(e.messages),messagesContainer.scrollTop(t.offset().top-s)}makeSeen(!0),noMoreMessages=messagesPage>=e?.last_page,noMoreMessages||(messagesPage+=1),0!=messenger&&disableOnLoad(!1)},error:e=>{setMessagesLoading(!1),console.error(e)}})}}function cancelAttachment(){$(".messenger-sendCard").find(".attachment-preview").remove(),$(".upload-attachment").replaceWith($(".upload-attachment").val("").clone(!0))}function cancelUpdatingAvatar(){$(".upload-avatar-preview").css("background-image",defaultAvatarInSettings),$(".upload-avatar").replaceWith($(".upload-avatar").val("").clone(!0))}var channel=pusher.subscribe("private-livechat");channel.bind("messaging",(function(e){e.from_id==getMessengerId()&&e.to_id==auth_id&&($(".messages").find(".message-hint").remove(),messagesContainer.find(".messages").append(e.message),scrollToBottom(messagesContainer),makeSeen(!0),$(".messenger-list-item[data-contact="+getMessengerId()+"]").find("tr>td>b").remove())})),channel.bind("client-typing",(function(e){e.from_id==getMessengerId()&&e.to_id==auth_id&&(1==e.typing?messagesContainer.find(".typing-indicator").show():messagesContainer.find(".typing-indicator").hide()),scrollToBottom(messagesContainer)})),channel.bind("client-seen",(function(e){e.from_id==getMessengerId()&&e.to_id==auth_id&&(1==e.seen?($(".message-time").find(".fa-check").before('<span class="fas fa-check-double seen"></span> '),$(".message-time").find(".fa-check").remove(),console.info("[seen] triggered!")):console.error("[seen] event not triggered!"))})),channel.bind("client-contactItem",(function(e){e.update_for==auth_id&&(1==e.updating?updateContactItem(e.update_to):console.error("[Contact Item updates] Updating failed!"))})),channel.bind("client-messageDelete",(function(e){$("body").find(`.message-card[data-id=${e.id}]`).remove()}));var activeStatusChannel=pusher.subscribe("presence-activeStatus");function isTyping(e){return channel.trigger("client-typing",{from_id:auth_id,to_id:getMessengerId(),typing:e})}function handleVisibilityChange(){document?.hidden||makeSeen(!0)}function makeSeen(e){if(!document?.hidden)return $(".messenger-list-item[data-contact="+getMessengerId()+"]").find("tr>td>b").remove(),$.ajax({url:url+"/makeSeen",method:"POST",data:{_token:access_token,id:getMessengerId()},dataType:"JSON"}),channel.trigger("client-seen",{from_id:auth_id,to_id:getMessengerId(),seen:e})}function sendContactItemUpdates(e){return channel.trigger("client-contactItem",{update_for:getMessengerId(),update_to:auth_id,updating:e})}function sendMessageDeleteEvent(e){return channel.trigger("client-messageDelete",{id:e})}function checkInternet(e,t){let a=0;const s=$(".messenger-headTitle");switch(e){case"connected":a<1&&(s.text(messengerTitleDefault),t.addClass("successBG-rgba"),t.find("span").hide(),t.slideDown("fast",(function(){t.find(".ic-connected").show()})),setTimeout((function(){$(".internet-connection").slideUp("fast")}),3e3));break;case"connecting":s.text($(".ic-connecting").text()),t.removeClass("successBG-rgba"),t.find("span").hide(),t.slideDown("fast",(function(){t.find(".ic-connecting").show()})),a=1;break;default:s.text($(".ic-noInternet").text()),t.removeClass("successBG-rgba"),t.find("span").hide(),t.slideDown("fast",(function(){t.find(".ic-noInternet").show()})),a=1}}activeStatusChannel.bind("pusher:member_added",(function(e){setActiveStatus(1,e.id),$(".messenger-list-item[data-contact="+e.id+"]").find(".activeStatus").remove(),$(".messenger-list-item[data-contact="+e.id+"]").find(".avatar").before(activeStatusCircle())})),activeStatusChannel.bind("pusher:member_removed",(function(e){setActiveStatus(0,e.id),$(".messenger-list-item[data-contact="+e.id+"]").find(".activeStatus").remove()})),document.addEventListener("visibilitychange",handleVisibilityChange,!1);let contactsPage=1,contactsLoading=!1,noMoreContacts=!1;function setContactsLoading(e=!1){e?$(".listOfContacts").append(`<div class="loading-contacts">${listItemLoading(4)}</div>`):$(".listOfContacts").find(".loading-contacts").remove(),contactsLoading=e}function getContacts(){contactsLoading||noMoreContacts||(setContactsLoading(!0),$.ajax({url:url+"/getContacts",method:"GET",data:{_token:access_token,page:contactsPage},dataType:"JSON",success:e=>{setContactsLoading(!1),contactsPage<2?$(".listOfContacts").html(e.contacts):$(".listOfContacts").append(e.contacts),updateSelectedContact(),cssMediaQueries(),noMoreContacts=contactsPage>=e?.last_page,noMoreContacts||(contactsPage+=1)},error:e=>{setContactsLoading(!1),console.error(e)}}))}function updateContactItem(e){if(e!=auth_id){let t=$("body").find(".listOfContacts").find(".messenger-list-item[data-contact="+e+"]");$.ajax({url:url+"/updateContacts",method:"POST",data:{_token:access_token,user_id:e},dataType:"JSON",success:a=>{($(".listOfContacts").find(".messenger-list-item")?.length||0)<1&&$(".listOfContacts").find(".message-hint").remove(),t.remove(),$(".listOfContacts").prepend(a.contactItem),cssMediaQueries(),updateSelectedContact(e)},error:()=>{console.error("Server error, check your response")}})}}function star(e){getMessengerId()!=auth_id&&$.ajax({url:url+"/star",method:"POST",data:{_token:access_token,user_id:e},dataType:"JSON",success:e=>{e.status>0?$(".add-to-favorite").addClass("favorite"):$(".add-to-favorite").removeClass("favorite")},error:()=>{console.error("Server error, check your response")}})}function getFavoritesList(){$(".messenger-favorites").html(avatarLoading(4)),$.ajax({url:url+"/favorites",method:"POST",data:{_token:access_token},dataType:"JSON",success:e=>{e.count>0?($(".favorites-section").show(),$(".messenger-favorites").html(e.favorites)):$(".favorites-section").hide(),cssMediaQueries()},error:()=>{console.error("Server error, check your response")}})}function getSharedPhotos(e){$.ajax({url:url+"/shared",method:"POST",data:{_token:access_token,user_id:e},dataType:"JSON",success:e=>{$(".shared-photos-list").html(e.shared)},error:()=>{console.error("Server error, check your response")}})}let searchPage=1,noMoreDataSearch=!1,searchLoading=!1,searchTempVal="";function setSearchLoading(e=!1){e?$(".search-records").append(`<div class="loading-search">${listItemLoading(4)}</div>`):$(".search-records").find(".loading-search").remove(),searchLoading=e}function messengerSearch(e){e!=searchTempVal&&(searchPage=1,noMoreDataSearch=!1,searchLoading=!1),searchTempVal=e,searchLoading||noMoreDataSearch||(searchPage<2&&$(".search-records").html(""),setSearchLoading(!0),$.ajax({url:url+"/search",method:"GET",data:{_token:access_token,input:e,page:searchPage},dataType:"JSON",success:e=>{setSearchLoading(!1),searchPage<2?$(".search-records").html(e.records):$(".search-records").append(e.records),cssMediaQueries(),noMoreDataSearch=searchPage>=e?.last_page,noMoreDataSearch||(searchPage+=1)},error:e=>{setSearchLoading(!1),console.error(e)}}))}function deleteConversation(e){$.ajax({url:url+"/deleteConversation",method:"POST",data:{_token:access_token,id:e},dataType:"JSON",beforeSend:()=>{app_modal({show:!1,name:"delete"}),app_modal({show:!0,name:"alert",buttons:!1,body:loadingSVG("32px",null,"margin:auto")})},success:t=>{$(".listOfContacts").find(".messenger-list-item[data-contact="+e+"]").remove(),IDinfo(e,getMessengerType()),t.deleted||console.error("Error occurred, messages can not be deleted!"),app_modal({show:!1,name:"alert",buttons:!0,body:""})},error:()=>{console.error("Server error, check your response")}})}function deleteMessage(e){$.ajax({url:url+"/deleteMessage",method:"POST",data:{_token:access_token,id:e},dataType:"JSON",beforeSend:()=>{app_modal({show:!1,name:"delete"}),app_modal({show:!0,name:"alert",buttons:!1,body:loadingSVG("32px",null,"margin:auto")})},success:t=>{$(".messages").find(`.message-card[data-id=${e}]`).remove(),t.deleted||console.error("Error occurred, message can not be deleted!"),sendMessageDeleteEvent(e),app_modal({show:!1,name:"alert",buttons:!0,body:""})},error:()=>{console.error("Server error, check your response")}})}function updateSettings(){const e=new FormData($("#update-settings")[0]);messengerColor&&e.append("messengerColor",messengerColor),dark_mode&&e.append("dark_mode",dark_mode),$.ajax({url:url+"/updateSettings",method:"POST",data:e,dataType:"JSON",processData:!1,contentType:!1,beforeSend:()=>{app_modal({show:!1,name:"settings"}),app_modal({show:!0,name:"alert",buttons:!1,body:loadingSVG("32px",null,"margin:auto")})},success:e=>{e.error?app_modal({show:!0,name:"alert",buttons:!0,body:e.msg}):(app_modal({show:!1,name:"alert",buttons:!0,body:""}),location.reload(!0))},error:()=>{console.error("Server error, check your response")}})}function setActiveStatus(e,t){$.ajax({url:url+"/setActiveStatus",method:"POST",data:{_token:access_token,user_id:t,status:e},dataType:"JSON",success:e=>{},error:()=>{console.error("Server error, check your response")}})}$(document).ready((function(){function e(e){const t=$(".upload-attachment"),{name:a,size:s}=e,n=a.split(".").pop();return getAllowedExtensions.includes(n.toString().toLowerCase())?!(s>getMaxUploadSize)||(alert("File is too large!"),!1):(alert("file type not allowed"),t.val(""),!1)}getContacts(),getFavoritesList(),clearTimeout(typingTimeout),NProgress.configure({showSpinner:!1,minimum:.7,speed:500}),autosize($(".m-send")),pusher.connection.bind("state_change",(function(e){let t=$(".internet-connection");checkInternet(e.current,t),channel.bind("pusher:subscription_succeeded",(function(){0!=getMessengerId()&&("1"==$(".messenger-list-item").find("tr[data-action]").attr("data-action")&&$(".messenger-listView").hide(),IDinfo(getMessengerId(),getMessengerType()))}))})),$(".messenger-listView-tabs a").on("click",(function(){var e=$(this).attr("data-view");$(".messenger-listView-tabs a").removeClass("active-tab"),$(this).addClass("active-tab"),$(".messenger-tab").hide(),$(".messenger-tab[data-view="+e+"]").show()})),$("body").on("click",".messenger-list-item",(function(){const e=$(".messenger-list-item").find("p[data-type]").attr("data-type");$(".messenger-tab").hide(),$(".messenger-tab[data-view="+e+"s]").show(),$(".messenger-list-item").removeClass("m-list-active"),$(this).addClass("m-list-active");const t=$(this).attr("data-contact");routerPush(document.title,`${url}/${t}`),updateSelectedContact(t)})),$(".messenger-infoView nav a , .show-infoSide").on("click",(function(){$(".messenger-infoView").toggle()})),hScroller(".messenger-favorites"),$("body").on("click",".messenger-list-item",(function(){"1"==$(this).find("tr[data-action]").attr("data-action")&&$(".messenger-listView").hide();const e=$(this).find("p[data-id]").attr("data-id"),t=$(this).find("p[data-type]").attr("data-type");setMessengerId(e),setMessengerType(t),IDinfo(e,t)})),$("body").on("click",".favorite-list-item",(function(){"1"==$(this).find("div").attr("data-action")&&$(".messenger-listView").hide();const e=$(this).find("div.avatar").attr("data-id");setMessengerId(e),setMessengerType("user"),IDinfo(e,"user"),updateSelectedContact(e),routerPush(document.title,`${url}/${e}`)})),$(".listView-x").on("click",(function(){$(".messenger-listView").hide()})),$(".show-listView").on("click",(function(){$(".messenger-listView").show()})),$(".add-to-favorite").on("click",(function(){star(getMessengerId())})),cssMediaQueries(),$("#message-form").on("submit",(e=>{e.preventDefault(),sendMessage()})),$("#message-form .m-send").on("keyup",(e=>{13!=e.which&&13!=e.keyCode||e.shiftKey||(triggered=isTyping(!1),sendMessage())})),$("body").on("change",".upload-attachment",(t=>{let a=t.target.files[0];if(!e(a))return!1;let s=new FileReader,n=$(".messenger-sendCard");s.readAsDataURL(a),s.addEventListener("loadstart",(e=>{$("#message-form").before(loadingSVG())})),s.addEventListener("load",(e=>{$(".messenger-sendCard").find(".loadingSVG").remove(),a.type.match("image.*")?(n.find(".attachment-preview").remove(),n.prepend(attachmentTemplate("image",a.name,e.target.result))):(n.find(".attachment-preview").remove(),n.prepend(attachmentTemplate("file",a.name)))}))})),$("body").on("click",".attachment-preview .cancel",(()=>{cancelAttachment()})),$("#message-form .m-send").on("keydown",(()=>{if(typingNow<1){isTyping(!0)?console.info("[+] Triggered"):console.error("[+] Not triggered"),typingNow=1}clearTimeout(typingTimeout),typingTimeout=setTimeout((function(){triggered=isTyping(!1),triggered?console.info("[-] Triggered"):console.error("[-] Not triggered"),typingNow=0}),1e3)})),$("body").on("click",".chat-image",(function(){let e=$(this).css("background-image").split(/"/)[1];$("#imageModalBox").show(),$("#imageModalBoxSrc").attr("src",e)})),$(".imageModal-close").on("click",(function(){$("#imageModalBox").hide()})),$(".messenger-search").on("focus",(function(){$(".messenger-tab").hide(),$('.messenger-tab[data-view="search"]').show()})),$(".messenger-search").on("blur",(function(){setTimeout((function(){$(".messenger-tab").hide(),$('.messenger-tab[data-view="users"]').show()}),200)})),$(".messenger-search").on("keyup",(function(e){$.trim($(this).val()).length>0?($(".messenger-search").trigger("focus"),messengerSearch($(this).val())):($(".messenger-tab").hide(),$('.messenger-listView-tabs a[data-view="users"]').trigger("click"))})),$(".messenger-infoView-btns .delete-conversation").on("click",(function(){app_modal({name:"delete"})})),$("body").on("click",".livechat-hover-delete-btn",(function(){app_modal({name:"delete",data:$(this).data("id")})})),$(".app-modal[data-name=delete]").find(".app-modal-footer .delete").on("click",(function(){const e=$("body").find(".app-modal[data-name=delete]").find(".app-modal-card").attr("data-modal");0==e?deleteConversation(getMessengerId()):deleteMessage(e),app_modal({show:!1,name:"delete"})})),$(".app-modal[data-name=delete]").find(".app-modal-footer .cancel").on("click",(function(){app_modal({show:!1,name:"delete"})})),$("body").on("click",".settings-btn",(function(e){e.preventDefault(),app_modal({show:!0,name:"settings"})})),$("#update-settings").on("submit",(e=>{e.preventDefault(),updateSettings()})),$(".app-modal[data-name=settings]").find(".app-modal-footer .cancel").on("click",(function(){app_modal({show:!1,name:"settings"}),cancelUpdatingAvatar()})),$("body").on("change",".upload-avatar",(t=>{null==defaultAvatarInSettings&&(defaultAvatarInSettings=$(".upload-avatar-preview").css("background-image"));let a=t.target.files[0];if(!e(a))return!1;let s=new FileReader;s.readAsDataURL(a),s.addEventListener("loadstart",(e=>{$(".upload-avatar-preview").append(loadingSVG("42px","upload-avatar-loading"))})),s.addEventListener("load",(e=>{$(".upload-avatar-preview").find(".loadingSVG").remove(),a.type.match("image.*")?$(".upload-avatar-preview").css("background-image",'url("'+e.target.result+'")'):console.error("File you selected is not an image!")}))})),$("body").on("click",".update-messengerColor .color-btn",(function(){messengerColor=$(this).attr("data-color"),$(".update-messengerColor .color-btn").removeClass("m-color-active"),$(this).addClass("m-color-active")})),$("body").on("click",".dark-mode-switch",(function(){"0"==$(this).attr("data-mode")?($(this).attr("data-mode","1"),$(this).removeClass("far"),$(this).addClass("fas"),dark_mode="dark"):($(this).attr("data-mode","0"),$(this).removeClass("fas"),$(this).addClass("far"),dark_mode="light")})),actionOnScroll(".m-body.messages-container",(function(){fetchMessages(getMessengerId(),getMessengerType())}),!0),actionOnScroll(".messenger-tab.users-tab",(function(){getContacts()})),actionOnScroll(".messenger-tab.search-tab",(function(){messengerSearch($(".messenger-search").val())}))}));
