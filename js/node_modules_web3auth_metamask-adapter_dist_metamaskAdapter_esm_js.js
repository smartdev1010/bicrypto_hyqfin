"use strict";
(self["webpackChunk"] = self["webpackChunk"] || []).push([["node_modules_web3auth_metamask-adapter_dist_metamaskAdapter_esm_js"],{

/***/ "./node_modules/@web3auth/metamask-adapter/dist/metamaskAdapter.esm.js":
/*!*****************************************************************************!*\
  !*** ./node_modules/@web3auth/metamask-adapter/dist/metamaskAdapter.esm.js ***!
  \*****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "MetamaskAdapter": () => (/* binding */ MetamaskAdapter)
/* harmony export */ });
/* harmony import */ var _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/helpers/defineProperty */ "./node_modules/@babel/runtime/helpers/esm/defineProperty.js");
/* harmony import */ var _metamask_detect_provider__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @metamask/detect-provider */ "./node_modules/@metamask/detect-provider/dist/index.js");
/* harmony import */ var _metamask_detect_provider__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_metamask_detect_provider__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _web3auth_base__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @web3auth/base */ "./node_modules/@web3auth/base/dist/base.esm.js");




class MetamaskAdapter extends _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.BaseAdapter {
  constructor() {
    let adapterOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    super();

    (0,_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__["default"])(this, "adapterNamespace", _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.ADAPTER_NAMESPACES.EIP155);

    (0,_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__["default"])(this, "currentChainNamespace", _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.CHAIN_NAMESPACES.EIP155);

    (0,_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__["default"])(this, "type", _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.ADAPTER_CATEGORY.EXTERNAL);

    (0,_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__["default"])(this, "name", _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.WALLET_ADAPTERS.METAMASK);

    (0,_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__["default"])(this, "status", _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.ADAPTER_STATUS.NOT_READY);

    (0,_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__["default"])(this, "rehydrated", false);

    (0,_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__["default"])(this, "metamaskProvider", null);

    this.chainConfig = adapterOptions.chainConfig || null;
  }

  get provider() {
    if (this.status === _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.ADAPTER_STATUS.CONNECTED && this.metamaskProvider) {
      return this.metamaskProvider;
    }

    return null;
  }

  set provider(_) {
    throw new Error("Not implemented");
  }

  async init(options) {
    super.checkInitializationRequirements();
    this.metamaskProvider = await _metamask_detect_provider__WEBPACK_IMPORTED_MODULE_1___default()({
      mustBeMetaMask: true
    });
    if (!this.metamaskProvider) throw _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.WalletInitializationError.notInstalled("Metamask extension is not installed");
    this.status = _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.ADAPTER_STATUS.READY;
    this.emit(_web3auth_base__WEBPACK_IMPORTED_MODULE_2__.ADAPTER_EVENTS.READY, _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.WALLET_ADAPTERS.METAMASK);

    try {
      _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.log.debug("initializing metamask adapter");

      if (options.autoConnect) {
        this.rehydrated = true;
        await this.connect();
      }
    } catch (error) {
      this.emit(_web3auth_base__WEBPACK_IMPORTED_MODULE_2__.ADAPTER_EVENTS.ERRORED, error);
    }
  }

  setAdapterSettings(_) {}

  async connect() {
    super.checkConnectionRequirements(); // set default to mainnet

    if (!this.chainConfig) this.chainConfig = (0,_web3auth_base__WEBPACK_IMPORTED_MODULE_2__.getChainConfig)(_web3auth_base__WEBPACK_IMPORTED_MODULE_2__.CHAIN_NAMESPACES.EIP155, 1);
    this.status = _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.ADAPTER_STATUS.CONNECTING;
    this.emit(_web3auth_base__WEBPACK_IMPORTED_MODULE_2__.ADAPTER_EVENTS.CONNECTING, {
      adapter: _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.WALLET_ADAPTERS.METAMASK
    });
    if (!this.metamaskProvider) throw _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.WalletLoginError.notConnectedError("Not able to connect with metamask");

    try {
      await this.metamaskProvider.request({
        method: "eth_requestAccounts"
      });
      const {
        chainId
      } = this.metamaskProvider;

      if (chainId !== this.chainConfig.chainId) {
        await this.switchChain(this.chainConfig);
      }

      this.status = _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.ADAPTER_STATUS.CONNECTED;
      if (!this.provider) throw _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.WalletLoginError.notConnectedError("Failed to connect with provider");
      this.provider.once("disconnect", () => {
        // ready to be connected again
        this.disconnect();
      });
      this.emit(_web3auth_base__WEBPACK_IMPORTED_MODULE_2__.ADAPTER_EVENTS.CONNECTED, {
        adapter: _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.WALLET_ADAPTERS.METAMASK,
        reconnected: this.rehydrated
      });
      return this.provider;
    } catch (error) {
      // ready again to be connected
      this.status = _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.ADAPTER_STATUS.READY;
      this.rehydrated = false;
      this.emit(_web3auth_base__WEBPACK_IMPORTED_MODULE_2__.ADAPTER_EVENTS.ERRORED, error);
      throw _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.WalletLoginError.connectionError("Failed to login with metamask wallet");
    }
  }

  async disconnect() {
    var _this$provider;

    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {
      cleanup: false
    };
    if (this.status !== _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.ADAPTER_STATUS.CONNECTED) throw _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.WalletLoginError.disconnectionError("Not connected with wallet");
    (_this$provider = this.provider) === null || _this$provider === void 0 ? void 0 : _this$provider.removeAllListeners();

    if (options.cleanup) {
      this.status = _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.ADAPTER_STATUS.NOT_READY;
      this.metamaskProvider = null;
    } else {
      // ready to be connected again
      this.status = _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.ADAPTER_STATUS.READY;
    }

    this.rehydrated = false;
    this.emit(_web3auth_base__WEBPACK_IMPORTED_MODULE_2__.ADAPTER_EVENTS.DISCONNECTED);
  }

  async getUserInfo() {
    if (this.status !== _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.ADAPTER_STATUS.CONNECTED) throw _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.WalletLoginError.notConnectedError("Not connected with wallet, Please login/connect first");
    return {};
  }

  async switchChain(chainConfig) {
    if (!this.metamaskProvider) throw _web3auth_base__WEBPACK_IMPORTED_MODULE_2__.WalletLoginError.notConnectedError("Not connected with wallet");

    try {
      await this.metamaskProvider.request({
        method: "wallet_switchEthereumChain",
        params: [{
          chainId: chainConfig.chainId
        }]
      });
    } catch (switchError) {
      // This error code indicates that the chain has not been added to MetaMask.
      if (switchError.code === 4902) {
        await this.metamaskProvider.request({
          method: "wallet_addEthereumChain",
          params: [{
            chainId: chainConfig.chainId,
            chainName: chainConfig.displayName,
            rpcUrls: [chainConfig.rpcTarget]
          }]
        });
      } else {
        throw switchError;
      }
    }
  }

}


//# sourceMappingURL=metamaskAdapter.esm.js.map


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoianMvbm9kZV9tb2R1bGVzX3dlYjNhdXRoX21ldGFtYXNrLWFkYXB0ZXJfZGlzdF9tZXRhbWFza0FkYXB0ZXJfZXNtX2pzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQW9FO0FBQ0w7QUFDeUo7O0FBRXhOLDhCQUE4Qix1REFBVztBQUN6QztBQUNBO0FBQ0E7O0FBRUEsSUFBSSxpRkFBZSwyQkFBMkIscUVBQXlCOztBQUV2RSxJQUFJLGlGQUFlLGdDQUFnQyxtRUFBdUI7O0FBRTFFLElBQUksaUZBQWUsZUFBZSxxRUFBeUI7O0FBRTNELElBQUksaUZBQWUsZUFBZSxvRUFBd0I7O0FBRTFELElBQUksaUZBQWUsaUJBQWlCLG9FQUF3Qjs7QUFFNUQsSUFBSSxpRkFBZTs7QUFFbkIsSUFBSSxpRkFBZTs7QUFFbkI7QUFDQTs7QUFFQTtBQUNBLHdCQUF3QixvRUFBd0I7QUFDaEQ7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esa0NBQWtDLGdFQUFzQjtBQUN4RDtBQUNBLEtBQUs7QUFDTCxzQ0FBc0Msa0ZBQXNDO0FBQzVFLGtCQUFrQixnRUFBb0I7QUFDdEMsY0FBYyxnRUFBb0IsRUFBRSxvRUFBd0I7O0FBRTVEO0FBQ0EsTUFBTSxxREFBUzs7QUFFZjtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixnQkFBZ0Isa0VBQXNCO0FBQ3RDO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSx5Q0FBeUM7O0FBRXpDLDhDQUE4Qyw4REFBYyxDQUFDLG1FQUF1QjtBQUNwRixrQkFBa0IscUVBQXlCO0FBQzNDLGNBQWMscUVBQXlCO0FBQ3ZDLGVBQWUsb0VBQXdCO0FBQ3ZDLEtBQUs7QUFDTCxzQ0FBc0MsOEVBQWtDOztBQUV4RTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLFFBQVE7O0FBRVI7QUFDQTtBQUNBOztBQUVBLG9CQUFvQixvRUFBd0I7QUFDNUMsZ0NBQWdDLDhFQUFrQztBQUNsRTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsZ0JBQWdCLG9FQUF3QjtBQUN4QyxpQkFBaUIsb0VBQXdCO0FBQ3pDO0FBQ0EsT0FBTztBQUNQO0FBQ0EsTUFBTTtBQUNOO0FBQ0Esb0JBQW9CLGdFQUFvQjtBQUN4QztBQUNBLGdCQUFnQixrRUFBc0I7QUFDdEMsWUFBWSw0RUFBZ0M7QUFDNUM7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixvRUFBd0IsUUFBUSwrRUFBbUM7QUFDM0Y7O0FBRUE7QUFDQSxvQkFBb0Isb0VBQXdCO0FBQzVDO0FBQ0EsTUFBTTtBQUNOO0FBQ0Esb0JBQW9CLGdFQUFvQjtBQUN4Qzs7QUFFQTtBQUNBLGNBQWMsdUVBQTJCO0FBQ3pDOztBQUVBO0FBQ0Esd0JBQXdCLG9FQUF3QixRQUFRLDhFQUFrQztBQUMxRjtBQUNBOztBQUVBO0FBQ0Esc0NBQXNDLDhFQUFrQzs7QUFFeEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxPQUFPO0FBQ1AsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1gsU0FBUztBQUNULFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFMkI7QUFDM0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQHdlYjNhdXRoL21ldGFtYXNrLWFkYXB0ZXIvZGlzdC9tZXRhbWFza0FkYXB0ZXIuZXNtLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAnQGJhYmVsL3J1bnRpbWUvaGVscGVycy9kZWZpbmVQcm9wZXJ0eSc7XG5pbXBvcnQgZGV0ZWN0RXRoZXJldW1Qcm92aWRlciBmcm9tICdAbWV0YW1hc2svZGV0ZWN0LXByb3ZpZGVyJztcbmltcG9ydCB7IEJhc2VBZGFwdGVyLCBBREFQVEVSX05BTUVTUEFDRVMsIENIQUlOX05BTUVTUEFDRVMsIEFEQVBURVJfQ0FURUdPUlksIFdBTExFVF9BREFQVEVSUywgQURBUFRFUl9TVEFUVVMsIFdhbGxldEluaXRpYWxpemF0aW9uRXJyb3IsIEFEQVBURVJfRVZFTlRTLCBsb2csIGdldENoYWluQ29uZmlnLCBXYWxsZXRMb2dpbkVycm9yIH0gZnJvbSAnQHdlYjNhdXRoL2Jhc2UnO1xuXG5jbGFzcyBNZXRhbWFza0FkYXB0ZXIgZXh0ZW5kcyBCYXNlQWRhcHRlciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIGxldCBhZGFwdGVyT3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307XG4gICAgc3VwZXIoKTtcblxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImFkYXB0ZXJOYW1lc3BhY2VcIiwgQURBUFRFUl9OQU1FU1BBQ0VTLkVJUDE1NSk7XG5cbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJjdXJyZW50Q2hhaW5OYW1lc3BhY2VcIiwgQ0hBSU5fTkFNRVNQQUNFUy5FSVAxNTUpO1xuXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwidHlwZVwiLCBBREFQVEVSX0NBVEVHT1JZLkVYVEVSTkFMKTtcblxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm5hbWVcIiwgV0FMTEVUX0FEQVBURVJTLk1FVEFNQVNLKTtcblxuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInN0YXR1c1wiLCBBREFQVEVSX1NUQVRVUy5OT1RfUkVBRFkpO1xuXG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwicmVoeWRyYXRlZFwiLCBmYWxzZSk7XG5cbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJtZXRhbWFza1Byb3ZpZGVyXCIsIG51bGwpO1xuXG4gICAgdGhpcy5jaGFpbkNvbmZpZyA9IGFkYXB0ZXJPcHRpb25zLmNoYWluQ29uZmlnIHx8IG51bGw7XG4gIH1cblxuICBnZXQgcHJvdmlkZXIoKSB7XG4gICAgaWYgKHRoaXMuc3RhdHVzID09PSBBREFQVEVSX1NUQVRVUy5DT05ORUNURUQgJiYgdGhpcy5tZXRhbWFza1Byb3ZpZGVyKSB7XG4gICAgICByZXR1cm4gdGhpcy5tZXRhbWFza1Byb3ZpZGVyO1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgc2V0IHByb3ZpZGVyKF8pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJOb3QgaW1wbGVtZW50ZWRcIik7XG4gIH1cblxuICBhc3luYyBpbml0KG9wdGlvbnMpIHtcbiAgICBzdXBlci5jaGVja0luaXRpYWxpemF0aW9uUmVxdWlyZW1lbnRzKCk7XG4gICAgdGhpcy5tZXRhbWFza1Byb3ZpZGVyID0gYXdhaXQgZGV0ZWN0RXRoZXJldW1Qcm92aWRlcih7XG4gICAgICBtdXN0QmVNZXRhTWFzazogdHJ1ZVxuICAgIH0pO1xuICAgIGlmICghdGhpcy5tZXRhbWFza1Byb3ZpZGVyKSB0aHJvdyBXYWxsZXRJbml0aWFsaXphdGlvbkVycm9yLm5vdEluc3RhbGxlZChcIk1ldGFtYXNrIGV4dGVuc2lvbiBpcyBub3QgaW5zdGFsbGVkXCIpO1xuICAgIHRoaXMuc3RhdHVzID0gQURBUFRFUl9TVEFUVVMuUkVBRFk7XG4gICAgdGhpcy5lbWl0KEFEQVBURVJfRVZFTlRTLlJFQURZLCBXQUxMRVRfQURBUFRFUlMuTUVUQU1BU0spO1xuXG4gICAgdHJ5IHtcbiAgICAgIGxvZy5kZWJ1ZyhcImluaXRpYWxpemluZyBtZXRhbWFzayBhZGFwdGVyXCIpO1xuXG4gICAgICBpZiAob3B0aW9ucy5hdXRvQ29ubmVjdCkge1xuICAgICAgICB0aGlzLnJlaHlkcmF0ZWQgPSB0cnVlO1xuICAgICAgICBhd2FpdCB0aGlzLmNvbm5lY3QoKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5lbWl0KEFEQVBURVJfRVZFTlRTLkVSUk9SRUQsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBzZXRBZGFwdGVyU2V0dGluZ3MoXykge31cblxuICBhc3luYyBjb25uZWN0KCkge1xuICAgIHN1cGVyLmNoZWNrQ29ubmVjdGlvblJlcXVpcmVtZW50cygpOyAvLyBzZXQgZGVmYXVsdCB0byBtYWlubmV0XG5cbiAgICBpZiAoIXRoaXMuY2hhaW5Db25maWcpIHRoaXMuY2hhaW5Db25maWcgPSBnZXRDaGFpbkNvbmZpZyhDSEFJTl9OQU1FU1BBQ0VTLkVJUDE1NSwgMSk7XG4gICAgdGhpcy5zdGF0dXMgPSBBREFQVEVSX1NUQVRVUy5DT05ORUNUSU5HO1xuICAgIHRoaXMuZW1pdChBREFQVEVSX0VWRU5UUy5DT05ORUNUSU5HLCB7XG4gICAgICBhZGFwdGVyOiBXQUxMRVRfQURBUFRFUlMuTUVUQU1BU0tcbiAgICB9KTtcbiAgICBpZiAoIXRoaXMubWV0YW1hc2tQcm92aWRlcikgdGhyb3cgV2FsbGV0TG9naW5FcnJvci5ub3RDb25uZWN0ZWRFcnJvcihcIk5vdCBhYmxlIHRvIGNvbm5lY3Qgd2l0aCBtZXRhbWFza1wiKTtcblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLm1ldGFtYXNrUHJvdmlkZXIucmVxdWVzdCh7XG4gICAgICAgIG1ldGhvZDogXCJldGhfcmVxdWVzdEFjY291bnRzXCJcbiAgICAgIH0pO1xuICAgICAgY29uc3Qge1xuICAgICAgICBjaGFpbklkXG4gICAgICB9ID0gdGhpcy5tZXRhbWFza1Byb3ZpZGVyO1xuXG4gICAgICBpZiAoY2hhaW5JZCAhPT0gdGhpcy5jaGFpbkNvbmZpZy5jaGFpbklkKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc3dpdGNoQ2hhaW4odGhpcy5jaGFpbkNvbmZpZyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuc3RhdHVzID0gQURBUFRFUl9TVEFUVVMuQ09OTkVDVEVEO1xuICAgICAgaWYgKCF0aGlzLnByb3ZpZGVyKSB0aHJvdyBXYWxsZXRMb2dpbkVycm9yLm5vdENvbm5lY3RlZEVycm9yKFwiRmFpbGVkIHRvIGNvbm5lY3Qgd2l0aCBwcm92aWRlclwiKTtcbiAgICAgIHRoaXMucHJvdmlkZXIub25jZShcImRpc2Nvbm5lY3RcIiwgKCkgPT4ge1xuICAgICAgICAvLyByZWFkeSB0byBiZSBjb25uZWN0ZWQgYWdhaW5cbiAgICAgICAgdGhpcy5kaXNjb25uZWN0KCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuZW1pdChBREFQVEVSX0VWRU5UUy5DT05ORUNURUQsIHtcbiAgICAgICAgYWRhcHRlcjogV0FMTEVUX0FEQVBURVJTLk1FVEFNQVNLLFxuICAgICAgICByZWNvbm5lY3RlZDogdGhpcy5yZWh5ZHJhdGVkXG4gICAgICB9KTtcbiAgICAgIHJldHVybiB0aGlzLnByb3ZpZGVyO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyByZWFkeSBhZ2FpbiB0byBiZSBjb25uZWN0ZWRcbiAgICAgIHRoaXMuc3RhdHVzID0gQURBUFRFUl9TVEFUVVMuUkVBRFk7XG4gICAgICB0aGlzLnJlaHlkcmF0ZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMuZW1pdChBREFQVEVSX0VWRU5UUy5FUlJPUkVELCBlcnJvcik7XG4gICAgICB0aHJvdyBXYWxsZXRMb2dpbkVycm9yLmNvbm5lY3Rpb25FcnJvcihcIkZhaWxlZCB0byBsb2dpbiB3aXRoIG1ldGFtYXNrIHdhbGxldFwiKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBkaXNjb25uZWN0KCkge1xuICAgIHZhciBfdGhpcyRwcm92aWRlcjtcblxuICAgIGxldCBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7XG4gICAgICBjbGVhbnVwOiBmYWxzZVxuICAgIH07XG4gICAgaWYgKHRoaXMuc3RhdHVzICE9PSBBREFQVEVSX1NUQVRVUy5DT05ORUNURUQpIHRocm93IFdhbGxldExvZ2luRXJyb3IuZGlzY29ubmVjdGlvbkVycm9yKFwiTm90IGNvbm5lY3RlZCB3aXRoIHdhbGxldFwiKTtcbiAgICAoX3RoaXMkcHJvdmlkZXIgPSB0aGlzLnByb3ZpZGVyKSA9PT0gbnVsbCB8fCBfdGhpcyRwcm92aWRlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkcHJvdmlkZXIucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG5cbiAgICBpZiAob3B0aW9ucy5jbGVhbnVwKSB7XG4gICAgICB0aGlzLnN0YXR1cyA9IEFEQVBURVJfU1RBVFVTLk5PVF9SRUFEWTtcbiAgICAgIHRoaXMubWV0YW1hc2tQcm92aWRlciA9IG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIHJlYWR5IHRvIGJlIGNvbm5lY3RlZCBhZ2FpblxuICAgICAgdGhpcy5zdGF0dXMgPSBBREFQVEVSX1NUQVRVUy5SRUFEWTtcbiAgICB9XG5cbiAgICB0aGlzLnJlaHlkcmF0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLmVtaXQoQURBUFRFUl9FVkVOVFMuRElTQ09OTkVDVEVEKTtcbiAgfVxuXG4gIGFzeW5jIGdldFVzZXJJbmZvKCkge1xuICAgIGlmICh0aGlzLnN0YXR1cyAhPT0gQURBUFRFUl9TVEFUVVMuQ09OTkVDVEVEKSB0aHJvdyBXYWxsZXRMb2dpbkVycm9yLm5vdENvbm5lY3RlZEVycm9yKFwiTm90IGNvbm5lY3RlZCB3aXRoIHdhbGxldCwgUGxlYXNlIGxvZ2luL2Nvbm5lY3QgZmlyc3RcIik7XG4gICAgcmV0dXJuIHt9O1xuICB9XG5cbiAgYXN5bmMgc3dpdGNoQ2hhaW4oY2hhaW5Db25maWcpIHtcbiAgICBpZiAoIXRoaXMubWV0YW1hc2tQcm92aWRlcikgdGhyb3cgV2FsbGV0TG9naW5FcnJvci5ub3RDb25uZWN0ZWRFcnJvcihcIk5vdCBjb25uZWN0ZWQgd2l0aCB3YWxsZXRcIik7XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5tZXRhbWFza1Byb3ZpZGVyLnJlcXVlc3Qoe1xuICAgICAgICBtZXRob2Q6IFwid2FsbGV0X3N3aXRjaEV0aGVyZXVtQ2hhaW5cIixcbiAgICAgICAgcGFyYW1zOiBbe1xuICAgICAgICAgIGNoYWluSWQ6IGNoYWluQ29uZmlnLmNoYWluSWRcbiAgICAgICAgfV1cbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKHN3aXRjaEVycm9yKSB7XG4gICAgICAvLyBUaGlzIGVycm9yIGNvZGUgaW5kaWNhdGVzIHRoYXQgdGhlIGNoYWluIGhhcyBub3QgYmVlbiBhZGRlZCB0byBNZXRhTWFzay5cbiAgICAgIGlmIChzd2l0Y2hFcnJvci5jb2RlID09PSA0OTAyKSB7XG4gICAgICAgIGF3YWl0IHRoaXMubWV0YW1hc2tQcm92aWRlci5yZXF1ZXN0KHtcbiAgICAgICAgICBtZXRob2Q6IFwid2FsbGV0X2FkZEV0aGVyZXVtQ2hhaW5cIixcbiAgICAgICAgICBwYXJhbXM6IFt7XG4gICAgICAgICAgICBjaGFpbklkOiBjaGFpbkNvbmZpZy5jaGFpbklkLFxuICAgICAgICAgICAgY2hhaW5OYW1lOiBjaGFpbkNvbmZpZy5kaXNwbGF5TmFtZSxcbiAgICAgICAgICAgIHJwY1VybHM6IFtjaGFpbkNvbmZpZy5ycGNUYXJnZXRdXG4gICAgICAgICAgfV1cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBzd2l0Y2hFcnJvcjtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxufVxuXG5leHBvcnQgeyBNZXRhbWFza0FkYXB0ZXIgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1ldGFtYXNrQWRhcHRlci5lc20uanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=