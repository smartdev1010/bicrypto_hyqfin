function initTrading(t){$("#"+t).find(".dash-pan-action").length>0&&initTradingChartControllers()}function initTradingChartControllers(){$(".dash-pan-action-btn-buy").off("click").click((function(){showConfirmationPlaceOrder(this,$(this).parent().attr("container"),"buy",$(this).parent().attr("thirdparty"))})),$(".dash-pan-action-btn-sell").off("click").click((function(){showConfirmationPlaceOrder(this,$(this).parent().attr("container"),"sell",$(this).parent().attr("thirdparty"))})),$(".dash-pan-action-confirm").off("click").click((function(t){return t.preventDefault(),!1})),$(".dash-pan-action-amount-esyslc li").click((function(t){let n=$(this).attr("premade-v");return $(this).parent().parent().parent().find('input[type="number"]').val(n),updatePriceAmountTrading(),$(".dash-pan-action-amount-esyslc").removeClass("dash-pan-action-amount-esyslc-shown"),t.preventDefault(),!1})),$(".dash-pan-action-slcthird > div").off("click").click((function(){$(this).parent().find("ul").toggle()})),$(".dash-pan-action-amount-s").find('input[type="number"]').off("focus").focus((function(){$(this).parent().parent().parent().find(".dash-pan-action-amount-esyslc").addClass("dash-pan-action-amount-esyslc-shown")})),$(".dash-pan-action-amount-s").off("click").click((function(){$(this).find('input[type="number"]').focus()})),$(".dash-pan-action-limitprice-pm").find("div").off("click").click((function(){let t=parseFloat($(this).parent().parent().find('input[type="number"]').attr("cc-price")),n=0;n=0==$(this).parent().parent().find('input[type="number"]').val().length||isNaN($(this).parent().parent().find('input[type="number"]').val())?t:parseFloat($(this).parent().parent().find('input[type="number"]').val());let a=parseFloat($(this).parent().attr("lm-step")),i=parseFloat($(this).parent().attr("lm-min"));isNaN(n)&&(n=t),"plus"==$(this).attr("lm")?n+=a:n-=a,n<i&&(n=i),a=""+a;let r=a.split(".")[1]?a.split(".")[1].length:0;n=parseFloat(n).toFixed(parseInt(r)),$(this).parent().parent().find('input[type="number"]').val(n),_setOrderByLimit($(this).parent().attr("lm-container"),n)})),$(".dash-pan-action-limitprice-inpt").find('input[type="number"]').on("input",(function(){_setOrderByLimit($(this).parent().attr("lm-container"),$(this).val())})),$(".dash-pan-action-amount-s").find('input[type="number"]').off("focusout").focusout((function(){$(this).parent().parent().parent().find(".dash-pan-action-amount-esyslc").removeClass("dash-pan-action-amount-esyslc-shown")})),$(".dash-pan-action-amount > ul > li").off("click").click((function(){let t=$(this).parent().parent().find('input[type="number"]'),n=parseFloat(t.val());"minus"==$(this).attr("trade-act")?n-=parseFloat(t.attr("min")):n+=parseFloat(t.attr("min")),n<=parseFloat(t.attr("min"))&&(n=parseFloat(t.attr("min"))),t.val(n),updatePriceAmountTrading()})),$(".dash-pan-chg-exg").off("click").click((function(){let t=$(this).attr("chart-trade-tp"),n=$(this).find("img").attr("src"),a=$(this).parent().parent().find("div"),i=a.attr("chart-trade-tp"),r=$(this).attr("trading-price"),e=a.attr("trading-price");$(this).parent().prepend('<li class="dash-pan-chg-exg" trading-price="'+e+'" chart-trade-tp="'+i+'"><img src="'+a.find("img").attr("src")+'"/></li>'),a.attr("chart-trade-tp",t),a.find("img").attr("src",n),a.attr("trading-price",r),$(this).parent().parent().parent().parent().find(".dash-pan-action-qtd").attr("market-multticker",r),$(this).parent().hide(),$(this).parent().parent().parent().parent().find('[confirm-v="unit_price"]').attr("confirm-v-up",r),$(this).parent().parent().parent().parent().find('[confirm-v="unit_price"]').find("i").html(KRformatNumber(r,2)),updatePriceAmountTrading(),$(this).remove(),initTradingChartControllers()})),$(".dash-pan-action-confirm > header > div").click((function(t){return closeTradeConfirmation(),t.preventDefault(),!1})),$(".dash-pan-action").each((function(){$(this).find('input[type="number"]').off("keyup").keyup((function(){updatePriceAmountTrading()})),$(this).find('input[type="number"]').off("change").change((function(){updatePriceAmountTrading()}))})),$(document).mouseup((function(t){var n=$(".dash-pan-action-confirm");n.is(t.target)||0!==n.has(t.target).length||closeTradeConfirmation(),(n=$(".dash-pan-action-amount")).is(t.target)||0!==n.has(t.target).length||$(".dash-pan-action-amount-esyslc").removeClass("dash-pan-action-amount-esyslc-shown"),(n=$(".dash-pan-action-limitprice-form")).is(t.target)||0!==n.has(t.target).length||$(".dash-pan-action-limitprice-form").hide()}))}function _setOrderByLimit(t,n){$('.dash-pan-action[container="'+t+'"]').find(".dash-pan-action-limitprice-infos").css("display","flex"),$('.dash-pan-action[container="'+t+'"]').find(".dash-pan-action-limitprice-btn").hide(),$('.dash-pan-action[container="'+t+'"]').find(".dash-pan-action-limitprice-infos").find("div").off("click").click((function(){_setOrderByMarket(t),_hideLimitOrder(t)})),$('.dash-pan-action[container="'+t+'"]').find(".dash-pan-action-btn-img-b").attr("src",$("body").attr("hrefapp")+"/app/modules/dashboard/statics/img/icons/buy_limit.svg"),$('.dash-pan-action[container="'+t+'"]').find(".dash-pan-action-btn-img-s").attr("src",$("body").attr("hrefapp")+"/app/modules/dashboard/statics/img/icons/sell_limit.svg"),$('.dash-pan-action[container="'+t+'"]').find(".dash-pan-action-limitprice-infos").find("span").html(KRformatNumber(n,6)),$('.dash-pan-action[container="'+t+'"]').find('[order-lmi-h="true"]').hide(),$('.dash-pan-action[container="'+t+'"]').find('[order-lmi-s="true"]').css("display","flex"),$('.dash-pan-action[container="'+t+'"]').find('[confirm-v="purchase_price"]').find("i").html(KRformatNumber(n,6)),$('.dash-pan-action[container="'+t+'"]').find("[limitprice-buy-ac]").attr("limitprice-buy-ac","true")}function _showLimitOrder(t){$('.dash-pan-action[container="'+t+'"]').find(".dash-pan-action-limitprice-form").css("display","block")}function _hideLimitOrder(t){$('.dash-pan-action[container="'+t+'"]').find(".dash-pan-action-limitprice-form").hide()}function _setOrderByMarket(t){$('.dash-pan-action[container="'+t+'"]').find(".dash-pan-action-limitprice-infos").hide(),$('.dash-pan-action[container="'+t+'"]').find(".dash-pan-action-limitprice-btn").css("display","flex"),$('.dash-pan-action[container="'+t+'"]').find(".dash-pan-action-btn-img-b").attr("src",$("body").attr("hrefapp")+"/app/modules/dashboard/statics/img/icons/buy_market.svg"),$('.dash-pan-action[container="'+t+'"]').find(".dash-pan-action-btn-img-s").attr("src",$("body").attr("hrefapp")+"/app/modules/dashboard/statics/img/icons/sell_market.svg"),$('.dash-pan-action[container="'+t+'"]').find(".dash-pan-action-limitprice-infos").find("span").html("-"),$('.dash-pan-action[container="'+t+'"]').find('[order-lmi-h="true"]').css("display","flex"),$('.dash-pan-action[container="'+t+'"]').find('[order-lmi-s="true"]').hide(),$('.dash-pan-action[container="'+t+'"]').find('[confirm-v="purchase_price"]').find("i").html("-"),$('.dash-pan-action[container="'+t+'"]').find("[limitprice-buy-ac]").attr("limitprice-buy-ac","false"),$('.dash-pan-action[container="'+t+'"]').find(".limitprice-buy").val(""),_hideLimitOrder(t)}function showConfirmationPlaceOrder(t,n,a,i){let r=$(t).parent().parent().find(".dash-pan-action-confirm");r.show(),r.find(".btn-action-placetrade").html("Confirm "+a+"ing"),"sell"==a?(r.find(".btn-action-placetrade").removeClass("btn-green"),r.find(".btn-action-placetrade").addClass("btn-lightred"),r.find("[confirm-qntd]").hide()):(r.find(".btn-action-placetrade").removeClass("btn-lightred"),r.find(".btn-action-placetrade").addClass("btn-green"),r.find("[confirm-qntd]").show()),r.find("a").off("click").click((function(t){return placerOrder(n,a,i),closeTradeConfirmation(),t.preventDefault(),!1}))}function closeTradeConfirmation(){return $(".dash-pan-action-confirm").hide(),!1}function updatePriceAmountTrading(){$(".dash-pan-action").each((function(){let t=$(this).find(".dash-pan-action-qtd").attr("market-multticker"),n=parseFloat($(this).find('input[type="number"]').val());(0==n.length||n<$(this).find('input[type="number"]').attr("min"))&&(n=$(this).find('input[type="number"]').attr("min"));let a=parseFloat(n)*parseFloat(t),i=6;a>10&&(i=5),a>100&&(i=4),a>1e3&&(i=3),a>1e4&&(i=2),a>1e5&&(i=1),a>1e6&&(i=0),$(this).find(".dash-pan-action-qtd").find("span").html(KRformatNumber(a,i)),$(this).find('[confirm-v="investment"]').find("i").html(KRformatNumber(n,6));parseFloat($(this).find('[confirm-v="unit_price"]').attr("confirm-v-up"));if($(this).find('[confirm-v="amount"]').find("i").html(KRformatNumber(a,i)),$(this).find('[confirm-v="fees"]').length>0){let t=parseFloat($(this).find('[confirm-v="fees"]').attr("confirm-v-up"))/100;$(this).find('[confirm-v="fees"]').find("i:last-child").html(KRformatNumber(a*t,6)),$(this).find('[confirm-v="total"]').find("i").html(KRformatNumber(parseFloat(a)-parseFloat(a*t),6))}else $(this).find('[confirm-v="total"]').find("i").html(KRformatNumber(a,6))}))}function placerOrder(t,n,a){let i=$("#"+t).find(".dash-pan-action"),r=i.attr("symbol"),e=i.attr("currency"),o=i.find('input[type="number"]').val(),s=i.find("[limitprice-buy-ac]").attr("limitprice-buy-ac");s="true"==s;let p=i.find("[limitprice-buy-ac]").val(),c={from:r,to:e,side:n,type:"market",amount:o,thirdparty:a,type_super:s?"limit":"market",order_price:p,date:null};if($("#graph-"+t).length>0){let n=chartList[t].option.xAxis[0].data;c.date=n[n.length-1]}$('.dash-pan-action[symbol="'+r+'"]').find(".dash-pan-action-btn-"+n+" > span").html("~ ~ ~"),$.post($("body").attr("hrefapp")+"/app/modules/trade/src/actions/placeTrade.php",c).done((function(a){let i=jQuery.parseJSON(a);_updateBalanceData(),0==i.error?($('.dash-pan-action[symbol="'+r+'"]').find(".dash-pan-action-btn-"+n+" > span").html("Success"),showCryptoAlert(r,o,"buy",null,e),$("#graph-"+t).length>0&&$.each($('.dash-pan-cry[symbol="'+r+'"][currency="'+e+'"]'),(function(){loadChartOrder($(this).attr("id"),r,o,c.date,n.toUpperCase())})),tradeGraph=setTimeout((function(){$('.dash-pan-action[symbol="'+r+'"]').find(".dash-pan-action-btn-"+n+" > span").html(n)}),1500)):9==i.error?(_showIdentityWizard(),$('.dash-pan-action[symbol="'+r+'"]').find(".dash-pan-action-btn-"+n+" > span").html(n)):3==i.error?_showThirdpartySetup(i.thirdparty):(showAlert("Oops",i.msg,"error"),$('.dash-pan-action[symbol="'+r+'"]').find(".dash-pan-action-btn-"+n+" > span").html(n))})).fail((function(){showAlert("Oops","Fail to make the place","error")}))}function _showThirdpartySetup(t,n="user"){closeAccountView(),$("body").addClass("nblr"),$.get($("body").attr("hrefapp")+"/app/modules/trade/views/connectThirdparty.php",{thirdparty:t,cmdcfg:n}).done((function(t){$.when($("body").prepend(t)).then((function(){_initThirdpartySetupController()}))})).fail((function(){showAlert("Oops","Fail to load thirdparty setup form","error")}))}function _initThirdpartySetupController(){$(".thirdparty-setup-form").off("submit").submit((function(t){return $(".thirdparty-setup").find("form").hide(),$(".thirdparty-setup").find(".spinner").show(),$(".thirdparty_connect_field").removeClass("error_field"),$.post($(this).attr("action"),$(this).serialize()).done((function(t){let n=jQuery.parseJSON(t);1==n.error?(showAlert("Oops",n.msg,"error"),$(".thirdparty-setup").find(".spinner").hide(),$(".thirdparty-setup").find("form").show()):2==n.error?($(".thirdparty-setup").find(".spinner").hide(),$(".thirdparty-setup").find("form").show(),$(".thirdparty_connect_field").addClass("error_field")):location.reload()})).fail((function(){showAlert("Oops","Fail to save thirdparty (contact admin)","error")})),t.preventDefault(),!1}))}function closeThirdpartySetup(){$(".thirdparty-setup").remove(),$("body").removeClass("nblr")}function removeThirdpartySetup(t){$(".thirdparty-setup").find("form").hide(),$(".thirdparty-setup").find(".spinner").show(),$.post($("body").attr("hrefapp")+"/app/modules/trade/src/actions/removeThirdparty.php",{token:t}).done((function(t){let n=jQuery.parseJSON(t);1==n.error?(showAlert("Oops",n.msg,"error"),$(".thirdparty-setup").find(".spinner").hide(),$(".thirdparty-setup").find("form").show()):location.reload()})).fail((function(){showAlert("Oops","Fail to remove thirdparty","error")}))}
